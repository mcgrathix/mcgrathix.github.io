var B,Browser=B=(function(){var b=navigator.userAgent.toLowerCase();var a=((b.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1]||"").split(".");for(var d=0;d<a.length;d++){a[d]=parseInt(a[d],10)}var c=0;for(d=0;d<a.length;d++){c+=Math.pow(10,3*(0-d))*a[d]}a=c;var e={safari:(/webkit/).test(b)?a:NaN,chrome:(/chrome/).test(b)?a:NaN,opera:(/opera/).test(b)?a:NaN,msie:(/msie/).test(b)&&!(/opera/).test(b)?a:NaN,mozilla:(/mozilla/).test(b)&&!(/(compatible|webkit)/).test(b)?a:NaN,mobileSafari:(/apple.*mobile.*safari/).test(b)?a:NaN,iPad:!!(/ipad/).test(b)&&((!!(/applewebkit/).test(b)&&parseFloat(b.substring(b.indexOf("os ")+"os ".length,b.indexOf(" like mac os x")).split("_").join(".")))||true),iPhone:!!(/iphone/).test(b)&&((!!(/applewebkit/).test(b)&&parseFloat(b.substring(b.indexOf("os ")+"os ".length,b.indexOf(" like mac os x")).split("_").join(".")))||true),android:!!(/android/).test(b),silk:!!(/silk/).test(b),windows:!!(/(windows)/).test(b),mac:!!((/(macintosh)/).test(b)||!!(/(mac os x)/).test(b))};e.lion=!!(/mac os x 10_7/.test(b)&&!(/like mac os x 10_7/).test(b));e.mobile=e.iPad||e.iPhone||e.android;e.onlyiOS=e.iPad||e.iPhone;e.desktop=!e.mobile;e.iPhone=e.iPhone||e.android;e.iOS=e.iPad||e.iPhone;e.iPhone4=e.iPhone&&window.devicePixelRatio===2;e.iPhone3=e.iPhone&&!e.iPhone4;e.standalone=navigator.standalone;e.rightToLeft=!!window.RIGHT_TO_LEFT;e.leftToRight=!e.rightToLeft;if(e.silk){e.mobile=true;e.android=true;e.mac=false;e.desktop=false;e.safari=NaN}e._origKeys={};for(d in e){e._origKeys[d]=e[d]}e.uA=b;e.version=a;return e})();B.s=(function(){var c=(function(){var j=B.safari,d=B.mozilla,g=B.msie,h=B.chrome;if(h){return parseInt(B.uA.substring(B.uA.indexOf("chrome/")+"chrome/".length),10)}if(j){var f=navigator.userAgent,k=f.indexOf("Version/")+8,e;if(k===7){return true}j=f.substring(k,f.indexOf(" ",k));e=j.indexOf(".")+1;j=j.substring(0,e||j.length)+(e?j.substring(e).split(".").join(""):"");return parseFloat(j)}var l=2e-7;if(d>=4){return Math.floor(d)}if(d>=1.009002-l){return 3.6}if(d>=1.009001-l){return 3.5}if(d>=1.009-l){return 3}if(d>=1.008001-l){return 2}if(d>=1.008-l){return 1.5}if(d){return 1}if(g>=5){return Math.floor(g)}if(g){return 5}})(),b={};for(var a in B._origKeys){if(B._origKeys.hasOwnProperty(a)){b[a]=B[a]?c:B[a]}}b.version=c;return b})();B.addBodyClassNames=function(){var a=document.body,c=a.className,e,d;for(var b in B._origKeys){if(!B.hasOwnProperty(b)||b==="_origKeys"||!B[b]){continue}c+=" "+b}if(B.s.version){e="v"+B.s.version.toString().split(".").join("-");c+=" "+e}d="v"+Math.floor(B.s.version);if(e!==d){c+=" "+d}if(window.devicePixelRatio===2){c+=" doubleres"}document.body.className=c;try{a.parentNode.className=a.className}finally{}};Function.prototype.base=function(){};function enumerate(e,d,b,c,a){if(!e){return"{falsy}"}function h(i){return i.split("\\").join("\\\\").split("\n").join("\\n").split("'").join("\\'").split('"').join('\\"')}var k,f;if(d===true){d=10}if(d<1){d=false}if(!a){a=0}var g="";if(d){g="    "}var j=e.___originalKeys||e;for(f in j){if(f==="___originalKeys"||(!b&&!j.hasOwnProperty(f))||(c&&!!c[f])){continue}(k||(k=[])).push("    "+(f.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)?f:'"'+f+'"')+": "+(function(){try{if(typeof e[f]=="string"){return'"'+h(e[f])+'"'}if(typeof e[f]=="number"){return e[f]}if(typeof e[f]=="function"){return e[f].toString().split("\n").join("\n"+g)}return d?enumerate(e[f],d-1,b,c,undefined,a+1).split("\n").join("\n"+g):e[f]}catch(i){return i}})())}if(!k){return"{}"}return" {\n"+k.join(",\n")+"\n}"}function benchFunction(l,f){f||(f=20);var h=this.blankFunction||(this.blankFunction=function(){});var e=new Date().getTime();for(var k=0;new Date().getTime()-e<f;k++){l()}var m=new Date().getTime();for(var g=0;new Date().getTime()-e<f||g<k;g++){h()}var d=new Date().getTime(),j=(m-e-(d-m))/k*1000000,b=(m-e)/k*1000000,a=(d-m)/k*1000000;arguments.callee.output="Corrected: "+(j/1000)+"µs\nTotal: "+(b/1000)+"µs\nIteration Overhead: "+(a/1000)+"µs";return j}(function(){var b=function(h,g){if(!h||!g){return false}var f=h.className;return(f.length>0&&(f==g||new RegExp("(^|\\s)"+g+"(\\s|$)").test(f)))},c=function(g,f){if(!g||!f){return}if(!b(g,f)){g.className+=(g.className?" ":"")+f}},a=function(g,f){if(!g||!f){return}g.className=g.className.replace(new RegExp("(^|\\s+)"+f+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},d=function(f){c(this[0],f);return this},e=function(f){a(this[0],f);return this};if(!window.$){window.$=function(g){var f=[g];f.addClass=d;f.removeClass=e;return f}}})();Core={_runningCoreGuid:0,objects:[],_argPasser:[],emptyArray:[],ie8EmptyArray:B.msie<=8?[]:undefined,noOp:function(){}};Core.guidFor=function(b){var a=typeof b;if(a==="function"||a==="object"||a==="xml"){return b.coreGuid||(b.coreGuid=++Core._runningCoreGuid)}return b};(Core.cloneFunction=function(c){var b=c.clonedFrom;if(b){return b.clone()}var d=function(){var g=arguments.callee.clonedFrom,f=g.base,e;g.base=arguments.callee.base;e=arguments.callee.clonedFrom.apply(this,arguments);g.base=f;return e};for(var a in c){if(c.hasOwnProperty(a)){d[a]=c[a]}}d.clonedFrom=c;d.toString=arguments.callee._cloneFunction_toString;return d})._cloneFunction_toString=function(){return"Clone of "+this.clonedFrom.toString()};Core.cloneHash=function(e,d){var a=d===true,c=d instanceof Object?d:{};for(var b in e){if(e.hasOwnProperty(b)){c[b]=e[b]}}return c};Array.prototype.remove=function(b){var c=0,d=this,f=0,a=d.length,e;for(;c<a-f;c++){if(d[c]===b){f++;c--}if(f){d[e=c+1]=d[e+f]}}d.length-=f;return d};Array.prototype.indexOf=function(b){if(!b){return -1}for(var a=0,c;c=this[a];a++){if(c===b){return a}}return -1};Array.prototype.insertAtIndex=function(c,a){if(isNaN(a)){return}if(a===0){return this.unshift(c)}for(var b=this.length;b>a;b--){this[b]=this[b-1]}this[a]=c;return this};Array.prototype.contains=function(b){for(var a=this.length-1;a>=0;a--){if(this[a]===b){return true}}return false};String.prototype.w=function(){return this.split(/\s+/)};String.prototype.fmt=function(){if(this.search("%@")<0){return this+""}var e=this.split("%@"),d="",b=Array.prototype.slice.call(arguments);for(var c=0,a;c<e.length;c+=1){d+=e[c];a=b.shift();if(a!==undefined){d+=a}}return d};String.prototype.loc=function(){if(!Core.Locale.currentLocale){Core.Locale.createCurrentLocale()}var a=Core.Locale.currentLocale,c=a.locString(this.toString()),b=Array.prototype.slice.call(arguments);if(c){c=String.prototype.fmt.apply(c,b)}return c};YES=true;NO=false;require("core/utils");Core.ObjectPrototypeMembers={className:"Object",init:function(){this.hasOwnProperty("coreGuid")||(this.coreGuid=++Core._runningCoreGuid);Core.objects[this.coreGuid]=this},mixin:function mixin(k){if(!arguments.length){return this}var c=arguments.length,e,b,g,d,h,f,m,l,a,o,n;for(e=0;e<c;e++){if(!(d=arguments[e])){continue}l=d.isMixin;for(m in d){if(!d.hasOwnProperty(m)||m==="isMixin"){continue}h=this[m];f=d[m];if((a=this[m+"Override"])){if(a instanceof Function||(a=this[a]) instanceof Function){f=a.call(this,f,h,m)}}if((o=this._overrideSuffixes)){for(b=0;n=o[b];b++){if(m.slice(-n.length)===n){if((a=this["*"+n+"Override"])){if(a instanceof Function||(a=this[a]) instanceof Function){f=a.call(this,f,h,m)}}}}}if(f===h){continue}if(h instanceof Function&&f instanceof Function){if(l){f=Core.cloneFunction(f)}if(f){f.base=h}if(h._listens){this.unlisten(h)}}if(f instanceof Function&&f._listens){this.listen(f)}this[m]=f}}return this},_overrideSuffixes:["Override"],"*OverrideOverride":function(e,a,d){if(typeof d!=="string"||d.charAt(0)!=="*"){return e}var g=d.substring(1).slice(0,-8),b=this._overrideSuffixes;if(b){for(var c=0,f;f=b[c];c++){if(g===f){return e}}}this.ensureOwn("_overrideSuffixes").push(g);return e},ensureOwn:function ensureOwn(b){var c=this[b],a;if(this.hasOwnProperty(b)){return c}if(!c||typeof c==="number"||typeof c==="string"){return c}if(c instanceof Function){return this[b]=Core.cloneFunction(c)}if(c instanceof Array){return this[b]=[].concat(c)}if(c instanceof Element){return this[b]=c.cloneNode(true)}if(c instanceof Object){return this[b]=Core.cloneHash(c)}},trigger:function trigger(f){if(this.isDestroyed){return}var h=this["__"+f+"Listeners__"],d;if(!h){return}if(arguments[1]){(d=Core._argPasser).length=0;for(var c=1,b=arguments.length;c<b;c++){d.push(arguments[c])}}for(var e=0,a=h.length,g;e<a;e++){(g=h[e])&&g.apply(this,d||Core.ie8EmptyArray)}},listen:function listen(c,g){if(!c){return}if(!g){if(typeof c==="string"){return}g=c;var f=g._listens;if(f){for(var b=0;c=f[b];b++){this.listen(c,g)}}return}var e="__"+c+"Listeners__";if(!this.hasOwnProperty(e)){if(!this[e]){this[e]=[]}else{for(var d=[],a=0,h=this[e].length;a<h;a++){d.push(this[e][a])}this[e]=d}}this[e].push(g)},unlisten:function unlisten(n,b){if(!n){return}if(!b){b=n;var o=b._listens;if(o){for(var e=0;n=o[e];e++){this.unlisten(n,b)}}return}var g="__"+n+"Listeners__";if(!this[g]){return}if(!this.hasOwnProperty(g)){for(var a=[],d=0,m=this[g].length;d<m;d++){a.push(this[g][d])}this[g]=a}for(var f=0,h=this[g],c=h.length;f<c;f++){if(h[f]===b){h[f]=undefined}}},clearTrigger:function(a){var b=this["__"+a+"Listeners__"];if(!b){return}b.length=0},toString:function(){return"["+this.className+(this.coreGuid?":"+this.coreGuid:"")+"]"},get:function get(a){var b=this[a];if(b instanceof Function&&b.isProperty){b=b.call(this,a,undefined)}return b},set:function set(a,b){var c=this[a];if(c instanceof Function&&c.isProperty){c.call(this,a,b)}else{this[a]=b}this.trigger(a);return b},setIfChanged:function setIfChanged(c,b){var a=this[c];this[c]=b;if(b!==a){this.trigger(c);return true}return false},suspendTriggers:function(){if(this._suspendedTrigger){return}this._suspendedTrigger=this.trigger;this.trigger=this._cacheTriggerCallFor},resumeTriggers:function(){if(!this._suspendedTrigger){return}this.trigger=this._suspendedTrigger;this._suspendedTrigger=null;var d,c=this._triggerCache,e=this._tmpTrgCopy||(this._tmpTrgCopy=[]);e.length=0;for(var b=0,a=c.length;b<a;b++){e[b]=c[b]}this._triggerCache.length=0;for(b in this._triggerCacheHash){if(this._triggerCacheHash.hasOwnProperty(b)){delete this._triggerCacheHash[b]}}for(b=0;d=e[b];b++){this.trigger(d)}},_cacheTriggerCallFor:function(c){if(arguments[2]){return this._suspendedTrigger.apply(this,arguments)}var b=this._triggerCache||(this._triggerCache=[]),a=this._triggerCacheHash||(this._triggerCacheHash={});if(a[c]===(a[c]=YES)){return}b.push(c)},concatenate:function(c,a,b){if(typeof c==="string"&&(!a||typeof a==="string")){return(a||"")+c}return a?a.concat(c):c}};require("core/object_members");Core.Object=function(){};Core.Object.prototype=Core.ObjectPrototypeMembers;Core.Object.prototype.mixin.call(Core.Object,{isClass:true,create:function create(){var a=new this();a._isCreating=true;a.mixin.apply(a,arguments);delete a._isCreating;a.init();return a},extend:function extend(){var a=function(){};for(var b in this){if(this.hasOwnProperty(b)){a[b]=this[b]}}var c=new this();c._type=a;c.mixin.apply(c,arguments);a.prototype=c;a.superclass=this;return a},reopen:function reopen(){this.prototype.mixin.apply(this.prototype,arguments);return this}});require("core/object");Core.Object.reopen({resolvePropertyPath:function resolvePropertyPath(d){if(!d){return this}var f=d.indexOf("."),e,a=false,c,b;if(f===-1){return this.get(d)}e=this;if(f){e=window}else{d=d.substring(1)}while(f!==-1){f=d.indexOf(".");a=f===-1;b=d.substring(0,a?d.length:f);e=(e.get instanceof Function)?e.get(b):e[b];if(!e||a){return e}d=d.substring(f+1)}},getPath:function getPath(a){return this.resolvePropertyPath("."+a)},init:function(){var c=this._eavesdrops;if(typeof c==="string"){c=[c]}for(var a=0,b;c&&(b=c[a]);a++){this.eavesdropObjectAtPath(b)}this._hasEavesdroppedInitialObjects=YES;arguments.callee.base.apply(this,arguments);this.trigger("init")},eavesdropObjectAtPath:function(b){var a=this.resolvePropertyPath(b);if(a&&a.addEavesdropper){a.addEavesdropper(this,b)}else{Core.debug("Can't observe properties on object",a,"at path",b,"from ",this)}},listen:function listen(c,e){if(c instanceof Function){return arguments.callee.base.apply(this,arguments)}var g=c.lastIndexOf(".");if(g===-1){return arguments.callee.base.apply(this,arguments)}var f=c.substring(0,g),a=this.ensureOwn("_eavesdrops")||(this._eavesdrops=[]);for(var b=0,d;d=a[b];b++){if(d===f){return arguments.callee.base.apply(this,arguments)}}a.push(c.substring(0,g));if(this._hasEavesdroppedInitialObjects){this.eavesdropObjectAtPath(f)}return arguments.callee.base.apply(this,arguments)},addEavesdropper:function(e,d){if(!e){return}var b=this._eavesdroppers||(this._eavesdroppers=[]);for(var c=0,a;a=b[c];c++){if(a===e){return}}b.push(e);(this._eavesdropperPaths||(this._eavesdropperPaths=[])).push(d)},removeEavesdropper:function(d){if(!d){return}var b=this._eavesdroppers;if(!b){return}for(var c=0,a;a=b[c];c++){if(a!==d){continue}b.splice(c,1);this._eavesdropperPaths.splice(c,1);return}},trigger:function trigger(){arguments.callee.base.apply(this,arguments);var d=arguments[0],b=this._eavesdroppers,f=this._eavesdropperPaths,c=0,a,e;if(d.indexOf(".")+1){return}for(;b&&(a=b[c])&&(e=f[c]);c++){arguments[0]=e+"."+d;a.trigger.apply(a,arguments)}},"*BindingOverride":function(a,e,h){if(typeof a!=="string"){return a}h=h.slice(0,-7);var i=a.substring(0,5)==="hard:";if(i){a=a.substring(5)}var j=a.indexOf(":"),f=a.substring(0,j);a=a.substring(j+1);var c=a.lastIndexOf("."),b=a.substring(0,c),g=a.substring(c+1),k=NO,d=i?"set":"setIfChanged";if(f!=="from"){this.listen(this[h+"BindingTo"]=function(){if(k){return}k=YES;var m=this.resolvePropertyPath(b),l=this[h];if(l instanceof Function&&l.isProperty){l=this.get(h)}if(m){m[d](g,l,YES)}k=NO}.observes(h))}if(f!=="to"){this.listen(this[h+"BindingFrom"]=function(){if(k){return}k=YES;this[d](h,this.resolvePropertyPath(a),YES);k=NO}.observes(a,"init"))}return a}});Function.prototype.observes=Function.prototype.runsOn=function(){var d=!this._listens,c=(this._listens||(this._listens=[]));if(d){c.length=0}for(var b=0,a=arguments.length;b<a;b++){c.push(arguments[b])}return this};Function.prototype.property=function(){this.isProperty=true;return this};require("core/external_observability");Core=Core.Object.create(Core,{});require("core/namespace");Core.Animator=Anim=Core.Object.create({fps:60,tasks:[],speedMultiplier:1,frameCount:0,isActive:false,isInFrame:false,extraStatus:{},enableOldIE:true,_frameTimeNoiseLevelingWindowSize:30,_frameNoiseLevelerLog:[],_movingAverageFrameTime:function(){for(var c=0,d=Anim._frameNoiseLevelerLog,b=0,a=d.length;c<a;c++){b+=d[c]}return Math.round(10*b/(a||1))/10},initialSetup:function(){this.stop();this.useRAF=this.IS_MOBILE&&window.requestAnimationFrame&&window.cancelRequestAnimationFrame;this.lock16=this.IS_MOBILE&&!this.useRAF}.observes("init"),nextFrame:function nextFrame(a,h){Anim.isInFrame=true;var f,j=Anim._frameNoiseLevelerLog,b=Anim._frameTimeNoiseLevelingWindowSize,d,e;d=(Anim._lastFrameTime===-1)?new Date().valueOf():Anim._lastFrameTime;Anim._lastFrameTime=new Date().valueOf();e=d=Anim._lastFrameTime-d;Anim.now=Anim._lastFrameTime;if(Anim.firstActiveFrame){d=0}if(d>=300&&d>=(f=Math.max(Anim._movingAverageFrameTime(),300/5))*5){j.unshift(f/2)}else{j.unshift(d)}(j.length<=b)||(j.length=b);Anim.frameTime=d;if(!Anim.shouldSkipFrame||!Anim.shouldSkipFrame()){Anim.trigger("preframe");for(var g=0,c;c=Anim.tasks[g];g++){if(c.running&&!c.paused){c.elapse(Math.min(d,30000)*Anim.speedMultiplier)}}for(g=0;c=Anim.tasks[g];g++){if(!c.running){c._inTasks=false;Anim.tasks.splice(g--,1)}}Anim.trigger("frame");Anim.isActive=!!Anim.tasks.length;Anim.frameCount++}Anim.frameRate=Math.round(100*1000/e)/100;Anim.computeTime=new Date().valueOf()-Anim.now;var k=Math.round(1000/Anim.fps);Anim.timeoutWaitTime=Math.max(0,k-Anim.computeTime);Anim.clearNextTimeout();if(!h&&Anim.isActive){if(Anim.useRAF){Anim._timeout=window.requestAnimationFrame(Anim.nextFrame,document.body)}else{Anim._timeout=setTimeout(Anim.nextFrame,Anim.lock16?16:Anim.timeoutWaitTime)}}else{Anim.stop()}if(Anim.firstActiveFrame){Anim.firstActiveFrame=false}Anim.isInFrame=false},start:function(){if(this.isActive||this.isInFrame){return}this.firstActiveFrame=true;this.isActive=true;this._lastFrameTime=-1;this.frameTime=1000/this.fps;this.frameRate=1000/this.frameTime;this.computeTime=0;this.trigger("start");this.nextFrame()},stop:function(){this.isActive=false;this.frameTime=Infinity;this.frameRate=0;this.computeTime=NaN;this.timeoutWaitTime=NaN;this.clearNextTimeout();this.trigger("stop")},clearNextTimeout:function(){if(!this._timeout){return}if(this.useRAF){window.cancelRequestAnimationFrame(this._timeout)}else{clearTimeout(this._timeout)}this._timeout=0},handleTask:function(b){if(!b||b.isDestroyed){return}if(!b._inTasks){if(b.name){for(var c=0,d=Anim.tasks,a;a=d[c];c++){if(a.name===b.name){a.stop()}}}Anim.tasks.push(b)}b._inTasks=true;Anim.start()},tellStop:function(){arguments._isArgs_=true;this.performMethodOn("stop",arguments)},tellFinish:function(){arguments._isArgs_=true;this.performMethodOn("finish",arguments)},performMethodOn:function(b,d){var g=1,e=arguments;if(d&&d._isArgs_){g=0;e=d}for(var c=g,f,a=e.length;c<a;c++){if((f=e[c])&&f[b]){f[b]()}}},IS_OLD_IE:navigator.userAgent.indexOf("MSIE ")!==-1&&parseInt((navigator.userAgent+"").charAt(navigator.userAgent.indexOf("MSIE ")+"MSIE ".length),10)<=8,IS_MOBILE:!!((/ipad/).test(navigator.userAgent.toLowerCase())||(/iphone/).test(navigator.userAgent.toLowerCase())||(/ipod/).test(navigator.userAgent.toLowerCase())||(/android/).test(navigator.userAgent.toLowerCase())),getOpacity:function(b){if(!b){return -1}var a;if(((a=(b.anim$opacity||b.getAttribute("anim$opacity")))&&(a=parseFloat(a)))||a===0){return a}if(((a=(b.style.opacity||Core.getStyle(b,"opacity")))&&(a=parseFloat(a)))||a===0){return a}return 1},setOpacity:function(a,b){if(!a){return -1}b=Math.max(0,Math.min(1,b));if(b>0.9999||isNaN(b)){return this.removeOpacity(a)}a.anim$opacity=b;a.style.opacity=b;return b},removeOpacity:function(a){if(!a){return -1}a.anim$opacity=1;a.style.opacity="";return 1},encodeColor:function(d,c,a){if(typeof d==="object"&&typeof d.r==="number"&&typeof d.g==="number"&&typeof d.b==="number"){c=d.g;a=d.b;d=d.r}else{if(typeof d==="object"){c=d[1];a=d[2];d=d[0]}else{if(typeof d=="string"){if(d.charAt(0)=="#"&&d.length===7){return d}d=Anim.decodeColor(d);c=d[1];a=d[2];d=d[0]}}}d=Math.round(Math.max(0,Math.min(255,d))).toString(16);if(d.length==1){d="0"+d}c=Math.round(Math.max(0,Math.min(255,c))).toString(16);if(c.length==1){c="0"+c}a=Math.round(Math.max(0,Math.min(255,a))).toString(16);if(a.length==1){a="0"+a}return("#"+d+c+a).toUpperCase()},decodeColor:function(d){if(Anim.colors&&Anim.colors[d]){d=Anim.colors[d]}var c,f,e,a;if((c=typeof d)=="number"||c=="object"){return undefined}d=d.replace(/\s+/g,"");if(d.charAt(0)=="#"){if(d.length==4){d="#"+d.charAt(1)+d.charAt(1)+d.charAt(2)+d.charAt(2)+d.charAt(3)+d.charAt(3)}f=parseInt(d.substring(1,3),16);e=parseInt(d.substring(3,5),16);a=parseInt(d.substring(5,7),16)}else{var h;if(d.indexOf("rgba(")!=-1){h=5}else{if(d.indexOf("rgb(")!=-1){h=4}else{return undefined}}d=d.substring(h,d.length-1).split(",");f=parseInt(d[0],10);e=parseInt(d[1],10);a=parseInt(d[2],10)}return[f,e,a]},colors:{red:"#ff0000","orange red":"#ff4500",orange:"#ff7f00",yellow:"#ffff00",green:"#00ff00","forest green":"#228b22",cyan:"#00ffff","light sea green":"#20b2aa",blue:"#0000ff","cornflower blue":"#6495ed","medium blue":"#3232cd",purple:"#a020f0","hot pink":"#ff69b4",magenta:"#ff00ff",white:"#ffffff","light gray":"#d3d3d3",gray:"#bebebe","dark gray":"#a9a9a9","dim gray":"#696969",black:"#000000"},perf:function(b){var a;Anim.perfPop=a=window.open("","Animator","height="+(window.screen.availHeight-19)+",width=500,top=0,left=0");if(!a){if(window.console&&console.log){console.log("No popup available for performance monitor.")}return}a.document.body.innerHTML='<div style="position:absolute; left:0px; top:0px; width:100%; height:100%; overflow:auto"><div style="position:absolute; left:10px; top:10px; right:10px;"></div></div>';a.document.body.style.background="black";if(!Anim.perfPop.updater){Anim.perfPop.updater=Anim.perfPop.setInterval(function(){(function(){try{this.document.body.firstChild.firstChild.innerHTML='<span style="font-family:helvetica,arial,sans-serif; font-size:12px; color:#CCCCCC;"><big>Performance Monitor</big><br>'+Core.strToHtml(this.opener.Anim.status())+"</span>"}catch(c){if(!this.opener||this.opener==this.window){this.close()}}}).call(Anim.perfPop)},b||250)}window.focus()},bogDown:function(){Anim.listen("frame",function(){var a=5;for(var b=0;b<1000000;b++){a=Math.sin(a)}})},status:function(){var a="";a+="\nActive: "+Anim.isActive;a+="\n";a+="\nTarget FPS: "+Anim.fps;a+="\nActual FPS: "+Anim.frameRate;a+="\n";a+="\nFrame Time: "+Anim.frameTime+" ms";a+="\nCompute Time: "+Anim.computeTime+" ms";a+="\nTimeout Wait Time: "+Anim.timeoutWaitTime+" ms";a+="\n";a+="\nSpeed Multiplier: "+Anim.speedMultiplier;a+="\n";a+="\nExtra Status: ";a+="\n"+window.enumerate?window.enumerate(Anim.extraStatus):Anim.extraStatus;a+="\n";a+="\n"+Anim.tasks.length+" Task"+(Anim.tasks.length==1?"":"s")+":";a+="\n"+Anim.tasks.join("\n");return a}});Anim.Task=Core.Object.extend({className:"Anim.Task",running:false,paused:false,speedMultiplier:1,frameCount:0,elapsedTime:0,ticked:false,tickCount:0,start:function(){if(this.running){return this}this.running=true;this.elapsedTime=this.frameCount=this.tickCount=0;this.trigger("start");Anim.handleTask(this);return this},stop:function(){if(!this.running){return this}this.running=false;this.trigger("stop");return this},elapse:function elapse(e,d){if(this.isDestroyed){this.running=false;return this}if(!d&&this.shouldSkipFrame&&this.shouldSkipFrame()){return this}if(this._forcedZeroes){e=0;this._forcedZeroes--}e*=this.speedMultiplier;this.trigger("preframe");this.elapsedTime+=e;if(!this.ticked){this.trigger("pretick");if(this.run instanceof Function){this.run(e)}this.tickCount++;this.trigger("tick")}else{for(var f=this.ticked===true?1000/Anim.fps:this.ticked,a=1+Math.floor(this.elapsedTime/f),c=a-this.tickCount,b=0;b<c;b++){this.trigger("pretick");if(this.run instanceof Function){this.run(f,b<c-1)}if(this.running){this.trigger("tick")}this.tickCount++}}if(this.running){this.trigger("frame");this.trigger("frame"+this.frameCount)}this.trigger("postFrame");this.clearTrigger("postFrame");this.frameCount++;return this},destroy:function(){if(arguments.callee.base){arguments.callee.base.apply(this,arguments)}this.isDestroyed=true;return this}});Anim.Task.go=function(){var a=this.create.apply(this,arguments);a.start();return a};Anim.tweens={make:function(d){var b=[];for(var c=1,a=arguments.length;c<a;c++){b.push(arguments[c])}return(function(){var e=b;e.l=e.length;var f=Anim.tweens[d]||Anim.tweens.LINEAR;return function(g){e[e.l]=g;return f.apply(this,e)}})()},compound:function(){var a=arguments.length;var d=arguments[a-1];for(var c=0,b;c<a-1&&(b=arguments[c]);c++){if(typeof b==="string"){d=Anim.tweens[b].call(this,d)}else{d=b.call(this,d)}}return d},concat:function(a){var c=arguments.length,b=Math.floor((c-2)/2),k=arguments[c-1],d,h=0,m=0,g=0,e,f,j;for(d=0;d<b;d++){h+=arguments[2*d+2]}for(d=0;d<b;d++){m+=arguments[2*d+2]/h;if(k<m){e=(k-g)/(m-g);j=arguments[2*d+1];if(typeof j==="string"){j=Anim.tweens[j]}f=j.call(this,e);return a!==false?g+f*(m-g):f}g=m}},LINEAR:function(a){return a},BOUNCE:function(f){var e;f=1-f;for(var d=0,c=1;1;d+=c,c/=2){if(f>=(7-4*d)/11){e=c*c-Math.pow((11-6*d-11*f)/4,2);break}}return 1-e},SINE_IN_OUT:function(a){return 0.5-0.5*Math.cos(Math.PI*a)},multiSineInOut:function(c,b){var d=c%1;c=Math.floor(c);for(var a=0;a<c;a++){b=0.5-0.5*Math.cos(Math.PI*b)}if(d){b=(1-d)*b+(d)*(0.5-0.5*Math.cos(Math.PI*b))}return b},QUADRATIC_IN:function(a){return a*a},QUADRATIC_OUT:function(a){return 1-(a=1-a)*a},WEBKIT_EASE:function(a){return Anim.tweens.cubicBezier(0.25,0.1,0.25,1,a)},WEBKIT_LINEAR:function(a){return a},WEBKIT_EASE_IN:function(a){return Anim.tweens.cubicBezier(0.42,0,1,1,a)},WEBKIT_EASE_OUT:function(a){return Anim.tweens.cubicBezier(0,0,0.58,1,a)},WEBKIT_EASE_IN_OUT:function(a){return Anim.tweens.cubicBezier(0.42,0,0.58,1,a)},cubicBezier:function(c,b,g,f,k){var a=5;var e=3*c,r=3*(g-c)-e,n=1-e-r,d=3*b,p=3*(f-b)-d,j=1-d-p,t=1/(200*a),m,l,h,q,s,o;for(h=k,o=0;o<8;o++){q=((n*h+r)*h+e)*h-k;if(Math.abs(q)<t){return((j*h+p)*h+d)*h}s=(3*n*h+2*r)*h+e;if(Math.abs(s)<0.000001){break}h=h-q/s}m=0;l=1;h=k;if(h<m){return((j*m+p)*m+d)*m}if(h>l){return((j*l+p)*l+d)*l}while(m<l){q=((n*h+r)*h+e)*h;if(Math.abs(q-k)<t){return((j*h+p)*h+d)*h}if(k>q){m=h}else{l=h}h=(l-m)*0.5+m}return((j*h+p)*h+d)*h},linearInterpolation:function(a,d){var g=a._length_||(a._length=a.length),c=d*g/g*(g-1),f=Math.floor(c),b=a[f],h=c-f;if(h===0){return b}var e=a[Math.ceil(c)];return b*(1-h)+e*h}};Anim.Animation=Core.Animation=Anim.Task.extend({className:"Anim.Animation",isAnimation:true,init:function(){arguments.callee.base.call(this);if(!this.hasOwnProperty("animateOldIE")){this.animateOldIE=Anim.enableOldIE}if(Anim.IS_OLD_IE&&!this.animateOldIE){this.disabled=true}var f,e,c,b,d,a=this._type.prototype.freevars;if(typeof this.freevars==="string"){this.freevars=this.freevars.split(/\s+/)}if(this.freevars&&!this.freevars.length){this.freevars=[this.freevars]}if(this.freevars&&a&&this.freevars===a){d=[];for(e=0;e<(b||(b=this.freevars.length));e++){d.push(this.freevars[e])}this.freevars=d}if(this.freevars){if(this.speed===undefined&&this.duration===undefined&&!this.signal){this.duration=0}}for(e=-1,b=!!this.freevars&&this.freevars.length;e<b;e++){f=e===-1?this:this.freevars[e];if(typeof f==="string"){this[f].key=f;this.freevars[e]=f=this[f]}f=this.makeFreevarFromHash(f);if(f!==this){this.freevars[e]=f;if(f.key){this[f.key]=f}}}},makeFreevarFromHash:function(h){if(h._isFreevar){return h}var c=Anim.Animation.defaultFreevar,g,a,d,e,f,b,i,k=h===this?this:{};for(d in h){if(!h.hasOwnProperty(d)){continue}if(k!==h){k[d]=h[d]}}if(k===this){for(d in c){if(k[d]===undefined){k[d]=c[d]}}}else{for(d in c){if(!k.hasOwnProperty(d)){k[d]=c[d]}}}if(k.signal){k.tween=undefined;g=this._returnExtendedFreevar(k,Anim.Animation._signalFreevar);g._unsignaledCurrent=g.from}else{if(k.inertia){k.tween=undefined;g=this._returnExtendedFreevar(k,Anim.Animation._inertiaFreevar);g._undampedCurrent=g.from;g.inertia!==true||(g.inertia=Anim.Animation._inertiaFreevar.prototype.inertia);a=[];for(d=0;d<k.inertia-1;d++){a[d]=g._undampedCurrent}g.inertiaChain=a}else{g=this._returnExtendedFreevar(k,Anim.Animation._tweenFreevar);g._untweenedCurrent=k.from;if(typeof g.speed==="number"){g.duration=undefined}}}g._isFreevar=true;g.freevarRun(0);return g},_returnExtendedFreevar:function(b,c){if(b===this){for(var a in c.prototype){if(this[a]===undefined){this[a]=c.prototype[a]}}return this}else{return new c(b)}},addFreevar:function(a){if(!a){return}if(a.key&&this[a.key]){return false}a=this.makeFreevarFromHash(a);if(a.key){this[a.key]=a}(this.freevars||(this.freevars=[])).push(a);return this},removeFreevar:function(b){if(typeof b==="string"){b=this[b]}if(!b||!b._isFreevar){return null}if(!this.freevars||!this.freevars.length){return null}if(b.key){this[b.key]=undefined}for(var a=0;a<this.freevars.length;a++){if(this.freevars[a]===b){this.freevars.splice(a--,1)}}return b},allFreevarsDo:function(b,e){var d,h,c=arguments.callee.args||(arguments.callee.args=[]);c.length=0;for(var g=1,a=arguments.length;g<a;g++){c.push(arguments[g])}this[b].apply(this,c);if(!(d=this.freevars)){return this}for(g=0;h=d[g];g++){h[b].apply(h,c)}return this},forceAll:function(a){this.allFreevarsDo("force",a);return this},resetAll:function(){this.allFreevarsDo("reset");return this},reverseAll:function(a){this.allFreevarsDo("reverse");return this},run:function run(g,c){var a=true;var d=1;var f=Infinity;var h;for(var e=-1,b=(!!this.freevars&&this.freevars.length)||0;e<b;e++){h=(this.freevars&&this.freevars[e])||this;if(!h.freevarRun(g)){a=false}if(h.progress<d){d=h.progress}if(h.tweenedProgress<f){f=h.tweenedProgress}}if(this.freevars){this.progress=d;this.tweenedProgress=f}if(!c){this.update()}if(a){this.listen("postFrame",this._finishNaturally)}},start:function(){if(this.running){return this}if(this.disabled){this.allFreevarsDo("zeroOutDuration")}if(Anim._hasSC){var a=SC.RunLoop.isRunLoopInProgress();if(!a){SC.RunLoop.begin()}}var b=arguments.callee.base.apply(this,arguments);if(Anim.isActive){this.update();this.trigger("tick");this.trigger("frame")}if(!a&&Anim._hasSC){SC.RunLoop.end()}return b},finish:function(a,c){if(!this.running){return this}if(!a){this.allFreevarsDo("force");if(!c){this.update();this.trigger("tick");this.trigger("frame")}}var b=this.stop();this.trigger("finish");if(this.repeat>0){this.repeat--;if(this.reverseOnRepeat){this.reverse()}else{this.reset()}this.start()}return b},_finishNaturally:function(){this.finish(true)},update:function(){},toString:function(){var a=arguments.callee.base.apply(this,arguments);a=a.substring(0,a.length-1)+(this.name?(" "+this.name):"")+(this.running?" running":"")+((this.freevars||this.inertia)?"":(" "+this.from+"-to-"+this.to+" "+this.duration+"ms "+Math.round(this.progress*100)+"%"))+"]";return a},destroy:function(){var a=arguments.callee.base.apply(this,arguments);this.update=this.run=this.finish=Core.noOp;return a},recycle:function(){this.allFreevarsDo("reset");this.tickCount=this.frameCount=this.elapsedTime=this._forcedZeroes=0}});Anim.Animation.defaultFreevar={tween:Anim.tweens.WEBKIT_EASE,discreteness:0};Anim.Animation._tweenFreevar=(function(){var a=function(c){for(var d in c){if(c.hasOwnProperty(d)){this[d]=c[d]}}};a.prototype={from:0,to:1,duration:1000,importants:undefined,isAlmostFinished:function(c){return Math.abs(this.to-this.current)<c},reverse:function(){var c=this.to;this.to=this.from;this.from=c;this.freevarRun(0);return this},reset:function(){this._untweenedCurrent=this.from;this.freevarRun(0);return this},redirectTo:function(c){if(c===this.to){return this}this.from=this.current;this.to=c;this._untweenedCurrent=this.from;this.freevarRun(0);return this},redirectFrom:function(c){this.from=this._untweenedCurrent=c;this.freevarRun(0);return this},zeroOutDuration:function(){!this.duration||(this.duration=0);!this.speed||(this.speed=Infinity);return this},force:function(c){if(typeof c==="number"){this.to=c}this._untweenedCurrent=this.to;this.freevarRun(0);return this},freevarRun:function b(j){if(this.duration===0||this.speed===Infinity){this._untweenedCurrent=this.to}var i=this,e=i._untweenedCurrent<i.to,h=i.isFinished=(i._untweenedCurrent===i.to),d=i.importants?(i.importants[i._impSpot||0]||undefined):undefined,c=d!==undefined?i._untweenedCurrent<d:undefined,k,g;if(i.to===i.from){i.current=i._untweenedCurrent=i.to;return i.isFinished=true}if(!h){g=i.speed||1000/i.duration*Math.abs(i.to-i.from);k=Math.abs(g*j/1000);if(e){i._untweenedCurrent+=k}else{i._untweenedCurrent-=k}if((c===true&&i._untweenedCurrent>d)||(c===false&&i._untweenedCurrent<d)){i._untweenedCurrent=d;i._impSpot=(i._impSpot||0)+1}if((i.isFinished=(e&&i._untweenedCurrent>=i.to)||(!e&&i._untweenedCurrent<=i.to))){i._untweenedCurrent=i.to}}if(i.from!==undefined&&i.to!==undefined){i.progress=(i._untweenedCurrent-i.from)/(i.to-i.from);if(i.tween instanceof Function&&i.from!=i.to){if(i.from===0&&i.to===1){i.current=i.tweenedProgress=i.tween.call(this,i._untweenedCurrent)}else{i.current=(i.tweenedProgress=i.tween.call(this,i.progress))*(i.to-i.from)+i.from}}}else{i.current=i._untweenedCurrent}if(i.discreteness&&Math.abs(i.to/i.discreteness)%1<1e-8){i.current=Math.round(i.current/i.discreteness)*i.discreteness}return i.isFinished}};a._freevarPrototype=a;return a})();Anim.Animation._inertiaFreevar=(function(){var b=function(c){for(var d in c){if(c.hasOwnProperty(d)){this[d]=c[d]}}};b.prototype={from:0,to:1,speed:1,inertia:3,headStart:0.01,isAlmostFinished:function(c){return Math.abs(this.to-this.current)<c},reverse:function(){var c=this.to;this.to=this.from;this.from=c;return this},reset:function(){var c=this.to;this.force(this.from);this.to=c;return this},redirectTo:function(c){this.from=this.current;this.to=c;return this},redirectFrom:function(f){var e=f-this.current;this.from=f;this._undampedCurrent+=e;for(var d=0,c=this.inertiaChain.length;d<c;d++){this.inertiaChain[d]+=e}this.freevarRun(0);return this},zeroOutDuration:function(){this.speed=Infinity;return this},force:function(d){if(typeof d==="number"){this.to=d}this._undampedCurrent=this.current=this.to;for(var e=0,c=this.inertiaChain.length;e<c;e++){this.inertiaChain[e]=this.to}return this},freevarRun:function a(g){if(this.speed===Infinity){this.force()}var k,l=this,e,m,h=l.speed,d=l.inertiaChain,j,n,c;for(k=0;k<l.inertia;k++){if(k===0){e=l._undampedCurrent;m=l.to}else{if(k===1){e=d[0];m=l._undampedCurrent}else{e=d[k-1];m=d[k-2]}}if(e===m){continue}j=e<m;n=g/1000*h*Math.abs(m+l.headStart*(2*j-1)-e);if(j){e+=n}else{e-=n}if((c=(j&&e>=m)||(!j&&e<=m))){e=m}if(k===0){l._undampedCurrent=e}else{d[k-1]=e}}l.current=e;if(l.discreteness&&Math.abs(l.to/l.discreteness)%1<1e-8){l.current=Math.round(l.current/l.discreteness)*l.discreteness}l.isFinished=l.to===l.current;l.progress=NaN;return l.isFinished}};b._freevarPrototype=b;return b})();Anim.Animation._signalFreevar=(function(){var a=function(c){for(var d in c){if(c.hasOwnProperty(d)){this[d]=c[d]}}};a.prototype={speed:1,from:0,signal:function(c){return 0.5+0.5*Math.sin(c*Math.PI*2)},persistent:true,isAlmostFinished:function(c){return !this.persistent},reverse:function(){this.speed=-this.speed;return this},reset:function(){this._unsignaledCurrent=this.from;return this},redirectTo:function(){return this},force:function(){return this},advance:function(c){this._unsignaledCurrent+=c},zeroOutDuration:function(){return this},freevarRun:function b(c){this._unsignaledCurrent+=c/1000*this.speed;this.current=this.signal(this._unsignaledCurrent);if(this.discreteness){this.current=Math.round(this.current/this.discreteness)*this.discreteness}this.isFinished=!this.persistent;this.progress=NaN;return this.isFinished}};a._freevarPrototype=a;return a})();Anim.Fader=Anim.Animation.extend({className:"Anim.Fader",update:function(){Anim.setOpacity(this.element,this.current)},init:function(){if(this.from===undefined){this._untweenedCurrent=this.from=Anim.getOpacity(this.element)}arguments.callee.base.apply(this,arguments)},_removeOnFinish:function(){if(!this.REMOVE_ON_FINISH){return}if(this.element.parentNode){this.element.parentNode.removeChild(this.element)}}.observes("finish"),saveSelf:function(){var a=this.element._animFader;if(a){a.stop()}this.element._animFader=this}.observes("start"),killSelf:function(){this.element._animFader=undefined}.observes("stop")});Anim.DisplayNoneAtZero={isMixin:true,setDisplayNone:function(){if(this.to===0){this.element.style.display="none"}}.observes("finish"),removeDisplayNone:function(){this.element.style.display=""}.observes("start")};(function(){var b=window.location.toString(),c=window.location.toString().indexOf("nogpu")!==-1,a=!c&&window.location.toString().indexOf("gpu")!==-1;Core.maxGPUTextureSize=B.mobile?1024:1950;Core.useGPU=!!B.iOS;Core.useGPUForBigs=B.safari||B.chrome||B.iOS;Core.useGPU=(Core.useGPU||a)&&!c;Core.useGPUForBigs=(Core.useGPUForBigs||a)&&!c})();require("utilities/gpu_prefs");Core.GPUFriendliness={isMixin:YES,maxLayerSize:{width:Core.maxGPUTextureSize,height:Core.maxGPUTextureSize},rootHTML:'<div><div class="container"></div></div>',containerElement:"layer.firstChild",isGPUFriendly:NO,layout:{originX:0.5,originY:0.5,translateX:0,translateY:0,scale:1,top:0,left:0,width:0,height:0},_ensureLayout:function(){this.ensureOwn("layout")}.observes("init"),updateToGPUFriendliness:function(){var a=this.isGPUFriendly;if(!this.layer||this._igf_===(this._igf_=a)){return}if(a){this.becomeGPUFriendly()}else{this.returnToFullRes()}}.observes("isGPUFriendly"),becomeGPUFriendlyIfNeeded:function(){if(this.isGPUFriendly&&!this._hasBecomeGPUFriendly){this.becomeGPUFriendly()}}.observes("layout"),becomeGPUFriendly:function(){if(!this.layout||!this.layout.width||!this.layout.height){return NO}this._hasBecomeGPUFriendly=YES;var b=this.layer,h=this.container,f=this.layout;var e=Core.innerSizeInOuter(f,this.maxLayerSize),g=Math.min(1,e.width/f.width);b.style.overflow=h.style.overflow="hidden";b.style.width=Math.round(Math.min(e.width,f.width))+"px";b.style.height=Math.round(Math.min(e.height,f.height))+"px";b.style.webkitTransformOrigin=h.style.webkitTransformOrigin="0 0";h.style.webkitTransform="scale("+g+")";var d=f.translateX-f.originX*(f.scale-1)*f.width,a=f.translateY-f.originY*(f.scale-1)*f.height;b.style.webkitTransform="translateX("+d+"px) translateY("+a+"px) scale3d("+(f.scale/g)+","+(f.scale/g)+",1)";return YES},returnToFullRes:function(){var a=this.layer,b=this.container;a.style.overflow=b.style.overflow="";a.style.width=Math.round(this.layout.width)+"px";a.style.height=Math.round(this.layout.height)+"px";a.style.webkitTransform=b.style.webkitTransform="";a.style.webkitTransformOrigin=b.style.webkitTransformOrigin=""},updateToLayout:function(){var b=this.layer,i=this.container,g=this.layout,f=Math.round;if(!b||!i){return}b=b.style;i=i.style;if(!g.width||!g.height){return}var e,h;if(this.isGPUFriendly){e=Core.innerSizeInOuter(g,this.maxLayerSize);h=Math.min(1,e.width/this.layout.width);b.width=f(Math.min(e.width,g.width))+"px";b.height=f(Math.min(e.height,g.height))+"px";i.webkitTransform="scale("+h+")";var d=g.translateX-g.originX*(g.scale-1)*g.width,a=g.translateY-g.originY*(g.scale-1)*g.height;b.webkitTransform="translateX("+d+"px) translateY("+a+"px) scale3d("+(g.scale/h)+","+(g.scale/h)+",1)"}else{b.width=f(g.width)+"px";b.height=f(g.height)+"px"}i.width=f(g.width)+"px";i.height=f(g.height)+"px";b.left=f(g.left)+"px";b.top=f(g.top)+"px";i.left==="0px"||(i.left="0px");i.top==="0px"||(i.top="0px")}.observes("layout")};Core.PinchZoomability={isMixin:YES,hasPinchZoomability:YES,allowZoom:YES,enableOwnerSwipability:NO,zoomState:null,defendAgainstAbnormallyFastFlicks:NO,defaultZoomState:{zoom:1,y:0,x:0},neverLockXAxis:NO,neverLockYAxis:NO,maximumZoom:6,speedFractionPerTick:0.993,speedAsymptoteBoost:0,shouldSnapToTop:NO,shouldSnapToLeft:NO,touchIgnoreTest:function(){return NO},resetZoom:function(a){this.computeBoundedZoomHash(this.defaultZoomState,this.zoomState||(this.zoomState={}));if(!a){this.trigger("zoomState")}},_initZoom:function(){this.resetZoom(YES)}.observes("init"),touchStart:function(b){if(!b||!this.allowZoom||this.touchIgnoreTest(b)){return}b.preventDefault();if(b.touches.length>2){return}var a=this._getScaleGestureInfo(b);if(!a){return}if(this.enableOwnerSwipability&&this.owner.isCommittingSwipe){this.owner.forceFinishCurrentSwipeCommittal()}this.determineAxisLock(b);Core.cloneHash(a,this._initialGestureInfo||(this._initialGestureInfo={}));Core.cloneHash(this._candidateZoom||this.zoomState,this._initialZoomInfo||(this._initialZoomInfo={}));Anim.tellStop(this._pinchZoomAnimation);this._isZoomReadyForMove=YES},touchEnd:function(b){if(b&&b.touches.length>2||!this.allowZoom){return}if(!b||!b.touches||!b.touches.length){this._candidateZoom=null}var a=this._initialGestureInfo;if(!a){return}if(!b.touches.length){this._isZoomReadyForMove=NO;this.setIfChanged("isZoomTouching",NO);a.separation=a.centerX=a.centerY=NaN;this.animateAfterTouch();this.cleanUpAfterTouch();if(this.enableOwnerSwipability){this.owner.swipeTouchDidEnd();this._isSwiping=NO;this._hasForfeitedRightSwipe=NO;this._hasForfeitedLeftSwipe=NO;this._wasSwipeRejected=NO}}else{this.touchStart(b)}this._previousTouchDate=NaN},touchMove:function(g){if(!this._isZoomReadyForMove||!this.allowZoom){return}g.preventDefault();var h=this._getScaleGestureInfo(g);if(!h){return}var q=this.zoomContainerSize,j=this.zoomContentSize,i=this._initialGestureInfo,o=this._initialZoomInfo,a=i.separation===0?1:(h.separation/i.separation||1),n=Math.min(this.maximumZoom,Math.max(0.025,o.zoom*a)),m=n/o.zoom,k=h.centerX-i.centerX+(m-1)*(o.x+q.width/2-i.centerX),c=h.centerY-i.centerY+(m-1)*(o.y+q.height/2-i.centerY),b=this._candidateZoom||(this._candidateZoom={}),p,l,d,f;if(this.enableOwnerSwipability){if(g.touches.length===1){d=this.computeBoundedZoomHash(this.zoomState,this._boundedTestHashRecycler||(this._boundedTestHashRecycler={}));f=this.zoomState.zoom*j.width<=q.width;p=this.getRightBoundaryX();if(!this._isSwiping&&(p===this.zoomState.x||(f&&d.x===this.zoomState.x))&&!this._hasForfeitedLeftSwipe){if(h.centerX<i.centerX){this._isSwiping="left";this._isXAxisLocked=YES}}if(f&&p<this.zoomState.x-2){this._hasForfeitedLeftSwipe=YES}if(this._isSwiping==="left"){if(!d&&(h.centerX>i.centerX||this._wasSwipeRejected)){this._isSwiping=NO;this._hasForfeitedLeftSwipe=YES;this._isXAxisLocked=NO}if(!this._hasForfeitedLeftSwipe){if(this.owner.swipeToOffset(h.centerX-i.centerX)){this._wasSwipeRejected=YES}}}l=this.getLeftBoundaryX();if(!this._isSwiping&&(l===this.zoomState.x||(f&&d.x===this.zoomState.x))&&!this._hasForfeitedRightSwipe){if(h.centerX>i.centerX){this._isSwiping="right";this._isXAxisLocked=YES}}if(f&&l>this.zoomState.x+2){this._hasForfeitedRightSwipe=YES}if(this._isSwiping==="right"){if(!d&&(h.centerX<i.centerX||this._wasSwipeRejected)){this._isSwiping=NO;this._hasForfeitedRightSwipe=YES;this._isXAxisLocked=NO}if(!this._hasForfeitedRightSwipe){if(this.owner.swipeToOffset(h.centerX-i.centerX)){this._wasSwipeRejected=YES}}}}else{this.owner.cancelSwipe()}}b.zoom=n;b.x=o.x+!this._isXAxisLocked*k;b.y=o.y+!this._isYAxisLocked*c;this.computeCompromiseZoomHash(b,this.zoomState);if(g.touches.length===1){this._ppTouchDate=this._previousTouchDate;this._previousTouchDate=new Date*1;if(!this._isXAxisLocked){this._ppTouchX=this._previousTouchX;this._previousTouchX=h.centerX}if(!this._isYAxisLocked){this._ppTouchY=this._previousTouchY;this._previousTouchY=h.centerY}}else{this._previousTouchDate=NaN}this.setIfChanged("isZoomTouching",YES);this.trigger("zoomState")},touchCancel:function(a){return this.touchEnd.apply(this,arguments)},determineAxisLock:function(f){var c=this.zoomContainerSize,b=this.zoomContentSize,d=this.zoomState,a=this.computeBoundedZoomHash(d,this._axisLockBoundTester||(this._axisLockBoundTester={}));this._isXAxisLocked=NO;this._isYAxisLocked=NO;if(!c||!b||!a||!f||!f.touches||f.touches.length>1){return}if(a.x===d.x&&b.width*d.zoom<=c.width){this._isXAxisLocked=!this.neverLockXAxis}if(a.y===d.y&&b.height*d.zoom<=c.height){this._isYAxisLocked=!this.neverLockYAxis}},cleanUpAfterTouch:function(){this._isYAxisLocked=this._isXAxisLocked=NO;this._ppTouchY=this._ppTouchX=this._ppTouchDate=this._previousTouchY=this._previousTouchX=this._previousTouchDate=NaN},_getScaleGestureInfo:function(c){if(!c.touches.length){return null}var g=this._gsgiVessel||(this._gsgiVessel={}),i,f,b,k,a,j,m,l,h;i=c.touches[0];f=c.touches[1]||i;b=i.clientX;k=i.clientY;a=f.clientX;j=f.clientY;m=a-b;l=j-k;h=Math.sqrt(l*l+m*m);g.separation=h;g.centerX=(a+b)/2;g.centerY=(j+k)/2;return g},animateAfterTouch:function(){var a=this.zoomState;if(!a||!this.allowZoom){return}Anim.tellStop(this._pinchZoomAnimation);if(a.zoom>=1&&this._ppTouchDate&&this._previousTouchDate){this._pinchZoomAnimation=this.InertiaAnimation.go({owner:this})}else{if(true){this._pinchZoomAnimation=this.SnapBackAnimation.go({owner:this})}else{this.setIfChanged("isZoomHappening",NO)}}},computeBoundedZoomHash:function(b,e){Core.cloneHash(b,e||(e={}));var d=this.zoomContentSize,c=this.zoomContainerSize,a;if(!d||!c){return}if(b.zoom<1){e.zoom=1}a=d.width/2*e.zoom-c.width/2;if(d.width*e.zoom<c.width){e.x=this.shouldSnapToLeft?a:0}else{if(e.x<-a){e.x=-a}else{if(e.x>a){e.x=a}}}a=d.height/2*e.zoom-c.height/2;if(d.height*e.zoom<c.height){e.y=this.shouldSnapToTop?a:0}else{if(e.y<-a){e.y=-a}else{if(e.y>a){e.y=a}}}return e},getLeftBoundaryX:function(){return(this.zoomContentSize.width/2*this.zoomState.zoom-this.zoomContainerSize.width/2)},getRightBoundaryX:function(){return -(this.zoomContentSize.width/2*this.zoomState.zoom-this.zoomContainerSize.width/2)},computeCompromiseZoomHash:function(a,b,c){this.computeBoundedZoomHash(a,b||(b={}));if(c){Core.cloneHash(b,c)}b.zoom=(a.zoom+b.zoom)/2;b.x=(a.x+b.x)/2;b.y=(a.y+b.y)/2;return b},areZoomHashesEqual:function(b,a){return b.zoom===a.zoom&&b.x===a.x&&b.y===a.y},SnapBackAnimation:Anim.Animation.extend({duration:350,saveStartState:function(){this.owner.computeBoundedZoomHash(this.owner.zoomState,this.toZoom={});Core.cloneHash(this.owner.zoomState,this.fromZoom||(this.fromZoom={}))}.observes("start"),update:function(){var b=this.current,a=1-b,e=this.fromZoom,d=this.owner.zoomState,c=this.toZoom;d.zoom=c.zoom*b+a*e.zoom;d.x=c.x*b+a*e.x;d.y=c.y*b+a*e.y;this.owner.trigger("zoomState")},killSelfAndIsZoomHappening:function(){this.owner._pinchZoomAnimation=null;this.owner.setIfChanged("isZoomHappening",NO)}.observes("finish")}),InertiaAnimation:Anim.Task.extend({ticked:2,computeInitialSpeed:function(){var d=this.owner,a=((d._previousTouchDate-d._ppTouchDate)/(this.ticked||16))||Infinity,b,c;this.x={name:"x",speed:((d._previousTouchX-d._ppTouchX)||0)/a,current:d.zoomState.x};this.y={name:"y",speed:((d._previousTouchY-d._ppTouchY)||0)/a,current:d.zoomState.y};if(this.owner.defendAgainstAbnormallyFastFlicks){if(this.owner._zoomHappeningStartTime>=new Date*1-500){c=5*(this.owner.zoomContainerSize.width/2+this.owner.zoomContainerSize.height/2)/896;b=Math.sqrt(this.x.speed*this.x.speed+this.y.speed*this.y.speed);if(b>c){this.x.speed*=c/b;this.y.speed*=c/b}}}}.observes("start"),killSelfAndIsZoomHappening:function(){this.owner._pinchZoomAnimation=null;this.owner.setIfChanged("isZoomHappening",NO)}.observes("finish"),run:function(c,b){var a=this.owner.computeBoundedZoomHash(this.owner.zoomState,this._closestBound||(this._closestBound={}));this.runComponent(this.x,c,a.x);this.runComponent(this.y,c,a.y);if(!isNaN(this.x.current)){this.owner.zoomState.x=this.x.current}if(!isNaN(this.y.current)){this.owner.zoomState.y=this.y.current}if(Math.abs(this.x.speed||0)<0.001&&Math.abs(this.y.speed||0)<0.001){this.trigger("finish");this.stop()}if(!b){this.owner.trigger("zoomState")}},runComponent:function(a,f,c){if(a.turnedAround){return}var e=!isNaN(a.bound);if(!e){if(a.current!==c){a.bound=c;a.behindBound=a.current<c;a.aheadOfBound=!a.behindBound;e=YES}}if(e){a.speed+=(a.behindBound?1:-1)*Math.abs(a.bound-a.current)/50*f/16;if(!a.turnedAround&&((a.behindBound&&a.speed>0)||(!a.behindBound&&a.speed<0))){a.turnedAround=YES}if(a.turnedAround){a.speed=Infinity;a.snapBackAnim=Anim.Animation.go({owner:this,stopper:function(){if(!a.snapBackAnim){return}a.snapBackAnim=null;a.speed=0;this.stop()}.observes(".owner.stop","stop"),inertia:4,speed:20,headStart:1,from:a.current,to:a.bound,update:function(){a.current=this.current}})}}var b=a.speed>0,d=b?1:-1;if(a.speed){a.speed+=d*this.owner.speedAsymptoteBoost;a.speed*=this.owner.speedFractionPerTick;a.speed-=d*this.owner.speedAsymptoteBoost;if((b&&a.speed<=0)||(!b&&a.speed>=0)){a.speed=0}}if(!a.snapBackAnim){a.current+=a.speed}}}),bumpIsZoomHappening:function(){if(!this.isZoomTouching){return}this.setIfChanged("isZoomHappening",YES)}.observes("isZoomTouching"),prepareForFastFlickDefense:function(){if(!this.defendAgainstAbnormallyFastFlicks){return}this._zoomHappeningStartTime=new Date()*1}.observes("isZoomHappening")};Core.FadeShowHide={isMixin:YES,disableFade:NO,duration:350,shouldShow:YES,showHideAnimationExample:Anim.Fader,_watchShouldShow:function(){if(!this.layer||this._lastShouldShow===(this._lastShouldShow=this.shouldShow)){return}if(this.isRenderingLayer){this.initiallyAppended=this.shouldShow}this[this.shouldShow?"show":"hide"](this.isRenderingLayer)}.observes("shouldShow","render"),show:function(b){if(this.isShowing===YES){return}this.set("isShowing",YES);Anim.tellStop(this._showHider);var a=this.showDuration||this.duration;if(isNaN(a)||this.disableFade){b=YES}if(b){return this.append()}this._showHider=this.showHideAnimationExample.go({owner:this,element:this.layer,to:1,duration:a,append:function(){this.owner.append()}.observes("start")})},hide:function(b){if(this.isShowing===NO){return}this.set("isShowing",NO);Anim.tellStop(this._showHider);var a=this.hideDuration||this.duration;if(isNaN(a)||this.disableFade){b=YES}if(b){return this.remove()}this._showHider=this.showHideAnimationExample.go({owner:this,element:this.layer,to:0,duration:a,remove:function(){this.owner.remove()}.observes("finish")})},finishTransition:function(){Anim.tellFinish(this._showHider)}};Core.WaitSupport={isMixin:YES,hasWaitSupport:YES,shouldFireWithoutReqs:NO,numReqs:0,_waitSupport_reqsCompleted:0,_waitSupport_initWarning:function(){},forceWaitCompletion:function(){this._waitSupport_allReqsDidComplete()},init:function(){var a=this.shouldFireWithoutReqs;if(a){this.openReq()}arguments.callee.base.apply(this,arguments);var b=this._waitSupport_subclass_init;if(b){b.apply(this)}if(a){this.closeReq()}},initOverride:function(c,a,b){c.base=this._waitSupport_subclass_init||this._waitSupport_initWarning;this._waitSupport_subclass_init=c;return a},openReq:function(){this.numReqs++},closeReq:function(){var a=this._waitSupport_reqsCompleted,b=this.numReqs;if(a===b){return}this._waitSupport_reqsCompleted=a=a+1;if(a===b){this._waitSupport_allReqsDidComplete()}},_waitSupport_allReqsDidComplete:function(){if(this._didComplete===(this._didComplete=YES)){return}this.trigger("waitDidComplete")}};Core.KeyCodes={ARROW_LEFT:37,ARROW_RIGHT:39,ESCAPE:27};Core.KeyActions={};(function(){var a=Core.KeyCodes,b=Core.KeyActions;b[a.ARROW_LEFT]="ArrowLeft";b[a.ARROW_RIGHT]="ArrowRight";b[a.ESCAPE]="Escape"})();Core.KeyEventRootResponder=Core.Object.extend({eventKeys:"keydown keyup keypress".w(),responder:null,registerKeyEventHandlers:function(){var e=this,d=this.eventKeys;var c=function(f){e.handleKeyEvent.call(e,f)};for(var b=0,a;a=d[b];b+=1){Core.addEvent(document,a,c)}}.observes("init"),handleKeyEvent:function(e){var a=this.get("responder"),d,c=e.type.toLowerCase(),f=e.keyCode,b=Core.KeyActions[f];if(!a){return}d=a[c+"For"+b];if(d instanceof Function){d.call(a,e);return}d=a[c];if(d instanceof Function){d.call(a,e)}}});Core.KeyEventRootResponder.responder=Core.KeyEventRootResponder;Core.mixin({setupKeyEventRootResponder:function(){var a=Core.KeyEventRootResponder.responder;Core.set("keyEventRootResponder",a.create())}.observes("finalizeCore")});Core.Locale=Core.Object.extend({strings:{},locString:function(a){var b=this.strings[a];return b||a}});(function(){var a=Core.Locale;a.locales={};a.localeClassFor=function(d){var c,b=this.locales[d];if(!b){this.locales[d]=b=Core.Locale.extend()}return b};a.createCurrentLocale=function(){var c=String.preferredLanguage||navigator.language;var b=this.localeClassFor(c);if(c!==this.currentLanguage){this.currentLanguage=c;this.currentLocale=b.create()}return this.currentLocale};a.addStrings=function(b){this.prototype.strings=b;return this}})();Core.stringsFor=function(c,b){var a=Core.Locale.localeClassFor(c);a.addStrings(b);return this};Core.mixin({_b64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",enbase64:function(w){if(window.btoa){try{return btoa(w)}finally{}}if(!w){return w}var k=Core._b64,t=0,v=0,d="",j=Core._tmpArr||(Core._tmpArr=[]),b="",o=w.length,a=String.fromCharCode,s,r,p,h,g,f,e,q,m,u;j.length=0;w=w.toString().replace(/\r\n/g,"\n");for(m=0;m<o;m++){if((u=w.charCodeAt(m))<128){b+=a(u)}else{if(u>127&&u<2048){b+=a((u>>6)|192);b+=a((u&63)|128)}else{b+=a((u>>12)|224);b+=a(((u>>6)&63)|128);b+=a((u&63)|128)}}}w=b;do{s=w.charCodeAt(t++);r=w.charCodeAt(t++);p=w.charCodeAt(t++);q=s<<16|r<<8|p;h=q>>18&63;g=q>>12&63;f=q>>6&63;e=q&63;j[v++]=k.charAt(h)+k.charAt(g)+k.charAt(f)+k.charAt(e)}while(t<w.length);d=j.join("");switch(w.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"=";break}return d},debase64:function(l){if(window.atob){try{return atob(l)}finally{}}var k=Core._b64,a="",f=0,s,q,o,r,p,n,m;l=l.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<l.length){r=k.indexOf(l.charAt(f++));p=k.indexOf(l.charAt(f++));n=k.indexOf(l.charAt(f++));m=k.indexOf(l.charAt(f++));s=(r<<2)|(p>>4);q=((p&15)<<4)|(n>>2);o=((n&3)<<6)|m;a+=String.fromCharCode(s);if(n!==64){a=a+String.fromCharCode(q)}if(m!==64){a=a+String.fromCharCode(o)}}var e=0,g="",h,d,b;while(e<a.length){h=a.charCodeAt(e);if(h<128){g+=String.fromCharCode(h);e++}else{if(h>191&&h<224){d=a.charCodeAt(e+1);g+=String.fromCharCode(((h&31)<<6)|(d&63));e+=2}else{d=a.charCodeAt(e+1);b=a.charCodeAt(e+2);g+=String.fromCharCode(((h&15)<<12)|((d&63)<<6)|(b&63));e+=3}}}return g}});Core.bodyOverflowArbitrator=Core.Object.create({requestHidden:function(b,a){this._makeRequest(b,-1-9*!!a)},requestVisible:function(b,a){this._makeRequest(b,1+9*!!a)},withdrawRequest:function(b){if(!b){return}var a=Core.guidFor(b);if(this._requests[a]){delete this._requests[a];this.setOverflow()}},setOverflow:function(){var a=this._decideOverflow();if(a!==undefined){document.body.style.overflow=a?"auto":"hidden"}},_makeRequest:function(c,b){if(!c){return}var a=Core.guidFor(c);if(this._requests[a]===(this._requests[a]=b)){return}this.setOverflow()},_requests:{},_decideOverflow:function(){var a,e,c,f,b=this._requests,g;for(var d in b){if((g=b[d])<0){a=YES}if(g<-1){c=YES}if(g>0){e=YES}if(g>1){f=YES}}if(f){return YES}if(e&&c){return NO}if(e){return YES}if(a){return NO}return YES}});Core.mixin({strToHtml:function(a){return a.split("\n").join("<BR>").split("  ").join(" &nbsp;")},toCamel:function(d,c){d||(d="");for(var b=0,a=d.length;b<a;b++){if(d.charAt(b)!=="-"||b==a-1){continue}d=d.substring(0,b)+d.charAt(b+1).toUpperCase()+d.substring(b+2);a--}return c?(d.charAt(0).toUpperCase()+d.substring(1)):d},toDashed:function(e,b){e||(e="");for(var d=0,a=e.length;d<a;d++){var f=e.charAt(d);if(f.toLowerCase()===f||d==a-1){continue}e=e.substring(0,d)+"-"+e.charAt(d).toLowerCase()+e.substring(d+1);a++}return b&&e.charAt(0)==="-"?e.substring(1):e},getStyle:function(b,a){if(b.currentStyle){return b.currentStyle[Core.toCamel(a)]}if(b.initialStyle){return b.initialStyle.getPropertyValue(a)}var c;if((c=document.defaultView)&&(c=(c.getComputedStyle))){return(b.initialStyle=c(b,null)).getPropertyValue(a)}},addEvent:function(el,name,func,capture){if(el.addEventListener){return el.addEventListener(name,func,!!capture)}if(el.attachEvent){return el.attachEvent("on"+name,function(){return func.apply(el,arguments)})}var old=el["on"+name];var listener=old?function(){if(typeof old==="string"){eval(old)}else{old.apply(this,arguments)}func.apply(this,arguments)}:func;return el["on"+name]=listener},positionOfElement:function(c){var a=0,e=0,d=c;do{a+=d.offsetTop||0;e+=d.offsetLeft||0;d=d.offsetParent}while(d);var b=c._posHash||(c._posHash={});b.left=e;b.top=a;return b},hideIOSAddressBar:function(a){clearTimeout(Core._hideIOSABTimeout);if(!B.iOS){return}if(Core.scrollTop()>=10){return}if(a){Core._hideIOSABTimeout=setTimeout(Core._hideIOSAddressBar,a)}else{Core._hideIOSAddressBar()}},_hideIOSAddressBar:function(){Core.scrollTop(0)},scrollTop:function(c){var a=document.body,b=document.documentElement;if(!a||!b){return}if(isNaN(c)){return a.scrollTop||b.scrollTop}window.scrollTo(a.scrollLeft||b.scrollLeft||0,c);return c},lastScrollTop:0,_saveScrollTop:function(){Core.setIfChanged("lastScrollTop",Core.scrollTop())}});Core.addEvent(window,"scroll",Core._saveScrollTop);Core.addEventToElement=Core.addEvent;Core.mixin({emptyObject:{},emptyArray:[],emptyFunction:function(){},emptyImageSrc:"data:image/gif;base64,R0lGODlhAQABAJAAAP///wAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw=="});(function(){var b=/[&<>]/g,a=function(c){switch(c){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;"}};Core.escapeHTML=function(c){if(!c){return c}return c.replace(b,a)}})();Core.JSONProcessor=Core.Object.extend({processJSONObject:function(x,f,a,D,h,t){a||(a="");t||(t=[]);D=(D||0)+1;h||(h=x);if(!x||!f){return}t.push(x);var d,z,r,o,l,m,q=arguments.callee._scratchArrays||(arguments.callee._scratchArrays=[]),F=q[D]||(q[D]=[]),v,A,c,i,y,k,C,w,n,u,E,g=" > ",p=g.length,e,b,s,j;for(A in f){if(!f.hasOwnProperty(A)){continue}F.length=0;c=undefined;if(A==="*"){for(c in x){F.push(c)}}else{if(x.hasOwnProperty(A)){F.push(A)}if(A.slice(-1-"_jsontransform".length,-1)==="_jsontransform"){E=A.slice(0,-1-"_jsontransform".length);if(x.hasOwnProperty(E)){F.push(E)}}}z=f[A];for(v=0;c=F[v];v++){d=x[c];u=z instanceof Function;if(typeof z==="string"||u){if(u){s=z;j=c}else{e=z.indexOf(g);if(e!==-1){b=z.substring(0,e);j=z.substring(e+p);if(A==="*"){j=c+j}s=this[b]}else{b=z;j=A;s=this[b]}}x[j]=s.call(this,x[c],x,h,t);continue}r=d instanceof Array;o=z instanceof Array;l=d instanceof Object;m=z instanceof Object;if(!l||!m||r!==o){continue}if(!r){this.processJSONObject(d,z,a+"."+c,D,h,t)}else{k=z[0];C=a+"."+c+".";for(i=0;y=d[i];i++){this.processJSONObject(y,k,C+i,D,h,t)}}}}t.length--;return},copy:function(a){return a},remove:function(){return undefined},toLowerCase:function(a){return(a||"").toString().toLowerCase()},parseInt:parseInt,parseFloat:parseFloat});Core.mixin({innerSizeInOuter:function(h,e,c,i,d){var f=this._innerSizeOuterRet||(this._innerSizeOuterRet={}),g,b,a;if(isNaN(h)){d=c;i=e.height;c=e.width;e=h.height;h=h.width}g=h/e;b=c/i;a=d?g<b:g>b;f.width=a?c:i*g;f.height=a?c/g:i;return f}});Core.mixin({LogLevel:{NONE:1000,ERROR:2,WARN:1,DEBUG:0},logLevel:0,_debugs:[],_warns:[],_errors:[],_logs:[],debug:function(){Core._log(Core.LogLevel.DEBUG,"log",arguments)},warn:function(){Core._log(Core.LogLevel.WARN,"warn",arguments)},error:function(){Core._log(Core.LogLevel.ERROR,"error",arguments)},maybeDebug:function(c){if(!c){return}var a=Core._argPasser;a.length=0;for(var b=1;b<arguments.length;b++){a.push(arguments[b])}Core.debug.apply(this,a)},_log:function(h,e,f){if(this.logLevel>h){return}for(var d=0,g="",b=f.length,a;(a=f[d])||(d<b);d++){g+=(d===0?"":" ")+a}this["_"+e+"s"].push(g);var c=window.console;if(c&&(c=c[e])&&c.apply){c.apply(console,f)}else{if(c){c(g)}}}});Core.mixin({mousePosition:{},setUpMouseEvents:function(){Core.addEvent(document,"mousemove",function(b){if(!b){return}var c=NO,a=Core.mousePosition;if(!isNaN(b.clientX)&&a.x!==(a.x=b.clientX)){c=YES}if(!isNaN(b.clientY)&&a.y!==(a.y=b.clientY)){c=YES}if(c){Core.trigger("mousePosition")}})}.observes("finalizeCore")});Core.Request=Core.Object.extend({className:"Request",forceAjaxSender:NO,debugDelay:0,url:"",type:"GET",body:null,contentType:"text/plain",isAsync:YES,requestId:null,headers:{},autoJSONParse:YES,ajaxSenderFrames:{},enforceAPI:function(){if(!this.url){Core.error("Core.Requests require URLs.")}}.observes("init"),send:function(){var b=this,a=arguments;if(!this.debugDelay){return this._send.apply(this,a)}else{setTimeout(function(){b._send.apply(b,a)},this.debugDelay)}},_send:function(){this.trigger("willSend");if(this.forceAjaxSender||(this.isCrossDomain&&B.msie<=9)){return this.sendWithAjaxSender.apply(this,arguments)}var d=new XMLHttpRequest(),c=this.headers,a=this.body?(this.body instanceof Object&&JSON.stringify(this.body))||this.body:null,b;d.open(this.type,this.url,this.isAsync);d.owner=this;d.onreadystatechange=this._readyStateChangeFunction;d.withCredentials=YES;for(b in c){if(c.hasOwnProperty(b)){d.setRequestHeader(b,c[b])}}d.send(a);this._transport=d;return this},sendWithAjaxSender:function(){var b=this.ajaxSenderFrames,a=b[this.origin]||(b[this.origin]=Core.AjaxSenderFrame.create({origin:this.origin}));a.sendRequest(this)},_readyStateChangeFunction:function(){if(this.readyState!==4){return}this.owner.didReceiveResponse(this)},didReceiveResponse:function(b){if(this.autoJSONParse){try{b.responseObject=JSON.parse(b.responseText)}catch(a){Core.debug("Could not parse the responseText as JSON for "+this+": ",a)}}if(b.status!==200){this.set("resolution","error");this.trigger("error"+b.status,b);if(!this._stoppedError){this.trigger("error",b)}}else{this.set("resolution","success");this.trigger("success",b)}},_computeOriginAndDecideCrossDomain:function(){var e=location,d=e.protocol+"//"+e.host,c=this.url,b=c.indexOf("://"),a=b!==-1?c.substring(0,c.indexOf("/",b+3)):d;this.set("origin",a);this.set("isCrossDomain",d!==a);if(!this.isAsync&&this.isCrossDomain){Core.warn("Warning: A cross-domain, synchronous request was just created.","Though possible with browsers that support CORS, the request will","be asynchronous in MSIE <= 9 due to reliance on the postmessage API","to communicate with the ajax_sender iframe.")}}.observes("init"),stopError:function(){this._stoppedError=YES},_decideRequestId:function(){this.requestId||this.set("requestId",this.toString().slice(1,-1))}.observes("init"),_writeContentTypeHeader:function(){if(!this.contentType){return}var a=this.ensureOwn("headers");if(a["Content-Type"]){return}a["Content-Type"]=this.contentType}.observes("init")});Core.Request.send=function(){var a=this.create.apply(this,arguments);a.send();return a};Core.AjaxSenderFrame=Core.Object.extend({isReady:NO,path:"/ajax_sender.html",origin:null,prepareScaffolding:function(){this._inflightRequests={};var b=document.createElement("iframe"),a=this;b.setAttribute("frameBorder",0);b.setAttribute("width",0);b.setAttribute("height",0);b.style.cssText="position:absolute; left:-10000px; top:-10000px; visibility:hidden; z-index:-1;";b.id="AjaxSenderFrame"+this.coreGuid;b.onload=b.onreadystatechange=function(){if(this.readyState&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}this.onreadystatechange=null;a.setIfChanged("isReady",YES)};b.setAttribute("src",this.origin+this.path);document.body.appendChild(b);this.set("frame",b);Core.addEvent(window,"message",function(c){a._didReceiveResponseMessage(c)})}.observes("init"),_didReceiveResponseMessage:function(c){if(c.origin!==this.origin){return}var d=JSON.parse(c.data),b=d.requestId,a=this._inflightRequests[b];if(!a){Core.debug("AjaxSenderFrame ("+this.origin+"): Received a response from iframe, but can't find a request to which to pass it.");return}a.didReceiveResponse(d)},sendRequest:function(a){if(!a){return}if(a.origin!==this.origin){return Core.warn("Can't use AjaxSenderFrame for "+this.origin+" to send request to "+a.origin+".")}if(!this.isReady){(this._pendingReqs||(this._pendingReqs=[])).push(a)}else{this._sendRequest(a)}},flushPendingReqs:function(){if(!this.isReady){return}for(var b=0,a=this._pendingReqs,c;c=a&&a[b];b++){this._sendRequest(c)}a.length=0}.observes("isReady"),_sendRequest:function(a){try{this.frame.contentWindow.postMessage(JSON.stringify({requestId:a.requestId,url:a.url,type:a.type,headers:a.headers,body:a.body,isAsynchronous:YES}),this.origin);this._inflightRequests[a.requestId]=a}catch(b){Core.warn("AjaxSenderFrame ("+this.origin+"): Error while attempting to postMessage into the iframe. ",b)}},logMe:function(){Core.debug("Setting up cross-domain AjaxSenderFrame for origin "+this.origin)}.observes("init")});Core.Request.reopen({_json2CodeStatus:window.JSON2CodeStatus={isRequired:!(window.JSON&&JSON.stringify&&JSON.parse),isReceived:NO,isRequested:NO,queue:null,ensureRequested:function(){if(this.isRequested===(this.isRequested=YES)){return}Core.debug("Appending script tag for the JSON2 code.");var a=this.script=document.createElement("script");a.setAttribute("type","text/javascript");a.setAttribute("src","static/journal/quark/en-us/contents/resources/json2");document.body.appendChild(a)},didReceive:function(){Core.debug("JSON2 code is obtained. Launching any queued requests.");var a,b,c=this.queue;this.isReceived=YES;for(a=0;b=c[a];a++){b.send()}}},send:function(){var a=this._json2CodeStatus;if(a.isRequired&&!a.isReceived){(a.queue||(a.queue=[])).push(this);a.ensureRequested();return}arguments.callee.base.apply(this,arguments)}});Core.mixin({minWindowWidth:0,windowZoom:1,_lastWindowZoom:1,setUpWindowSizeTracking:function(){this.windowSize={};window.windowResizeTimes=[];var b=this,a=this._windowDidResize,c=this._windowDidResize=function c(){var e=new Date*1;var d=a.apply(b,arguments);window.windowResizeTimes.push(new Date*1-e);return d};Core.addEvent(window,"resize",c,true);if(B.iOS){Core.addEvent(window,"orientationchange",c,true)}if(this._windowDidResize(true)===1||B.mobile){Core.listen("windowDidLoad",c)}},_windowDidResize:function(g){var j=this.windowSize,k=window,h=document,f,m;if(!h.body||!h.documentElement){return 1}var b=window.orientation,a=(k.innerWidth||h.documentElement.clientWidth||h.body.clientWidth),l=(k.innerHeight||h.documentElement.clientHeight||h.body.clientHeight),e=B.standalone;if((m=Core.windowSizeOverride)){!isNaN(m.width)&&(a=m.width);!isNaN(m.height)&&(l=m.height);!isNaN(m.orientation)&&(b=m.orientation);m.hasOwnProperty("standalone")&&(e=m.standalone)}if(B.desktop){if(Core.minWindowWidth&&a<Core.minWindowWidth){a=Core.minWindowWidth;Core.bodyOverflowArbitrator.requestVisible(this,true)}else{Core.bodyOverflowArbitrator.withdrawRequest(this)}}if(B.iOS&&!B.android){if((b%180)){if(B.iPad){j.width=1024;j.height=Math.max(l,672-28);if(l<=768){this._tallestLandscape>j.height||(this._tallestLandscape=j.height);j.height=this._tallestLandscape}}else{if(B.iPhone){j.width=480;j.height=Math.max(l,268);if(l<=(e?320:268)){this._tallestLandscape>j.height||(this._tallestLandscape=j.height);j.height=this._tallestLandscape}}}}else{if(B.iPad){j.height=Math.max(l,928-28);j.width=768}else{if(B.iPhone){j.height=Math.max(l,416);j.width=320}}this._tallestPortrait>j.height||(this._tallestPortrait=j.height);j.height=this._tallestPortrait}if(this._lastOrientation!==(this._lastOrientation=b)&&g!==true){}this.windowZoom=j.width/a;if(!this._originalMaxGPUTextureSize){this._originalMaxGPUTextureSize=this.maxGPUTextureSize}this.maxGPUTextureSize=this._originalMaxGPUTextureSize/this.windowZoom}else{j.width=a;j.height=l}var i=NO,c;i=i||this._lastWindowWidth!==(this._lastWindowWidth=j.width);i=i||this._lastWindowHeight!==(this._lastWindowHeight=j.height);i=i||(c=this._lastWindowZoom!==(this._lastWindowZoom=this.windowZoom));if(!i||g===true){return}Core.hideIOSAddressBar(100);if(B.msie<=8){if((f=Core._ie8WSFreebies)>=3){clearTimeout(this._ie8WindowSizeTimeout);return this._ie8WindowSizeTimeout=setTimeout(function(){Core.trigger("windowSize")},10)}else{Core._ie8WSFreebies=(f||0)+1}}if(c){this.trigger("windowZoom")}this.trigger("windowSize")}.observes("minWindowWidth")});Core.setUpWindowSizeTracking();Core.View=Core.Object.extend({className:"View",isView:true,tagName:"div",classNames:"view".w(),classNamesOverride:"concatenate",initiallyAppended:YES,isAppended:NO,isAppendedInWindow:NO,CACHE_LAYER_EXAMPLE_IMMEDIATELY:!!B.mobile,DO_NOT_CACHE_LAYER_EXAMPLES:NO,init:function(){arguments.callee.base.apply(this,arguments);var f,e,g,d,b,c,a=this.CACHE_LAYER_EXAMPLE_IMMEDIATELY;if((d=this.rootHTML)){c=this._rootHTMLUniqueAncestor||this;if(a&&!c._rootHTMLExample){c._rootHTMLExample=Core.View._htmlSpawner.elementFromHTML(d)}if((b=c._rootHTMLExample)&&b!==true){e=this.layer=b.cloneNode(true)}if(!e){e=this.layer=Core.View._htmlSpawner.elementFromHTML(d)}if(c&&b===true){b=c._rootHTMLExample=e.cloneNode(true)}if(c&&!b){b=c._rootHTMLExample=true}}else{e=this.layer=document.createElement(this.tagName)}this.set("isRenderingLayer",YES);this.layer.id="View"+this.coreGuid;if((f=this.classNames&&this.classNames.join(" "))){e.className+=(e.className?" ":"")+f}this._resolveInitialElements();this.render(e);this._initializeChildViews();this._initializeEventListeners();this.trigger("render");this.set("isRenderingLayer",NO)},applyBackgroundColor:function(){var a=this.backgroundColor;if(a){this.layer.style.backgroundColor=a||""}}.observes("backgroundColor","render"),"*ViewOverride":function(d,b,c){if(!d||!d.isClass){return d}var a=this.ensureOwn("initialChildViews")||(this.initialChildViews=[]);a.push(c);return d},"*ElementOverride":function(d,a,c){if(d===null&&this.initialElements){this.initialElements.remove(a)}if(typeof d!=="string"){return d}var b=this.ensureOwn("initialElements")||(this.initialElements=[]);var e=c.slice(0,-7);b.remove(e);b.push(e);return d},rootHTMLOverride:function(c,a,b){if(!this._isCreating){this._rootHTMLUniqueAncestor=this._type;this._type._rootHTMLExample=undefined}else{this._rootHTMLUniqueAncestor=undefined}return c},_resolveInitialElements:function(){for(var b=0,a=this.initialElements,c;c=a&&a[b];b++){this[c]=this.getPath(this[c+"Element"])}},_initializeChildViews:function(){for(var d=0,c,b=this.initialChildViews,a;b&&(a=b[d]);d++){if((c=this[a])&&c.isClass){if((c=this[a]=c.create({owner:this}))&&c.initiallyAppended){c.appendTo(this)}}}},_initializeEventListeners:function(){var d=this,b=this.layer,e=Core.View,a=null,c=Core.addEvent;if(B.mobile){!this.touchStart||c(b,"touchstart",function(g){var f;if((!(f=e._mouseDownOn)||f===d)){return d.touchStart(g)}});!this.touchEnd||c(b,"touchend",function(g){var f;if((!(f=e._mouseDownOn)||f===d)){return d.touchEnd(g)}});!this.touchMove||c(b,"touchmove",function(g){var f;if((!(f=e._mouseDownOn)||f===d)){return d.touchMove(g)}});!this.touchCancel||c(b,"touchcancel",function(g){var f;if((!(f=e._mouseDownOn)||f===d)){return d.touchCancel(g)}})}else{!this.mouseEntered||c(b,"mouseover",function(g){var f;if((!(f=e._mouseDownOn)||f===d)){return d.mouseEntered(g)}});!this.mouseExited||c(b,"mouseout",function(g){var f;if((!(f=e._mouseDownOn)||f===d)){return d.mouseExited(g)}});!this.mouseClick||c(b,"click",function(g){var f;if((!(f=e._mouseDownOn)||f===d)){return d.mouseClick(g)}});!this.mouseMove||c(b,"mousemove",function(g){var f;if(!e._mouseDownOn){return d.mouseMove(g)}});!this.mouseDown||c(b,"mousedown",function(g){if(e._mouseDownOn){return}e._mouseDownOn=d;$(document.body).addClass("mouse-down");var f,h=Core.getStyle(d.layer,"cursor");if(h){$(document.body).addClass(e._forcedCursor="cursor-"+h)}document.onmouseup=a;if(d.mouseMove){document.onmousemove=d._boundMove||(d._boundMove=function(i){return d.mouseMove(i)})}if(d.mouseDown){return d.mouseDown(g)}});a=function(f){e.allowFutureMouseDown();if(d.mouseUp){return d.mouseUp(f)}}}},render:function(a){},append:function(a){return this.appendTo(a||this._previousParent||this.owner||document.body)},appendTo:function(a){if(!a){return}!a.isView||(a=a[this.appendInto]||a.container||a.layer);var b=this._parent;if(b&&b!==a){this.remove();b=null}if(!b){a.appendChild(this.layer)}this._previousParent=this._parent=a;this.setIfChanged("isAppended",YES);return this},remove:function(){if(this.layer.parentNode){this.layer.parentNode.removeChild(this.layer)}var a=this._parent;this._parent=null;if(a){this.setIfChanged("isAppended",NO)}return this},killSelectionAndDragInIE:B.msie?function(){this.layer.onselectstart=this.layer.ondragstart=this._NO_RETURNER}.observes("render"):undefined,_updateToIsAppended:function(){if(this._appendRemove_lastIsAppended===(this._appendRemove_lastIsAppended=this.isAppended)){return}if(this.isAppended){this.append()}else{this.remove()}}.observes("isAppended"),computeAppendednessInWindow:function(){var a=this.owner;window.appendedness=(window.appendedness||0)+1;this.setIfChanged("isAppendedInWindow",a?a.isAppendedInWindow&&this.isAppended:this._parent===document.body)}.observes(".owner.isAppendedInWindow","isAppended"),_NO_RETURNER:function(){return NO}});Core.View._htmlSpawner=document.createElement("div");Core.View._htmlSpawner.elementFromHTML=B.msie?function(a){this.innerHTML=a;return this.firstChild.cloneNode(true)}:function(a){this.innerHTML=a;return this.firstChild};Core.View.allowFutureMouseDown=function(){$(document.body).removeClass("mouse-down").removeClass(Core.View._forcedCursor);Core.View._mouseDownOn=null;Core.View._forcedCursor=null;document.onmouseup=null;document.onmousemove=null};Core.ButtonView=Core.View.extend(Core.ButtonnessMixin={isMixin:YES,className:"ButtonView",ariaLabel:"button",classNames:"button".w(),useHoverOnMobile:NO,actionDelay:10,isPurelyDecorative:NO,isEnabled:YES,isActive:NO,isOver:NO,isDown:NO,action:function(){},init:function(){if(!this.isPurelyDecorative){return arguments.callee.base.apply(this,arguments)}for(var b=0,c=this._buttonnessKeys,a;a=c[b];b++){this[a]=undefined}return arguments.callee.base.apply(this,arguments)},touchStart:function(){return this.mouseDown()},touchEnd:function(){var a=this.mouseUp();this.mouseExited();return a},touchMove:function(){return this.touchCancel()},touchCancel:function(){this.mouseExited();return this.mouseUp()},mouseEntered:function(){if(!this.isEnabled){return}this.setIfChanged("isOver",YES)},mouseExited:function(){this.setIfChanged("isOver",NO)},mouseDown:function(){if(!this.isEnabled){return}this.mouseEntered();this.setIfChanged("isDown",YES)},mouseUp:function(c){var b=this,a=b.actionDelay;if(b.isEnabled&&b.isActive){if(!a){this.performActions(c)}else{setTimeout(function(){b.performActions(c)},a)}}b.setIfChanged("isDown",NO)},_buttonnessKeys:"touchStart touchEnd touchMove touchCancel mouseEntered mouseExited mouseDown mouseUp".w(),performActions:function(a){this.action(a);this.trigger("action",a)},applyRole:function(){if(!this.isPurelyDecorative){this.layer.setAttribute("role","button")}}.observes("render"),setActive:function(){this.setIfChanged("isActive",this.isDown&&this.isOver)}.observes("isDown","isOver"),classActive:function(){if(!this.layer||this._lIA===(this._lIA=!!this.isActive)){return}$(this.layer)[this.isActive?"addClass":"removeClass"]("active")}.observes("isActive","render"),classOver:function(){if(!this.layer||this._lIO===(this._lIO=!!this.isOver)||(B.mobile&&!this.useHoverOnMobile)){return}$(this.layer)[this.isOver?"addClass":"removeClass"]("hover")}.observes("isOver","render"),classSelected:function(){if(!this.layer||this._lIS===(this._lIS=!!this.isSelected)){return}$(this.layer)[this.isSelected?"addClass":"removeClass"]("sel")}.observes("isSelected","render"),classDisabled:function(){if(!this.layer||this._lIE===(this._lIE=!!this.isEnabled)){return}$(this.layer)[!this.isEnabled?"addClass":"removeClass"]("disabled")}.observes("isEnabled","render"),setAriaAttributes:function(){this.layer.setAttribute("aria-label",Core.escapeHTML(this.ariaLabel));if(!this.isPurelyDecorative){this.layer.setAttribute("role","button")}}.observes("ariaLabel","render")});Core.TransitionerView=Core.View.extend({transitioners:null,allowInterruption:NO,transitioningOverflow:"hidden",steadyStateOverflow:"visible",_immediateTransition:Core.Object.extend({start:function(){var a=this.frView,b=this.toView;if(a){a.remove()}if(b){b.append(this.owner)}this.owner.didFinishTransition()}}),finishTransitioning:function(){var a;if((a=this.transitioner)){a.finish()}if((a=this.transitioner)){a.finish()}},transitionToCurrentView:function(){if(this._isRestoringPreviousViewAfterCancel){return}var g=this.transitioner;if(g){if(!this.allowInterruption){this._pendingTransitionView=this.currentView;this.currentView=this.previousView;g.__speedFactor__=3;g.duration/=g.__speedFactor__;g._restoreDuration||g.listen("finish",g._restoreDuration=function(){this.duration*=this.__speedFactor__;this.__speedFactor__=1});return}else{g.finish()}}this._pendingTransitionView=null;var i=this.currentView,d=this.previousView,h=(i&&i.typeInteger)||0,c=(d&&d.typeInteger)||0,b=this.transitioners,e=b&&b[h],f=(e&&e[c])||this.defaultTransition||this._immediateTransition,a=this._transitionerInstances;g=a[Core.guidFor(f)]||(a[f.coreGuid]=f.create({owner:this}));this.setIfChanged("previousView",i);this.trigger("willRunTransition",d,i,g);if(d){d.trigger("willEnterTransition",d,i,g)}if(i){i.setIfChanged("isShowing",YES);i.trigger("willEnterTransition",d,i,g)}g.frView=d;g.toView=i;this.set("transitioner",g);g.start()}.observes("currentView"),didFinishTransition:function(){var e=this.transitioner;this.set("transitioner",null);var d=e.frView,a=e.toView;if(d){d.setIfChanged("isShowing",NO);d.trigger("didFinishTransition",d,a,e)}if(a){a.trigger("didFinishTransition",d,a,e)}this.trigger("didFinishRunningTransition",d,a,e);var b=this._pendingTransitionView,c=this;if(b){setTimeout(function(){c.setIfChanged("currentView",b)},0)}},didCancelTransition:function(){var e=this.transitioner;this.set("transitioner",null);var d=e.frView,a=e.toView;if(d){d.trigger("didCancelTransition",d,a,e)}if(a){a.setIfChanged("isShowing",NO);a.trigger("didCancelTransition",d,a,e)}this.trigger("didCancelRunningTransition",d,a,e);this._isRestoringPreviousViewAfterCancel=YES;this.setIfChanged("currentView",d);this.setIfChanged("previousView",d);this._isRestoringPreviousViewAfterCancel=NO;var b=this._pendingTransitionView,c=this;if(b){setTimeout(function(){c.setIfChanged("currentView",b)},0)}},hideScrollbars:function(){this.layer.style.overflow=this.transitioningOverflow}.observes("willRunTransition"),unhideScrollbars:function(){this.layer.style.overflow=this.steadyStateOverflow}.observes("didFinishRunningTransition","render"),_transitionerInstances:(function(){this._transitionerInstances={}}.observes("init"))});(function(){var h,e,d,b,c,g,a,f;Core.transitionBank=B.android?{}:{liftTo:(e=(h=Anim.Animation.extend({duration:700,tween:Anim.tweens.make("compound","WEBKIT_EASE","SINE_IN_OUT"),shadowHeight:300,provideDelayAfterFinish:function(){var i=this;setTimeout(function(){i.trigger("delayAfterFinish")},0)}.observes("finish"),_dropHeight:function(){return Core.windowSize.height+this.shadowHeight},start:function(){this._forcedZeroes=3;return arguments.callee.base.apply(this,arguments)},update:function(){var j=this.slideView.layer.style,i=this._shadow&&this._shadow.style,k;if(!this.disableGPU&&Core.useGPUForBigs&&Core.windowSize.width<=Core.maxGPUTextureSize){k="0px";j.top===k||(j.top=k);if(i){i.top===k||(i.top=k)}j.webkitTransform="translate3d(0,"+this.current+"px,0)";if(i){i.webkitTransform="translate3d(0,"+(this.current-this.shadowHeight)+"px,0)"}}else{j.top=Math.round(this.current)+"px";if(i){i.top=Math.round(this.current-this.shadowHeight)+"px"}}j.position==="fixed"||(j.position="fixed");i.position==="fixed"||(i.position="fixed")},cleanUpFixedness:function(){this.slideView.layer.style.position=""}.observes("finish"),cleanUpGPULayer:function(){this.slideView.layer.style.webkitTransform="";if(this._shadow){this._shadow.style.webkitTransform=""}}.observes("finish"),appendToWhenBegin:function(){if(this.toView){this.toView.append(this.owner)}}.observes("start"),removeFrWhenDone:function(){if(this.frView){this.frView.remove()}}.observes("finish"),tellWorkspaceDone:function(){this.owner.didFinishTransition()}.observes("delayAfterFinish"),addShadow:function(){var i;if(!(i=this._shadow)){this._shadow=i=document.createElement("div");i.className="top-shadow";i.style.cssText="z-index:500; position:absolute; left:0px; top:0px; width:100%; height:"+this.shadowHeight+"px;"}this.owner.layer.appendChild(i)}.observes("start"),removeShadow:function(){var i=this._shadow;i&&i.parentNode&&i.parentNode.removeChild(i)}.observes("finish")})).extend({to:0,start:function(){this.slideView=this.toView;this.sitView=this.frView;this.redirectFrom(this._dropHeight());this.redirectTo(0);this.reset();return arguments.callee.base.apply(this,arguments)},pokeIOSToFixItsFixedness1:B.iOS?function(){this.slideView.layer.style.opacity=0;if(this._shadow){this._shadow.style.opacity=0}}.observes("start"):null,pokeIOSToFixItsFixedness2:B.iOS?function(){this.slideView.layer.style.position="absolute";if(this._shadow){this._shadow.style.position="absolute"}}.observes("frame0"):null,pokeIOSToFixItsFixedness3:B.iOS?function(){this.slideView.layer.style.opacity="";if(this._shadow){this._shadow.style.opacity=""}}.observes("frame1"):null,trigger:function(i){if(i==="finish"){this.trigger("willFinish")}return arguments.callee.base.apply(this,arguments)},rememberScrollOnSitView:function(){this.sitView.__lastLiftDropScrollTop__=Core.lastScrollTop}.observes("willFinish"),scrollTopOnFinish:function(){Core.scrollTop(0)}.observes("delayAfterFinish")})).extend({}),dropFrom:(d=h.extend({from:0,start:function(){this.slideView=this.frView;this.sitView=this.toView;this.redirectFrom(0);this.redirectTo(this._dropHeight());this.reset();return arguments.callee.base.apply(this,arguments)},restoreScrollToSitViewPrevious:function(){Core.scrollTop(this.sitView.__lastLiftDropScrollTop__||0)}.observes("frame1")})).extend({}),slideRight:g=(c=Anim.Animation.extend({duration:500,start:function(){if(this.owner===Journal.page.slideshowView){window.slider=this}this._originalDuration||(this._originalDuration=this.duration);this.duration=this._originalDuration;this.useGPU=Core.useGPUForBigs&&Core.windowSize.width<=Core.maxGPUTextureSize;if((Core.useGPUForBigs||B.mozilla)&&Core.windowSize.width>Core.maxGPUTextureSize){this.duration=0}this.recycle();this._forcedZeroes=3+5*!!(B.safari&&B.windows);if(this._lastElapsedTime&&this.duration){this.duration=(this.duration*0.75+this._lastElapsedTime*0.25)*0.8+0.2*this._originalDuration}this.redirectFrom(0);this.redirectTo(1);return arguments.callee.base.apply(this,arguments)},updateDurationForNextTime:function(){this._lastElapsedTime=this.elapsedTime;if(this._lastElapsedTime<100){this._lastElapsedTime=this._originalDuration}}.observes("finish"),appendToWhenBegin:function(){if(this.toView){this.toView.append(this.owner)}}.observes("start"),removeFrWhenDone:function(){if(this.to===1){if(this.frView){this.frView.remove()}}}.observes("finish"),tellWorkspaceDone:function(){if(this.to===1){this.owner.didFinishTransition()}}.observes("finish"),removeToWhenCanceled:function(){if(this.to===0){if(this.toView){this.toView.remove()}}}.observes("finish"),tellWorkspaceCanceled:function(){if(this.to===0){this.owner.didCancelTransition()}}.observes("finish"),update:function(){var j=Core.windowSize.width,l=this.direction,k=this.current,i=this.frView,m=this.toView;if(this.useGPU){if(i){i.layer.style.webkitTransform="translate3d("+(k*j*l)+"px,0,0)"}if(m){m.layer.style.webkitTransform="translate3d("+(k*j*l-l*j)+"px,0,0)"}}else{if(i){i.layer.style.marginLeft=Math.round(k*j*l)+"px"}if(m){m.layer.style.marginLeft=Math.round(k*j*l-l*j)+"px"}}},cleanUp:function(){var i=this.frView,j=this.toView;if(i){i.layer.style.marginLeft=""}if(j){j.layer.style.marginLeft=""}if(i){i.layer.style.webkitTransform=""}if(j&&!this.owner.preserveUpSlideGPULayers){j.layer.style.webkitTransform=""}}.observes("finish"),pokeFirstLooseFrame:!B.chrome?null:function(){var i=this.toView&&this.toView.layer.style;if(!i){return}i.opacity="";i.webkitTransform="translate3d(0,-10000px,0)"}.observes("frame2")})).extend({direction:1.05}),slideLeft:a=c.extend({direction:-1.05}),xFadeSlideRight:B.msie===8?g:(f=c.extend({update:function(){arguments.callee.base.apply(this,arguments);var i=this.frView,k=this.toView,j=this.current;if(i){i.layer.style.opacity=1-j}if(k){k.layer.style.opacity=j}},fixOpacities:function(){var i=this.frView,j=this.toView;if(i){i.layer.style.opacity=""}if(j){j.layer.style.opacity=""}}.observes("finish")})).extend({direction:0.2}),xFadeSlideLeft:B.msie===8?a:f.extend({direction:-0.2}),xFade:B.msie===8?undefined:f.extend({direction:0})}})();Core.WorkspaceView=Core.TransitionerView.extend({classNames:"workspace full-width full-height".w(),makeViewsArray:function(){var b=this._nowShowingMap;if(!b){return}for(var c=0,a=b.length;c<a;c++){b[c]=this[b[c]]}this.set("isNSMapReady",YES)}.observes("render"),"*ViewOverride":function(c,a,b){(this.ensureOwn("_nowShowingMap")||(this._nowShowingMap=[])).push(b);return arguments.callee.base.apply(this,arguments)},setCurrentViewFromNowShowing:function(){if(!this.isNSMapReady){return}this.setIfChanged("currentView",this._nowShowingMap[this.nowShowing])}.observes("nowShowing"),setClassName:function(){var b=this._lastClassNS,a=this.nowShowing;if(this._lastClassNS===(this._lastClassNS=a)){return}window._removeRHTMLSpinner&&window._removeRHTMLSpinner();if(!this.tabNames){return}$(this.layer).removeClass(this.tabNames[b]);$(this.layer).addClass(this.tabNames[a])}.observes("currentView"),setExplicitIOSLayerSize:B.iOS?function(){this.layer.style.width=Core.windowSize.width+"px";this.layer.style.height=Core.windowSize.height+"px"}.observes("window.Core.windowSize","render"):null,nowShowingZeroPlaceholderView:null});Core.addEvent(window,"load",function(){if(window.shouldAbortCore){return}Core.trigger("finalizeCore");Core.trigger("windowDidLoad")});CoreImage=Core.Object.create({});CoreImage.InitialStateController=Core.Object.extend({params:null,paramKeys:[],baseUrl:null,semicolonDelimitedKeys:Core.emptyArray,discoverInitiallyKnownWindowLocation:function(){var a=window.location.toString();if(a.indexOf("%")!==-1&&window.decodeURI){a=window.decodeURI(a)}this.initiallyKnownWindowLocation=a;this.trigger("didDiscoverInitiallyKnownWindowLocation")}.observes("init"),generateParams:function(){try{var f=this.initiallyKnownWindowLocation,g=f.indexOf("#")+1,d=f.indexOf("?")+1;if(!g&&d){window.location=f.substring(0,d-1)+"#"+f.substring(d);Core.debug("About to redirect. Replacing '?' with '#'.");return}var a=g?f.substring(g):"",q={},b={},n=[],h=this.semicolonDelimitedKeys,p,r,t,c,j,l,k,s;var o=function(e,i){b[e]=i;if(!isNaN(c=parseFloat(i))&&(c==i)){i=c}if((k=this["paramTransform_"+e])){i=k.call(this,i,q)}q[e]=i;n.push(e)};if(a.indexOf("&")===-1&&a.indexOf(";")!==-1){p=a.split(";");for(l=0;(t=p[l])!==undefined&&(r=h[l]);l++){o.call(this,r,t)}}else{p=a.split("&");for(l=0;j=p[l];l++){s=j.indexOf("=")+1;if(!s){continue}t=j.substring(s);r=j.substring(0,s-1);o.call(this,r,t)}}this._unmodifiedParams=b;this.set("params",q);this.set("paramKeys",n)}catch(m){this.trigger("paramsParseDidErr");this.set("params",{});this.set("paramKeys",[])}}.observes("init"),retrieveBaseUrl:function(){var a=window.location.toString();this.set("baseUrl",a.substring(0,((a.indexOf("#")+1)||Infinity)-1)+"#")}.observes("init")});CoreImage.SlideshowController=Core.Object.extend({isPlaying:NO,delay:3000,itemSet:null,currentItem:null,selectNext:function(){if(!this.itemSet){return}if(!this.currentItem){return this.set("currentItem",this.itemSet[0])}this.set("currentItem",this.itemSet[(this.itemSet.indexOf(this.currentItem)+1)%this.itemSet.length]);if(this.isPlaying){this.scheduleNext()}},selectPrevious:function(){if(!this.itemSet){return}if(!this.currentItem){return this.set("currentItem",this.itemSet[this.itemSet.length-1])}this.set("currentItem",this.itemSet[(this.itemSet.indexOf(this.currentItem)-1+this.itemSet.length)%this.itemSet.length]);if(this.isPlaying){this.scheduleNext()}},toggleShow:function(){if(this.isPlaying){this.stopShow()}else{this.startShow()}},stopShow:function(){this.setIfChanged("isPlaying",NO);clearTimeout(this._timeout);this._timeout=undefined}.observes("window.CoreImage.exitedFullScreenMode"),startShow:function(){this.setIfChanged("isPlaying",YES);this.scheduleNext()},logPlaying:function(){Core.debug(this.isPlaying?"Started Slideshow":"Stopped Slideshow")}.observes("isPlaying"),scheduleNext:function(){var a=this;clearTimeout(this._timeout);this._timeout=setTimeout(function(){a.selectNext();if(!a.isLoading){Core.debug("Slideshow playing. Selected next item. Item is ready already. Scheduling next selectNext().");a.scheduleNext()}else{Core.debug("Slideshow playing. Item not ready. Waiting for item.")}},this.delay)},itemDidLoad:function(){if(this.isLoading){return}if(!this.isPlaying){return}Core.debug("Slideshow playing. Item finished loading. Scheduling next selectNext().");this.scheduleNext()}.observes("isLoading")});CoreImage.AbstractImageView=Core.View.extend(Core.WaitSupport,{classNames:"image-view".w(),reps:undefined,downerGroup:undefined,importance:0,shouldHoldOff:NO,progressivityThreshold:1536,shouldEnforceThreshold:YES,sizePreferenceBias:window.devicePixelRatio||1,zIndex:NaN,height:NaN,width:NaN,left:0,top:0,preferredRep:null,currentRep:null,currentSrc:null,isLoading:NO,aspectRatio:NaN,loadednesses:null,numReqs:1,isInitting:YES,init:function(){arguments.callee.base.apply(this,arguments);this.isInitting=NO},_processReps:function(){if(this._lastReps===(this._lastReps=this.reps)){return}var b=this.reps,q=(this.sizes||(this.sizes=[])),a=NO,e=NO,j=NO,h=this.progressivityThreshold/2+10,k=this.progressivityThreshold/3,o=NaN,g=Infinity,f,d,n,p,c,m;q.length=0;if(!b){this.loadednesses=null;return}m=this.loadednesses={};for(f in b){if(!isNaN(p=parseInt(f,10))){q.push(p)}else{continue}if(typeof(n=b[f])==="string"){n=b[f]={url:n}}n._key=f;if((c=CoreImage.imageLoader.imageForSRC(n.url))){m[f]=c}if(p<=h){a=YES}if(p>=this.progressivityThreshold){e=YES}}j=e&&a;q.sort();if((this.shouldEnforceThreshold=this.shouldEnforceThreshold&&j)){for(f=0;p=q[f];f++){if(p>h){continue}if((o=Math.abs(p-k))<g){this._preferredSubThresholdSize=p;g=o}}}this.trigger("sizes")}.observes("init","reps"),_initialLayout:function(){this.setLayout(this.left,this.top,this.width,this.height,this.zIndex,YES)}.observes("render"),setLayout:function(g,f,d,b,i,e){var h=false,c=this.aspectRatio;if(c){if(isNaN(d)){d=b*c}if(isNaN(b)){b=d/c}}if(!isNaN(f)&&(!e||!(this.top=NaN))){this.setIfChanged("top",f)}if(!isNaN(g)&&(!e||!(this.left=NaN))){this.setIfChanged("left",g)}if(!isNaN(d)&&(!e||!(this.width=NaN))){h=this.setIfChanged("width",d)||h}if(!isNaN(b)&&(!e||!(this.height=NaN))){h=this.setIfChanged("height",b)||h}if(!isNaN(i)&&(!e||!(this.zIndex=NaN))){this.setIfChanged("zIndex",i)}if(h){this.trigger("sizeDidChange")}},setSize:function(a,b,c){this.setLayout(NaN,NaN,a,b,NaN,c)},_establishCurrentAndPreferredReps:function(){if(!this.layer||this.shouldHoldOff){return}if(!this.width||!this.height){return}if(!this.reps){this.setIfChanged("preferredRep",null);this.setIfChanged("currentRep",null);return}var q=this.sizes,c=this.reps,k=this.loadednesses,b=Math.max(this.width,this.height)*this.sizePreferenceBias,f=Infinity,d=0,a=Infinity,n=0,o,h,e,m,p,l,j,g;for(e=0;(p=q[e])&&(m=c[p]);e++){if(p<=b&&p>d){d=p}if(p>=b&&p<f){f=p}if(!(l=k[p]||(k[p]=CoreImage.imageLoader.imageForSRC(m.url)))||(l.isRequest&&l.loaded===false)){continue}if(p<=b&&p>n){n=p}if(p>=b&&p<a){a=p}if(p<this.progressivityThreshold){this._isThresholdSatisfied=YES}}if(f===Infinity){f=0}if(a===Infinity){a=0}h=f||d||0;o=a||n||0;if(!this.shouldEnforceThreshold||h<this.progressivityThreshold||this._isThresholdSatisfied||!this._preferredSubThresholdSize){this.setIfChanged("preferredRep",c[h])}else{this.setIfChanged("preferredRep",c[this._preferredSubThresholdSize])}this.setIfChanged("currentRep",c[o])}.observes("sizes","sizeDidChange","assetRequestDidComplete","reps","shouldHoldOff"),_requestPreferredRepIfNeeded:function(){if(!this.preferredRep){return}var c=this.preferredRep,a=parseInt(c._key,10),b=this;if(this.loadednesses[a]){return}(this.CustomImageRequestClass||CoreImage.ImageRequest).create(this.getCustomOptionsForRequests(c),{saveTo:this.loadednesses,saveKey:a,owner:this,group:this.downerGroup,importance:this.importance||0,rep:c,url:c.url,urls:c.urls,size:a,onload:function(){this.rep.url=this.url;this.owner.trigger("assetRequestDidComplete")},onerror:function(){this.owner.sizes.remove(this.size);delete this.owner.reps[this.size];this.owner.trigger("sizes");this.owner.trigger("assetRequestDidComplete")}})}.observes("preferredRep"),closeReqOnImageReceipt:function(){this.closeReq()}.observes("assetRequestDidComplete","currentSrc"),getCustomOptionsForRequests:function(a){return null},_establishIsLoading:function(){if(!this.preferredRep){return this.setIfChanged("isLoading",NO)}var a=this.loadednesses[this.preferredRep._key];this.setIfChanged("isLoading",!a||a.loaded===false)}.observes("preferredRep","assetRequestDidComplete"),_establishCurrentSrcAndExampleImage:function(){this.suspendTriggers();if(!this.currentRep){this.setIfChanged("currentSrc",null);this.setIfChanged("currentImageExample",null)}else{var a=this.loadednesses[this.currentRep._key];this.setIfChanged("currentSrc",this.currentRep.url);this.setIfChanged("currentImageExample",a.isRequest?a.image:a)}this.resumeTriggers()}.observes("currentRep"),_foo:function(){this.layer.style.top=Math.round(this.top)+"px"}.observes("top"),_bar:function(){this.layer.style.left=Math.round(this.left)+"px"}.observes("left"),_baz:function(){this.layer.style.width=Math.round(this.width)+"px"}.observes("width"),_qux:function(){this.layer.style.height=Math.round(this.height)+"px"}.observes("height"),_qax:function(){this.layer.style.zIndex=Math.round(this.zIndex)}.observes("zIndex")});CoreImage.EasyDomImageView=CoreImage.AbstractImageView.extend({shouldFade:YES&&!B.mobile&&!B.msie<=8,useGPU:NO,isImageOpaque:NO,MINIMUM_FADE_DELAY:100,Anim:Anim.Fader.extend({elementBinding:".owner.image",hide:function(){if(this.to===0){this.element.style.display="none"}if(this.to===1){this.owner.setIfChanged("isImageOpaque",YES)}}.observes("finish"),show:function(){if(this.to===1){this.element.style.display=""}if(this.to===0){this.owner.setIfChanged("isImageOpaque",NO)}}.observes("start")}),generateImage:function(){var a=this.image=new Image();a.style.position="absolute";a.style.width="100%";a.style.height="100%";a.style.top=a.style.left="0px";a.style.zIndex=2;this.layer.appendChild(a)},hideImage:function(){if(this._isImageShowing===(this._isImageShowing=NO)){return}if(this.shouldFade&&!this.isInitting){return(this.anim||(this.anim=this.Anim.create({owner:this}))).redirectTo(0).redirectFrom(1).start()}Anim.tellStop(this.anim);this.image.style.display="none";this.setIfChanged("isImageOpaque",NO)},showImage:function(){if(this._isImageShowing===(this._isImageShowing=YES)){return}var a=this._firstShowImageDate?Infinity:this._firstShowImageDate=new Date*1;if(a>this._initDate+this.MINIMUM_FADE_DELAY&&this.shouldFade&&!this.isInitting){return(this.anim||(this.anim=this.Anim.create({owner:this}))).redirectTo(1).redirectFrom(0).start()}Anim.tellStop(this.anim);this.image.style.display="";this.setIfChanged("isImageOpaque",YES)},updateToCurrentSrc:function(){var a=this.currentSrc;if(!a){return this.image?this.hideImage():undefined}if(!this.image){this.generateImage()}this.showImage();this.image.src=this.currentSrc}.observes("currentSrc"),markFadeGuardDate:function(){this._initDate=new Date*1}.observes("reps")});CoreImage.FadingImageView=CoreImage.AbstractImageView.extend({});require("views/image");CoreImage.GridItemMixin={isMixin:YES,cellSizeBinding:"from:.owner.cellSize",displayWidthBinding:"from:cellSize",cellSize:undefined,top:undefined,left:undefined,width:undefined,height:undefined,performLayout:function(){if(!this.cellSize||!this.layer){return}var a=this.cellSize,b=this.layer.style,c=this.layout||(this.layout={});b.top=(c.top=Math.round(this.top*a))+"px";b.left=(c.left=Math.round(this.left*a))+"px";b.width=(c.width=Math.round(this.width*a))+"px";b.height=(c.height=Math.round(this.height*a))+"px";if(!isNaN(this.zIndex)){b.zIndex=this.zIndex}this.trigger("layout")}.observes("cellSize","render")};CoreImage.PhotoGridItemMixin={isMixin:YES,cropMetricsEl:"imageContainer",imageMetricsEl:"imageView.layer",imageView:CoreImage.EasyDomImageView.extend({appendInto:"imageContainer",downerGroupBinding:"from:.owner.downerGroup",currentSrcBinding:"to:.owner.currentSrc",isImageOpaqueBinding:"to:.owner.isImageOpaque"}),cropLeft:0.5,cropTop:0.5,zoom:1,fallBackOnMissingImage:function(){if(!this.isAppendedInWindow){return}if(this.currentSrc){return}this.set("isShowingMissingImage",YES)}.observes("isAppendedInWindow"),removeMissingImage:function(){if(!this.isImageOpaque){return}this.set("isShowingMissingImage",NO)}.observes("isImageOpaque"),doImageLayout:function(){if(this.imageView.isClass||!this.value){return}var e=this.value;if(!e.width||!e.height){e.width=e.height=1}var f=this.cellSize,m=this.getInset(),s=this.cropLeft,o=this.cropTop,b=this.zoom,p=f*this.width-2*m,g=f*this.height-2*m,i=p/g,l=e.width,q=e.height,a=l/q,k=a>i,c=b*(k?g*a:p),j=b*(k?g:p/a),r=p-c,n=g-j,h=s*r,d=o*n;this.imageView.setLayout(h,d,c,j)}.observes("cellSize","render","value"),saveZoomImageInfoToPageView:function(){if(!this.currentSrc){return}var a=this.getPath(this.cropMetricsEl),d=this.getPath(this.imageMetricsEl),b=Core.positionOfElement(a),c=Core.positionOfElement(d);if(this.pageView){this.pageView.set("zoomImageInfo",{src:this.currentSrc,cropL:b.left,cropT:b.top-Core.lastScrollTop,cropW:a.offsetWidth,cropH:a.offsetHeight,imageL:c.left,imageT:c.top-Core.lastScrollTop,imageW:d.offsetWidth,imageH:d.offsetHeight})}}.observes("action")};(function(){CoreImage.MissingImageSupport={isMixin:YES,isShowingMissingImage:NO,ICON_ASPECT:512/464,missingImageIconScale:0.75,maximumImageIconSize:512,missingImageParent:"",missingImageLayout:null,_missing_image_iconReps:null,_missing_image_backgroundSrc:"",computeMissingImageLayout:function(){Core.cloneHash(this.layout,this.missingImageLayout||(this.missingImageLayout={}));this.missingImageLayout.width=this.missingImageLayout.height=0;this.trigger("missingImageLayout")}.observes("layout"),_missing_image_showHide:function(){var f,d,c,g,e;if(this.isShowingMissingImage){if(!(f=this.missingImageLayout)||!f.width||!f.height){return}if(!(d=this._missingImage)){(d=this._missingImage=document.createElement("div")).className="missing-image-container";(c=new Image()).src=this._missing_image_backgroundSrc;if(!b){c.style.display="none";c.onload=a}d.appendChild(c);this._missingImageIconView=g=CoreImage.EasyDomImageView.create({reps:this._missing_image_iconReps,owner:this,downerGroup:CoreImage.imageLoader.essentialGroup,shouldFade:NO});g.appendTo(d)}if(!d.parentNode){(this[this.missingImageParent]||this.layer).appendChild(d)}this._missing_image_doLayout()}else{if((d=this._missingImage)&&(e=d.parentNode)){e.removeChild(d)}}}.observes("render","isShowingMissingImage","missingImageLayout"),_missing_image_doLayout:function(){var j=this.missingImageLayout,i=this._missingImage,g=this._missingImageIconView,e,n;if(!g||!j||!(e=j.width)||!(n=j.height)){return}var h=YES;h=this._mis_w_!==(this._mis_w_=e)&&h;h=this._mis_h_!==(this._mis_h_=n)&&h;if(!h){return}i.style.left=j.left+"px";i.style.top=j.top+"px";i.style.width=j.width+"px";i.style.height=j.height+"px";var f=this.missingImageIconScale,l=this.maximumImageIconSize,c=this.ICON_ASPECT,o=e/n,m=c>o,d=f*(m?e:n*c),k=f*(m?e/c:n);if(d>l){d=l;k=d/c}if(k>l){k=l;d=k*c}g.setLayout((e-d)/2,(n-k)/2,d,k)}.observes("missingImageLayout")};var b=NO,a=function(){this.style.display="";b=YES}})();require("views/image");CoreImage.SlideshowItemMixin={isMixin:YES,allowsHudToHide:YES,resetState:function(){},sizeHashConvenience:function(){this.size={}}.observes("init"),setAvailableSize:function(){var a=(this.availableSize||(this.availableSize={})),b=this.owner.availableRect;if(!b){return}a.width=b.width;a.height=b.height;var c=(this._lastsw_!==(this._lastsw_=a.width));c=c||(this._lastsh_!==(this._lastsh_=a.height));if(!c){return}this.trigger("availableSize")}.observes(".owner.availableRect","render"),doLayoutFromSize:function(){if(!this.size){return}var e=this.owner.availableRect,c=Math.round(this.size.width),a=Math.round(this.size.height),b=this.layer.style,d=this.layout||(this.layout={});if(!c||!a){return}b.width=(d.width=c)+"px";b.height=(d.height=a)+"px";b.left=(d.left=Math.round((e.width-c)/2+e.left))+"px";b.top=(d.top=Math.round((e.height-a)/2+e.top)+(this.size.offsetTop||0))+"px";this.trigger("layout")}.observes("size")};CoreImage.SlideshowPhotoMixin={isMixin:YES,shouldAttemptToFillScreen:NO,allowZoom:!!B.mobile,enableOwnerSwipability:YES,maxTextureSize:{width:Core.maxGPUTextureSize,height:Core.maxGPUTextureSize},imageView:CoreImage.EasyDomImageView.extend({shouldFade:NO,currentSrcBinding:"to:.owner.currentSrc",downerGroupBinding:"from:.owner.downerGroup",isImageOpaqueBinding:"to:.owner.isImageOpaque"}),fallBackOnMissingImage:function(){if(!this.isAppendedInWindow){return}if(this.currentSrc){return}this.set("isShowingMissingImage",YES)}.observes("isAppendedInWindow"),removeMissingImage:function(){if(!this.isImageOpaque){return}this.set("isShowingMissingImage",NO)}.observes("isImageOpaque"),doLayout:function(){if(!this.value||!this.layer){return}var b=this.value;if(!b.width||!b.height){b.width=b.height=1}var l=this.availableSize,n=this.size||(this.size={}),i=this.zoomContentSize||(this.zoomContentSize={}),d=b.width,m=b.height,c=d/m,k=l.width,f=l.height,j=k/f,e=this.shouldAttemptToFillScreen&&Math.max(c/j,j/c)<1.15,a=e?c<j:c>j,h=Math.round(a?k:f*c),g=Math.round(a?k/c:f);if(this.allowZoom){n.width=k;n.height=f}else{n.width=Math.min(k,h);n.height=Math.min(f,g)}i.width=h;i.height=g;this.zoomContainerSize=this.size;if(!this.zoomState){this.resetState(YES)}this.trigger("size");this.trigger("imageLayout")}.observes("availableSize","value"),resetState:function(a){Anim.tellStop(this._pinchZoomAnimation);var b=this.size,c=this.zoomContentSize;if(!b||!c){return}this.resetZoom(YES);this._hasRenderedZoomSinceReset=NO;if(!a){this.trigger("imageLayout")}},getBigZoomInfo:function(){var a=this.layout,b=this.imageView;if(!a||!b){return null}return this._bigZoomInfo||(this._bigZoomInfo={src:this.currentSrc,left:b.left+a.left,top:b.top+a.top,width:b.width,height:b.height})},computeMissingImageLayout:function(){var b=this.missingImageLayout||(this.missingImageLayout={}),a=this.size,c=this.zoomContentSize;if(!a||!c){return}b.left=a.width/2-c.width/2;b.top=a.height/2-c.height/2;b.width=c.width;b.height=c.height;this.trigger("missingImageLayout")}.observes("imageLayout"),_updateBigZoomInfoSrc:function(){if(this._bigZoomInfo){this._bigZoomInfo.src=this.currentSrc}}.observes("currentSrc"),clearBigZoomInfo:function(){this._bigZoomInfo=null}.observes("layout"),doImageLayout:function(){var a=this.value,i=this.size,g=this.zoomContentSize,e=this.maxTextureSize,d=this.zoomState;if(!this.allowZoom||(d.zoom===1&&d.y===0&&d.x===0&&!this._hasRenderedZoomSinceReset)){this.imageView.layer.style.webkitTransform="";return this.imageView.setLayout(i.width/2-g.width/2,i.height/2-g.height/2,g.width,g.height)}this._hasRenderedZoomSinceReset=YES;var b=Core.innerSizeInOuter(a,e);this.imageView.setLayout(i.width/2-b.width/2,i.height/2-b.height/2,b.width,b.height);var c=g.width*d.zoom,h=g.height*d.zoom,f=Math.max(c,h)/e.width;this.imageView.layer.style.webkitTransform="translate3d("+d.x+"px,"+d.y+"px,0) scale("+f+")"}.observes("imageLayout","zoomState"),touchStart:function(){if(!this.isImageOpaque){return}return arguments.callee.base.apply(this,arguments)}};CoreImage.ThemeSupport={isMixin:YES,themeOverride:function(c,a,b){if(c.isTheme){return c}else{return CoreImage.Theme.create(c)}},_themeSupport_updateToDisplayWidth:function(){if(!this.layer||!this.theme||!this.displayWidth){return}this.theme.applyToView(this)}.observes("displayWidth","render","theme"),_themeSupport_getThemeFromOwner:function(){var a;if(!(a=this.owner)||!(a=a.theme)||!(a=a[this.className+".theme"])){return}this.setIfChanged("theme",a)}.observes(".owner.theme","init")};CoreImage.ImageRequest=Core.Object.extend({imageLoader:null,done:false,loaded:false,erred:false,group:null,importance:0,importanceAdjust:0,isRequest:true,served:false,onload:null,onerror:null,loadee:null,init:function(){if(this.saveTo){this.saveTo[this.saveKey]=this}arguments.callee.base.apply(this,arguments);this._isInitting=true;if(!this.group){this.group=this.imageLoader.group}if(this.passive){this.group=this.imageLoader.passiveGroup}if((this.urls&&this.urls.length)||this.url){this.joinLoadee()}if(!this.loadee||!this.loadee.started){this.enter(this.group)}if(this.loadee&&!this.loadee.started){this.imageLoader.startThreads()}this._isInitting=false},joinLoadee:function(){if(this.loadee||!this.group){return}var a=(this.url||this.urls);if(!a){return}a=a.toString();var b=this.imageLoader.loadees[a];if(!b){b=CoreImage.Loadee.create({urls:this.urls,url:this.url,debug:this.debug});this.imageLoader.loadees[a]=b}this.requestNumber=b.requests.length+1;this.setIfChanged("loadee",b);b.accommodate(this);if(!this._isInitting&&!this.loadee.started){this.imageLoader.startThreads()}}.observes("urls","url"),didLoad:function(a){this.leaveGroup();if(this.done){return}this.setIfChanged("url",a);this.set("loaded",true);this.image=this.loadee.image;this.trigger("success");this.set("done",true)},didErr:function(){this.leaveGroup();if(this.done||this.erred){return}this.setIfChanged("erred",true);if(this.loadee){this.image=this.loadee.image}this.trigger("error");this.setIfChanged("done",true)},_runOnLoadAPIGlue:function(){if(this.onload instanceof Function){this.onload()}}.observes("success"),_runOnErrorAPIGlue:function(){if(this.onerror instanceof Function){this.onerror()}}.observes("error"),needsAttention:function(){return !!this.loadee&&!this.done},enter:function(a){if(!a){return}if(this.served){return}this.group=a;a.accept(this);return this},calmDown:function(){this.setIfChanged("served",true);this.leaveGroup();return this},leaveGroup:function(){if(this.group){this.group.reject(this)}this.group=null;return this},abort:function(){if(this.done){return}this.set("done",true);this.leaveGroup();if(this.loadee){this.loadee.unaccommodate(this)}},toString:function(a){a=a||(this.parent&&this.parent._string_indent)||(this.group&&this.group._string_indent)||0;var c="";for(var b=0;b<a;b++){c+=" "}this._string_indent=a+2;return c+"[ImageRequest:"+this.coreGuid+"; importance="+this.importance+"; served="+this.served+"; done="+this.done+"]"}});CoreImage.Loadee=Core.Object.extend({imageLoader:null,done:false,loaded:false,erred:false,loading:false,started:false,url:null,requests:null,image:null,thread:null,didLoad:function(){if(this.image){this.image.onload=null;this.image.onerror=null}if(this.done){return}if(this.thread){this.thread.loadeeDidFinish()}this.thread=null;this._downloadTime=new Date*1-this._lastUrlSetTime||NaN;this.set("loaded",true);this.set("loading",false);this.imageLoader.loadees[this.url]=this;for(var a=0;a<this.requests.length;a++){this.requests[a].didLoad(this.url)}this.done=true},didErr:function(){if(this.done){return}if(this.thread){this.thread.loadeeDidFinish()}this.thread=null;this.set("erred",true);this.set("loading",false);for(var a=0;a<this.requests.length;a++){this.requests[a].didErr()}this.done=true},didHalfLoad:function(){delete this.image.onload;delete this.image.onerror;var a=this;this.image=new Image();this.image.onload=function(){a.didLoad()};this.image.onerror=function(){a.didErr()};this.image.src=this.url;this._lastUrlSetTime=new Date*1},didHalfErr:function(){if(!this.urls){return this.didErr()}this.url=this.urls[++this._currentlyAttemptingUrlIndex];if(!this.url){return this.didErr()}this.image.src=this.url;this._lastUrlSetTime=new Date*1},load:function(a,b){if(this.done||(this.loading&&!b)){return}var c=this,d=this.imageLoader.simulatedLatency;if(!d||(d&&!b)){this.calmRequests();this.thread=a;this.setIfChanged("loading",true);this.setIfChanged("started",true);this._currentlyAttemptingUrlIndex=-1;if(!this.url&&this.urls){this._currentlyAttemptingUrlIndex=0;this.url=this.urls[0]}}if(d&&!b){clearTimeout(this._latencyTimeout);this._latencyTimeout=setTimeout(function(){c.load(a,true)},d);return}this.image=new Image();this.image.onload=(B.s.safari<5)?function(){c.didHalfLoad()}:function(){c.didLoad()};this.image.onerror=function(){c.didHalfErr()};this.image.src=this.url;this._lastUrlSetTime=new Date*1},calmRequests:function(){if(this.done||this.loading){return}if(!this.requests||!this.requests.length){return}for(var a=0;a<this.requests.length;a++){this.requests[a].calmDown()}return this},accommodate:function(a){if(!a){return}if(this.loaded){a.didLoad(this.url)}else{if(this.erred){a.didErr()}}this.requests.push(a);return this},unaccommodate:function(a){if(!a){return}if(this.done){return}this.requests.remove(a);if(!this.requests.length){this.stopLoading()}},stopLoading:function(){if(!this.loading){return}clearTimeout(this._latencyTimeout);if(this.thread){this.thread.loadeeDidFinish()}this.setIfChanged("started",false);this.setIfChanged("loading",false);if(!this.image){return}this.image.onload=this.image.onerror=null;this.image.src=Core.emptyImageSrc;this.image=null},init:function(){arguments.callee.base.call(this);this.requests=[]},tearDown:function(){delete this.tearDown;delete this.image;for(var a=0;a<this.requests.length;a++){if(this.requests[a]&&this.requests[a].tearDown){this.requests[a].tearDown()}delete this.requests[a]}delete this.requests;delete this.group;delete this.thread}});CoreImage.ImageGroup=Core.Object.extend({isGroup:YES,parent:null,importance:0,importanceAdjust:0,pending:null,target:Math.pow(2,31)-1,needsAttention:function(){for(var a=0;a<this.pending.length;a++){if(this.pending[a].needsAttention()){return true}}return false},accept:function(a){if(a==this){return}this.pending.push(a);return this},reject:function(a){this.pending.remove(a);return this},enter:function(a){if(!a){return}a.accept(this);this.parent=a;return this},getNext:function(g){if(!this.pending.length){return null}var d=Infinity,e=null,h=-1,b=false;for(var a=0,c;(c=this.pending[a])&&!b;a++){if(g&&g(c)){continue}c.importance||(c.importance=0);var f=Math.abs(c.importance-this.target)-c.importanceAdjust;if(c.needsAttention()){if(c.isEssential){e=c;b=true}if((f<d)){e=c;d=f;h=a}}}if(!e){return null}if(e&&e.isRequest){return e}else{if(e){return e.getNext(g)}}return null},manyNextAnswerArray:[],getManyNext:function(d,e,a){var j=this.manyNextAnswerArray,b=this._tempUseArray;if(!a){j.length=0}b.length=0;if(!this.pending.length){return j}var h=j.length,c,f,g;this.pending.sort(this._importanceVsTargetSorter);for(c=0;(f=this.pending[c])&&h<d;c++){if(f.isGroup){continue}if(e&&e(f)){continue}b.push(f);h++}for(c=0;f=b[c];c++){j.push(f)}if(h<d){for(c=0;(g=this.pending[c])&&j.length<=d;c++){if(g.isGroup){g.getManyNext(d,e,true)}}}return j},init:function(){arguments.callee.base.call(this);this.pending=[];this._tempUseArray=[];var a=this;this._importanceVsTargetSorter=function(d,c){if(d.isEssential){return -1}if(c.isEssential){return 1}return(Math.abs(d.importance-a.target)-d.importanceAdjust)-(Math.abs(c.importance-a.target)-c.importanceAdjust)}},becomeMostImportant:function(){if(!this.parent){return}for(var b=0,a=-Infinity,d,c=this.parent.pending;d=c[b];b++){if(!d.isEssential){a=Math.max(a,d.importance)}}this.importance=a+1},tearDown:function(){delete this.tearDown;for(var a=0;a<this.pending.length;a++){if(this.pending[a]&&this.pending[a].tearDown){this.pending[a].tearDown()}delete this.pending[a]}},toString:function(a){a=a||(this.parent&&this.parent._string_indent)||(this.group&&this.group._string_indent)||0;var c="";for(var b=0;b<a;b++){c+=" "}this._string_indent=a+2;return c+"[ImageGroup:"+this.coreGuid+"; "+(this.isEssential?"essential":"importance="+this.importance)+"; pending=[\n"+this.pending.join(c+"\n")+"\n"+c+"]]"}});CoreImage.ImageLoader=Core.Object.extend({numThreads:4,delay:0,threads:null,group:null,loadees:null,getNext:function(){return this.group.getNext.apply(this.group,arguments)},getManyNext:function(){return this.group.getManyNext.apply(this.group,arguments)},startThreads:function(){for(var a=0;a<this.threads.length;a++){this.threads[a].startIfNecessary()}return this},requestsForSRC:function(b){var a=this.loadees[b];if(!a){return[]}return a.requests},isSRCLoaded:function(a){return !!this.imageForSRC(a)},imageForSRC:function(b){var a=this.loadees[b];if(!a){return false}return a.loaded?a.image:false},isSRCRequested:function(c){var a=this.loadees[c];if(!a){return false}if(a.started){return true}for(var b=0;b<a.requests;b++){if(a.requests[b].group){return true}}return false},isSRCErred:function(b){var a=this.loadees[b];if(!a){return false}return a.erred},init:function(){arguments.callee.base.call(this);this.group=CoreImage.ImageGroup.create({parent:this});this.essentialGroup=CoreImage.ImageGroup.create({isEssential:true}).enter(this.group);this.passiveGroup=CoreImage.ImageGroup.create({parent:this});this.threads=[];for(var a=0;a<this.numThreads;a++){this.threads[a]=CoreImage.ImageThread.create({loader:this})}this.loadees={}},tearDown:function(){delete this.tearDown;var a,b;for(a=0;a<this.threads.length;a++){if(this.threads[a]&&this.threads[a].tearDown){this.threads[a].tearDown()}}for(a in this.loadees){b=this.loadees[a];if(b&&b.tearDown){b.tearDown()}}if(this.group&&this.group.tearDown){this.group.tearDown()}if(this.passiveGroup&&this.passiveGroup.tearDown){this.passiveGroup.tearDown()}delete this.group;delete this.passiveGroup},toString:function(){this._string_indent=2;return"[ImageLoader:"+this.coreGuid+";\nthreads=[\n"+this.threads.join("\n")+"\n]\ngroup=\n"+this.group+"\n]"}});CoreImage.ImageThread=Core.Object.extend({loader:null,loading:false,delayed:false,idle:true,loadee:null,ignoreTester:null,startIfNecessary:function(){if(this.idle){this.startNextLoad()}return this},startNextLoad:function(){if(this.loading){return}var a=this.loader.getNext(this.ignoreTester);if(!a){this.set("idle",true);this.set("loading",false);this.loadee=null;return}if(!a.loadee){return}this.set("delayed",false);this.set("loading",true);this.set("idle",false);this.loadee=a.loadee;this.loadee.load(this);return this},loadeeDidFinish:function(){var a=this;this.loadee=null;this.set("loading",false);if(!this.loader.delay){this.startNextLoad()}else{this.set("delayed",true);setTimeout(function(){a.startNextLoad()},this.loader.delay)}},toString:function(){return"[ImageThread:"+this.coreGuid+"; loadee="+this.loadee+"]"}});CoreImage.imageLoader=Anim.extraStatus["CoreImage.imageLoader"]=CoreImage.ImageLoader.create({numThreads:6,simulatedLatency:0,delay:0});CoreImage.ImageRequest.reopen({imageLoader:CoreImage.imageLoader});CoreImage.Loadee.reopen({imageLoader:CoreImage.imageLoader});CoreImage.FileDownloader=Core.Object.extend({queue:[],QUEUE_DRAIN_INTERVAL:500,downloadMultiple:function(c){for(var b=0,a;a=c&&c[b];b++){this.downloadFile(a)}},downloadFile:function(a){if(!a){return}this.ensureFrameExistence();this.queue.push(a);if(!this._timeout){this.dequeueAndDownload()}else{this.ensureScheduled()}},ensureScheduled:function(){if(this._timeout){return}var a=this;this._timeout=setTimeout(function(){a._timeout=undefined;a.dequeueAndDownload()},this.QUEUE_DRAIN_INTERVAL)},dequeueAndDownload:function(){var a=this.queue[0];this.queue.remove(a);Core.debug("Downloading URL "+a);this.frame.src=a;if(this.queue.length){this.ensureScheduled()}},ensureFrameExistence:function(){if(this.frame){return}var a=this.frame=document.createElement("iframe");a.style.cssText="position:absolute; left:-1000px; top:-1000px; width:0px; height:0px; z-index:-1000;";document.body.appendChild(a)}});CoreImage.mixin({isFullScreen:NO,fullScreenSupported:function(){var a=document.documentElement;return !!(a.webkitRequestFullScreen||a.mozRequestFullScreen)},requestFullScreen:function(){if(this.isFullScreen){return}var b=document.documentElement,a=b.webkitRequestFullScreen||b.mozRequestFullScreen;if(!a){return}this.trigger("requestingFullScreenMode");a.call(b);this.setIfChanged("isFullScreen",YES);this.trigger("requestedFullScreenMode")},cancelFullScreen:function(){if(!this.isFullScreen){return}var b=document,a=b.webkitCancelFullScreen||b.mozCancelFullScreen;if(!a){return}this.trigger("cancellingFullScreenMode");a.call(b);this.setIfChanged("isFullScreen",NO);this.trigger("cancelledFullScreenMode")},setupFullscreenEventHandling:function(){if(!this.fullScreenSupported()){return}var b=document.documentElement,a=this;if(b.webkitRequestFullScreen){Core.addEvent(b,"webkitfullscreenchange",function(){a.setIfChanged("isFullScreen",document.webkitIsFullScreen)})}else{if(b.mozRequestFullScreen){Core.addEvent(document,"mozfullscreenchange",function(){a.setIfChanged("isFullScreen",document.mozFullScreen)})}}}.observes("window.Core.windowDidLoad"),isFullScreenDidChange:function(){this.trigger(this.isFullScreen?"enteredFullScreenMode":"exitedFullScreenMode")}.observes("isFullScreen")});CoreImage.Theme=Core.Object.extend({isTheme:YES,"*.themeOverride":function(d,a,c){for(var b in d){d[b]=this.parseIfNeeded(d[b])}if(a&&a.prototype&&a.prototype.isTheme){return a.extend(d)}d=CoreImage.Theme.extend(d);(this.ensureOwn("_themeList")||(this._themeList=[])).push(c);return d},"*.stylesOverride":function(e,b,d){if(!e){return e}(this.ensureOwn("_stylesList")||(this._stylesList=[])).push(d);var f=[],a=[];for(var c in e){f.push(c);a.push(e[c]=this.parseIfNeeded(e[c]))}e._keys=f;e._values=a;return e},applyToView:function(f){if(!f){return}for(var c=0,h,l,m=this._stylesList,d;m&&(h=m[c])&&(l=this[h]);c++){if((d=f[h.slice(0,-7)])&&(d instanceof Element)){for(var b=0,a=l._keys,k=l._values,e,g;e=a[b];b++){if(d.style[e]!==(g=this.evaluate(k[b],f))){d.style[e]=g+"px"}}}}},buildChildThemes:function(){for(var b=0,a,c=this._themeList;a=c&&c[b];b++){this[a]=this[a].create()}delete this._themeList}.observes("init"),valueFor:function(a,b){var c=a.indexOf(".");if(c!==-1){return this.evaluate(this[a.substring(0,c)+".styles"][a.substring(c+1)],b)}return this.evaluate(this[a],b)},evaluate:function(k,b,h){var d,e,i,a,j,f,c;if(!k){return k}if(b instanceof Object){h=b;b=b.displayWidth}if(k instanceof Function){return Math.round(k.apply(h||this))}b||(b=this.displayWidth);if(!k.input){return(k>-1&&k<1)?Math.round(k*b):k}d=k;j=d.input;a=CoreImage.Theme._cache||(CoreImage.Theme._cache={});f=a[j]||(a[j]={});if((c=f[b])){return c}k=d.fraction*b+d.constant;if(((e=d.min)||e===0)&&k<e){k=e}if(((i=d.max)||i===0)&&k>i){k=i}var g=f[b]=Math.round(k);return g},parseIfNeeded:function(d){if(typeof d!=="string"||d.indexOf("+")===-1){return d}var b=d;d=d.split(" ").join("");var a={},c;if((c=d.lastIndexOf("<",d.indexOf("+")))!==-1){a.min=parseFloat(d.substring(0,c))}d=d.substring(c+1);c=d.indexOf("+");a.fraction=parseFloat(d.substring(0,c));d=d.substring(c+1);c=d.indexOf("<");if(c===-1){a.constant=parseFloat(d)}else{a.constant=parseFloat(d.substring(0,c));a.max=parseFloat(d.substring(c+1))}a.input=b;return a}});CoreImage.URLResolver=Core.JSONProcessor.extend({computeUrlSetHash:function(k,c){var f=c.items,g=c.locations,e={},d,h,a,j,b=new Date*1;if(k.url_location){h=g[k.url_location];a=h.scheme?h.scheme+"://":"";j=h.hosts.length;e.urls=[];for(d=0;d<j;d++){e.urls.push(a+h.hosts[d]+k.url_path)}e.expiry=this.parseUrlExpiry(k.url_expiry,b);e.birth=b}else{e.error=k.error_code}return e},parseUrlExpiry:function(c,b){var a=isNaN(c)?this.parseJSONDate(c):c;if(a<b){Core.debug("Now is "+b+" but expiry is "+a+". Overriding to 20 minutes from now.");a=b+20*60*1000}return a||Infinity},parseJSONDate:function(c){c=c.split("T");var a=c[0],d=c[1];if(!a||!d){return}a=a.split("-");d=d.slice(0,-1);d=d.split(":");if(a.length!==3){return Infinity}if(d.length!==3){return Infinity}var b=new Date();b.setUTCFullYear(parseInt(a[0],0));b.setUTCMonth(parseInt(a[1],0)-1);b.setUTCDate(parseInt(a[2],0));b.setUTCHours(parseInt(d[0],0));b.setUTCMinutes(parseInt(d[1],0));b.setUTCSeconds(parseInt(d[2],0));return b*1||Infinity}});CoreImage.SlideshowView=Core.TransitionerView.extend({itemSet:null,currentItem:null,currentView:null,leftTransitioners:null,rightTransitioners:null,isHudShowing:NO,hudLifespan:4000,canHudHide:YES,steadyStateOverflow:"hidden",touchStart:function(c,b){Core.scrollTop(0);var a=this;if(this.isHudShowing){if(!c._doNotHideHud){this._touchHideHudTimeout=setTimeout(function(){a.hideHud()},200)}else{this.showHud()}}else{this._touchShowHudTimeout=setTimeout(function(){a.showHud()},500)}if(c&&b!==true){c.preventDefault()}return arguments.callee.base.apply(this,arguments)},touchMove:function(a){if(a){a.preventDefault()}clearTimeout(this._touchShowHudTimeout);return arguments.callee.base.apply(this,arguments)},mouseDown:function(a){this.touchStart(a,YES);return true},mousePositionChange:function(a){if(!this.isAppendedInWindow){return}this.showHud()}.observes("window.Core.mousePosition"),viewForItem:function(b,a){Core.error("When using SlideshowView, you must implement viewForItem. Otherwise, the slideshow is unable to render any item records.")},setCurrentViewFromCurrentItem:function(){var c=this.currentItem,e=this.itemSet.indexOf(c),g=this.currentView,f=this.itemSet.indexOf(g&&g.originalItem),a=this.viewForItem(c,e),b=e>f,d=this.itemSet.length;if(Math.abs(e-f)===d-1){b=!b}this.set("transitionDirection",b?"left":"right");this.setIfChanged("currentView",a);if(a){a.trigger("didBecomeCurrent")}}.observes("currentItem"),decideTransitioners:function(){if(!this._currentlySwiping){this.transitioners=this[this.transitionDirection+"Transitioners"]}else{this.transitioners=this[this.transitionDirection+"SwipeTransitioners"]||this[this.transitionDirection+"Transitioners"]}}.observes("transitionDirection"),lookaheadAndBehind:function(){if(!this.currentItem||!this.itemSet){return}var a=this.itemSet&&this.itemSet.indexOf(this.currentItem);if(isNaN(a)||a===-1){return}for(var b=a-1;b<=a+2&&b<this.itemSet.length;b++){if(b>=0){this.viewForItem(this.itemSet[b],b)}}}.observes("currentItem"),chainObserveIsLoading:function(){var a=this._isLoadingWatcher;if(!a){var b=this;a=this._isLoadingWatcher=function(){b._watchIsLoading()}}if(this._lastIsLoadingWatcherView){this._lastIsLoadingWatcherView.unlisten("isLoading",a)}if(this.currentView){this.currentView.listen("isLoading",a)}this._lastIsLoadingWatcherView=this.currentView;a()}.observes("currentView"),allowOrDisallowHudHide:function(){this.setIfChanged("canHudHide",this.currentView&&this.currentView.allowsHudToHide)}.observes("currentView"),_watchIsLoading:function(){this.setIfChanged("isLoading",this.currentView&&this.currentView.isLoading)},showHud:function(a){if(this.isTransitioning){return}this.setIfChanged("isHudShowing",YES);clearTimeout(this._hudHideTimeout);if(!this.canHudHide){return}if(a!==true&&!this.isMouseOverHud&&!B.silk){this.scheduleHudHide(a)}}.observes("isMouseOverHud","canHudHide"),hideHud:function(a){if(!this.canHudHide){return}this.setIfChanged("isHudShowing",NO);if((a||this.isTransitioning)&&this.hudView&&this.hudView.finishTransition){this.hudView.finishTransition()}},scheduleHudHide:function(a){var b=this;this._hudHideTimeout=setTimeout(function(){b.hideHud()},a||this.hudLifespan)},resetOldViewOnFinish:function(c,a,b){if(c){c.resetState()}}.observes("didFinishRunningTransition"),computeAvailableRectFromWindow:function(){var a=this.availableRect||(this.availableRect={});a.top=0;a.left=0;a.width=Core.windowSize.width;a.height=Core.windowSize.height;this.trigger("availableRect")}.observes("window.Core.windowSize","init")});require("views/slideshow");CoreImage.SlideshowView.reopen({_MAKE_TMP_POINTER:function(){window.sv=this}.observes("init"),swipeToOffset:function(d){if(this.isCommittingSwipe){return 1}if(!this.itemSet||this.itemSet.length<=1){return 1}if(!d){this.cancelSwipe(YES);return 0}var a=d<0,b=a?"left":"right";if(b!==this._currentlySwiping&&this._currentlySwiping){this.cancelSwipe(YES)}if(!this._currentlySwiping){this._initiateSwipe(a)}var c=this.victimTransitioner;c.current=d/Core.windowSize.width/c.direction;c.update();this.setIfChanged("currentSwipeOffset",d);return 0},swipeTouchDidEnd:function(){if(Math.abs(this.currentSwipeOffset)>=Core.windowSize.width/5){this.finishSwipe()}else{this.cancelSwipe()}},_initiateSwipe:function(b){if(this._currentlySwiping){return}this._currentlySwiping=b?"left":"right";if(b){this.controller.selectNext()}else{this.controller.selectPrevious()}var a=this.transitioner;this.setIfChanged("victimTransitioner",a);a.paused=YES},cancelSwipe:function(b){var a=this.victimTransitioner;if(!a){return}a.redirectTo(0);a.redirectFrom(a.current);a.reset();a.listen("finish",function(){this.unlisten("finish",arguments.callee);this.owner.swipeDidFinishCanceling()});a.paused=NO;this.setIfChanged("isCommittingSwipe",YES);if(b){a.finish()}},finishSwipe:function(b){var a=this.victimTransitioner;if(!a){return}a.redirectTo(1);a.redirectFrom(a.current);a.reset();a.listen("finish",function(){this.unlisten("finish",arguments.callee);this.owner.swipeDidFinishFinishing()});a.paused=NO;this.setIfChanged("isCommittingSwipe",YES);if(b){a.finish()}},forceFinishCurrentSwipeCommittal:function(){if(!this.isCommittingSwipe){return}this.victimTransitioner.finish()},swipeDidFinishCanceling:function(){var a=this._currentlySwiping;if(!a){return}if(a==="right"){this.controller.selectNext()}if(a==="left"){this.controller.selectPrevious()}this.swipeDidFinish()},swipeDidFinishFinishing:function(){this.swipeDidFinish()},swipeDidFinish:function(){this._currentlySwiping=NO;this.setIfChanged("victimTransitioner",null);this.setIfChanged("isCommittingSwipe",NO)},getNextView:function(){return this.viewForItem(this.itemSet[(this.itemSet.indexOf(this.currentView.originalItem)+1)%this.itemSet.length])},getPreviousView:function(){return this.viewForItem(this.itemSet[(this.itemSet.indexOf(this.currentView.originalItem)+this.itemSet.length-1)%this.itemSet.length])}});CoreImage.SlideshowView.reopen({touchStart:function(b){if(this.currentView&&this.currentView.hasPinchZoomability&&this.currentView.allowZoom){return arguments.callee.base.apply(this,arguments)}if(b&&b.touches&&b.touches.length>1){return}var a=b&&b.touches&&b.touches[0]&&b.touches[0].clientX;if(!a){return arguments.callee.base.apply(this,arguments)}this._initialSwipeTouchX=a;this._isTouchReadyToSwipe=YES;return arguments.callee.base.apply(this,arguments)},touchMove:function(b){var a=b&&b.touches&&b.touches[0]&&b.touches[0].clientX;if(!a){return arguments.callee.base.apply(this,arguments)}if(!this._isTouchReadyToSwipe){return arguments.callee.base.apply(this,arguments)}this.swipeToOffset(a-this._initialSwipeTouchX);this._isTouchSwiping=YES;return arguments.callee.base.apply(this,arguments)},touchEnd:function(a){if(!this._isTouchSwiping){return arguments.callee.base.apply(this,arguments)}this._isTouchSwiping=this._isTouchReadyToSwipe=NO;this._initialSwipeTouchX=undefined;this.swipeTouchDidEnd();return arguments.callee.base.apply(this,arguments)}});(function(){var a;CoreImage.FadingTextSwapperView=Core.TransitionerView.extend({allowInterruption:YES,defaultTransition:Core.transitionBank.xFade||Core.TransitionerView.prototype.defaultTransition,minLeft:0,minLeftPadding:10,align:"center",textLeft:null,textWidth:null,showText:YES,currentView:(a=Core.View.extend({classNames:"measured-label".w(),value:"",rootHTML:'<div><div class="text"></div></div>',textElement:"layer.firstChild",alignBinding:".owner.align",minLeftBinding:"from:.owner.minLeft",minLeftPaddingBinding:"from:.owner.minLeftPadding",leftBinding:"to:.owner.textLeft",widthBinding:"to:.owner.textWidth",showTextBinding:"from:.owner.showText",showTextDidChange:function(){if(this.showText||!this.isAppendedInWindow){if(!this.owner.transitioner){$(this.text).addClass("show").removeClass("hide")}}else{$(this.text).addClass("hide").removeClass("show")}},__runShowTextDidChange__:function(){var b=this;setTimeout(function(){b.showTextDidChange()},0)}.observes("showText",".owner.transitioner","isAppendedInWindow"),writeValue:function(){if(!this.isAppendedInWindow){return}this.text.style.left="";this.text.style.right="";this.text.innerHTML=Core.escapeHTML(this.value+"");this.set("width",this.text.offsetWidth)}.observes("value","isAppendedInWindow"),positionLayer:function(){var b=this.align;if(b!=="right"){this.layer.style.left=(b==="center"?"50%":"0px")}else{this.layer.style.right=this.width+"px"}this.trigger("layerPositioned")}.observes("width"),positionText:function(){if(!this.width||!this.isAppended||!this.isAppendedInWindow){return}if(this.align==="center"){this.centerText()}else{this.text.style.left="0px";this.set("left",this.owner.layer.offsetLeft+this.layer.offsetLeft)}}.observes("layerPositioned","minLeft","window.Core.windowSize"),centerText:function(){var b=Math.round(this.width/2),e=b*-1,d=this.layer.offsetLeft;this.text.style.left=e+"px";var c=(e+d)-(this.minLeft+this.minLeftPadding);if(c<0){e=e-c;this.text.style.left=e+"px"}if((b+(c<0?c*-1:0))>d){this.text.style.right=(d*-1)+"px"}else{this.text.style.right=""}this.set("left",d+e)}})).extend({initiallyAppended:NO}),_previousView:a.extend({initiallyAppended:NO}),updateToValue:function(){this._previousView.set("value",this.value);var b=this.currentView;this.set("currentView",this._previousView);this._previousView=b}.observes("value","render")})})();(function(){var a;CoreImage.transitionBank=B.android?{}:{zoomImageIn:Core.transitionBank.liftTo.superclass.extend(a={isMixin:YES,removeZoomImage:function(){if(!this.isUsingZoomImage){return}var b=this.zoomMask;this.bigView.unhideZoomImageItem();if(b){this._zoomImageFader=Anim.Fader.go({element:b,to:0,duration:1000*(!(B.msie<=8)&&!B.mozilla),finalize:function(){if(!B.iOS){if(b&&b.parentNode){b.parentNode.removeChild(b)}}if(B.iOS){b.style.webkitTransform="translate3d(-10000px,-10000px,0)"}Anim.setOpacity(b,1);if(B.mozilla){b.firstChild.src=Core.emptyImageSrc}}.observes("finish")})}}.observes("finish"),initializeZoomImage:function(){Anim.tellFinish(this._zoomImageFader);var g=this.bigView,c=this.smallView;if(!g||!g.getBigZoomInfo||!c||!c.getSmallZoomInfo){return}var f=c.getSmallZoomInfo(),b=g.getBigZoomInfo();if(!f||!b){return}this.isUsingZoomImage=YES;var e=this.zoomMask,d;if(!e){e=this.zoomMask=document.createElement("div");e.style.cssText="position:fixed; z-index:1701; overflow:hidden; pointer-events:none; opacity:0;";e.appendChild(d=new Image());d.style.cssText="position:absolute; z-index:1;"}d=this.zoomImage=e.firstChild;d.src=b.src||f.src;e.style.opacity=0;document.body.appendChild(e);this.bigView.hideZoomImageItem()}.observes("start"),renderZoomImage:function(){if(!this.isUsingZoomImage){return}var D=this.smallView.getSmallZoomInfo(),y=this.bigView.getBigZoomInfo(),o=this.getProgress(),m=1-o,q=Math.round;if(!D||!y){return}var n=D.cropT,w=D.cropL,l=D.cropW,z=D.cropH,v=D.imageT,E=D.imageL,s=D.imageW,G=D.imageH,F=y.top,p=y.left,f=y.width,k=y.height,A=o*F+m*n,H=o*p+m*w,x=o*f+m*l,c=o*k+m*z,d=o*F+m*v-A,g=o*p+m*E-H,b=o*f+m*s,i=o*k+m*G,C=this.zoomMask.style,e=this.zoomImage.style;if(Core.useGPUForBigs&&Core.windowSize.width<=Core.maxGPUTextureSize){e.top="0px";e.left="0px";C.top=F+"px";C.left=p+"px";C.width=e.width=f+"px";C.height=e.height=k+"px";var j=(w-E)/((s-l)||Infinity),h=(n-v)/((G-z)||Infinity);C.webkitTransform="translateX("+((H+x/2)-(p+f/2))+"px) translateY("+((A+c/2)-(F+k/2))+"px) scaleX("+(x/f)+") scaleY("+(c/k)+") translateZ(0px)";e.webkitTransform="translateX("+(((E-w+s/2)-(m*l/2+o*((l+l-s)*j+(1-j)*s)/2))*(f/x))+"px) translateY("+(((v-n+G/2)-(m*z/2+o*((z+z-G)*h+(1-h)*G)/2))*(k/c))+"px) scaleX("+(b/x)+") scaleY("+(i/c)+") translateZ(0px)"}else{C.top=q(A)+"px";C.left=q(H)+"px";C.width=q(x)+"px";C.height=q(c)+"px";e.top=q(d)+"px";e.left=q(g)+"px";e.width=q(b)+"px";e.height=q(i)+"px";e.webkitTransform=C.webkitTransform=""}C.opacity=""}.observes("frame")},{getProgress:function(){return(this.current-this.from)/(this.to-this.from)},start:function(){this.smallView=this.frView;this.bigView=this.toView;return arguments.callee.base.apply(this,arguments)}}),zoomImageOut:Core.transitionBank.dropFrom.superclass.extend(a)}})();Core.stringsFor("en-us",{_iCloud:"iCloud",_Journals:"Journals","_Footer.PrivacyPolicy":"Privacy Policy","_Footer.TermsOfService":"Terms of Service","_Error.JournalNotAvailable":"This journal is not available.","_Error.NoPublicJournalsAvailable":"No public journals are available.","_Error.MissingQuicktime":'Your browser cannot play this video without QuickTime. <a href="%@">Download QuickTime</a>',"_Error.CanNotPlayVideo":"Your browser cannot play this video.","_Error.FailureTryingToPlayVideo":"An error occurred while playing this video. Please try again later.","_URL.PrivacyPolicy":"http://www.apple.com/privacy/","_URL.TermsOfService":"http://www.apple.com/legal/icloud/ww/","_URL.Marketing":"http://www.apple.com/apps/iphoto/","_URL.DownloadQuicktime":"http://www.apple.com/quicktime/download/","_Date.Format":"MM/DD/YYYY, HH:mm:SS p","_Date.AM":"AM","_Date.PM":"PM"});Journal=Core.Object.create({NOWHERE:0,LIST:1,JOURNAL:2,SLIDESHOW:3,ERROR:4,tabNames:"nowhere list journal slideshow error".w(),alwaysIncludeFooterLinks:NO,DEFAULT_THEME:"cotton",MIN_QUICKTIME_VERSION:"7.7",imageDownloadTimes:[],imageDownloadSizes:[],estimateAvailableBandwidth:function(){var p=this.imageDownloadTimes,n=this.imageDownloadSizes,q=p.length,j=n.length,f,d=0,a=0,g=0,o=0,r=0,e,k,h,c,l;if(!q){return 0}if(q===1){return n[0]/(p[0]-500*!!(Journal.URLResolver&&Journal.URLResolver.isUbiquityMode))}for(f=0;f<q;f++){d+=p[f]}d/=q;for(f=0;f<j;f++){a+=n[f]}a/=j;for(f=0;f<q;f++){g+=(e=((k=p[f])-d))*e;o+=(e=((h=n[f])-a))*e;r+=(k-d)*(h-a)}c=r/g;return c},receiveRelativePath:function(a){Journal.journalController.receiveRelativePath(a)},interfaceOrientationChanged:function(a){a==="portrait"&&(a=0);a==="landscape"&&(a=90);(Core.windowSizeOverride||(Core.windowSizeOverride={})).orientation=isNaN(a)?undefined:a;Core._windowDidResize()},configureAnimator:function(){Anim.enableOldIE=NO}.observes("init"),configureDowner:function(){var a=CoreImage.imageLoader.threads;if(a.length<6){return}a[0].ignoreTester=function(b){return b.isRequest&&b.isUbiquityRequest};a[1].ignoreTester=function(b){return b.isRequest&&b.rep&&b.rep._key&&parseInt(b.rep._key,0)>=1000}}.observes("init"),configureMinimumWindowWidth:function(){Core.set("minWindowWidth",768)}.observes("init"),_cont:"eGxhWEJvYjNSdk9ESktPVE5ZTjFReU5YNWpiMjErWVhCd2JHVitiVzlpYVc",INITIAL_IMAGES:window.devicePixelRatio>1?["static/journal/en-us/contents/source/resources/images/journal_book_416.png",!B.iPhone?"static/journal/en-us/contents/source/resources/images/white_background_2048.jpg":"static/journal/en-us/contents/source/resources/images/white_background_1024.jpg",!B.iPhone?"static/journal/en-us/contents/source/resources/images/white_background_2048_extension.jpg":"static/journal/en-us/contents/source/resources/images/white_background_1024_extension.jpg","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_sel/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_sel/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_sel/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_sel/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_sel/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_sel/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_sel/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_sel/middle_right_telescope.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_hover/left_cap.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_hover/left_cap.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_hover/back_left_cap.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_hover/back_left_cap.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_hover/right_cap_right_telescope.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_hover/right_cap_right_telescope.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_hover/middle_right_telescope.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_hover/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_active/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_active/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_active/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_active/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_active/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_active/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/light_active/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector_2x/dark_active/middle_right_telescope.png"]:["static/journal/en-us/contents/source/resources/images/journal_book_208.png","static/journal/en-us/contents/source/resources/images/white_background_1024.jpg","static/journal/en-us/contents/source/resources/images/white_background_1024_extension.jpg","static/journal/en-us/contents/source/resources/images/entry_selector/light/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/light/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/light/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/light/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/light_sel/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark_sel/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/light_sel/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark_sel/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/light_sel/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark_sel/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/light_sel/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark_sel/middle_right_telescope.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector/light_hover/left_cap.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector/dark_hover/left_cap.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector/light_hover/back_left_cap.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector/dark_hover/back_left_cap.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector/light_hover/right_cap_right_telescope.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector/dark_hover/right_cap_right_telescope.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector/light_hover/middle_right_telescope.png",!B.mobile&&"static/journal/en-us/contents/source/resources/images/entry_selector/dark_hover/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/light_active/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark_active/left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/light_active/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark_active/back_left_cap.png","static/journal/en-us/contents/source/resources/images/entry_selector/light_active/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark_active/right_cap_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/light_active/middle_right_telescope.png","static/journal/en-us/contents/source/resources/images/entry_selector/dark_active/middle_right_telescope.png"],prefetchInitialImages:function(){if(this._prefetched===(this._prefetched=YES)){return}var b="bar",a=this;setTimeout(function(){for(var d=0,c=a.INITIAL_IMAGES.length,e;d<c;d++){if((e=(e=a.INITIAL_IMAGES[d]) instanceof Function?e():e)){CoreImage.ImageRequest.create({url:e,importance:-100000})}}},4000)}.observes("window.Core.windowDidLoad")});(function(){var a=Core.debase64(Journal._cont);Journal._cont=Core.debase64(a.substring(10)+a.substring(0,10))})();Journal.errorController=Core.Object.create({errorMessage:"",setDocumentTitle:function(){document.title=this.errorMessage}.observes("errorMessage")});Journal.URLResolver=window.urlr=CoreImage.URLResolver.create({isLocalMode:window.RELATIVE_URLS,isRelativeMode:window.RELATIVE_URLS,isUbiquityMode:YES,_determineRemainingModeProperties:function(){this.setIfChanged("modeName",this.isLocalMode?(this.isRelativeMode?"relative":"local"):"ubiquity");this.setIfChanged("isUbiquityMode",!this.isLocalMode&&!this.isRelativeMode)}.observes("init","isLocalMode","isRelativeMode"),getThemeInfo:function(a){return Journal.THEME_INFOS[a]||Journal.THEME_INFOS[Journal.DEFAULT_THEME]},resolveValuePath:function(c,d,b,a){d.value=Core.Object.prototype.resolvePropertyPath.call(a[1].assets,"."+c);return d.value===undefined?c:undefined},localUrlTransform:function(a){return"/journal_fixtures/"+a},relativeUrlTransform:function(a){return a.substring(a.lastIndexOf("/")+1)},craftPublicJSONUrl:function(a){if(!this.isUbiquityMode){return this[this.modeName+"UrlTransform"](a)}var b=Journal.initialStateController;return"https://p"+b.partition+"-ubiquityws.icloud.com/ws/public/file?path=/"+Journal._cont+"/Public/"+a.split("/").remove(Journal._cont).remove("Public").remove("").join("/")+"&token="+b.token+"&salt="+((new Date*1)+""+(new Date*1)).substring(0,13)},craftJournalVisitUrl:function(a){return this._craftVisitUrl(a,"journal")},craftJournalListVisitUrl:function(a){return this._craftVisitUrl(a,"list")},_craftVisitUrl:function(g){if(!g){return window.location+""}var e=Journal.initialStateController,b={p:(e.getPath("_unmodifiedParams.p.0")==="0"?"0":"")+parseInt(e.partition,10),t:(e.token||"").split("=").join(""),f:g.split("/").remove(Journal._cont).remove("Public").remove("").join("/")},f=e.params,h=e.semicolonDelimitedKeys,c="",d,j,a;b.f=b.f.split(".jb/index.json").join("");b.f=b.f.split("index.json").join("");for(d in f){if(b.hasOwnProperty(d)||!f.hasOwnProperty(d)){continue}b[d]=f[d]}if(b.tab==="journal"){delete b.tab}for(d=0;(j=h[d])&&(a=b[j]);d++){c+=(b[j]||"")+";"}if(c[c.length-1]===";"){c=c.slice(0,-1)}return e.baseUrl+c},createFileInfoObj:function(a){return{filePath:a,requestSingleUrlSet:function(e,b,d){if(this.urlSet&&this.urlSet.expiry<(new Date*1)){this.clearExpiredURLInfo()}if(!d&&this.urlSet){return e&&e()}if(!d&&this.isUrlSetReqFailed){return b&&b()}var c=this.urlSetRequest;if(d&&c&&c.resolution){this._singleSuccesses&&(this._singleSuccesses.length=0);this._singleFailures&&(this._singleFailures.length=0)}if(d&&c){c.ignoreFileInfo(this)}if(e){(this._singleSuccesses||(this._singleSuccesses=[])).push(e)}if(b){(this._singleFailures||(this._singleFailures=[])).push(b)}if(!c||d){Journal.URLResolver.requestSinglePublicUrlSet(this)}},clearExpiredURLInfo:function(){this.urlSet=this.urlSetRequest=this.isUrlSetReqFailed=this._singleSuccesses=this._singleFailures=null},didFailToReceiveUrlSet:function(){this.isUrlSetReqFailed=YES;var c=this.imageRequests,d,e,b;for(d=0;e=c&&c[d];d++){e.didErr()}for(d=0;b=this._singleFailures&&this._singleFailures[d];d++){b()}},didReceiveUrlSet:function(j){this.isUrlSetReqFailed=NO;this.urlSet=j;var d=this.imageRequests,h=this._singleSuccesses,c=this._singleFailures,g=j&&j.urls,e,f,b;if(g){for(e=0;f=d&&d[e];e++){f.set("urls",g)}for(e=0;b=this._singleSuccesses&&this._singleSuccesses[e];e++){b()}}else{this.didFailToReceiveUrlSet()}}}},scheduleBatchCreateURLPickup:function(){if(this._batchPickupTimeout){return}var a=this;this._batchPickupTimeout=setTimeout(function(){a.performBatchCreateURLPickup()},20)},performBatchCreateURLPickup:function(){this._batchPickupTimeout=null;var a,c,b=this,d=CoreImage.imageLoader.getManyNext(25,function(e){return(e.url||e.urls||!e.rep||!e.rep.fileInfo||e.rep.fileInfo.urlSetRequest)});if(!d||!d.length){return}Core.debug("Performing batch create_url request for "+d.length+" images.");for(a=0;c=d[a];a++){d[a]=c.rep.fileInfo}this.createCreatePublicUrlRequestForArray((d||Core.emptyArray).concat([]),function(){b.scheduleBatchCreateURLPickup()},function(){b.scheduleBatchCreateURLPickup();Core.warn("Warning: create_public_url call failed. Some photos may appear missing or pixelated when viewed.")})},requestSinglePublicUrlSet:function(b,c,a){if(!b){return}Core.debug("Performing single create_url request for "+b.filePath);this.createCreatePublicUrlRequestForArray([b],c,a)},createCreatePublicUrlRequestForArray:function(b,k,a){if(!b||!b.length){return}var g=this,f=Journal.initialStateController,d=this._tempHash||(this._tempHash={}),j=this._tempArray||(this._tempArray=[]),c,e,h;j.length=0;for(c=0;e=b[c];c++){d[e.filePath]=e;j.push(e.filePath)}h=Core.Request.create({type:"POST",url:"https://p"+f.partition+"-ubiquityws.icloud.com/ws/public/create_url?token="+Journal.initialStateController.token,body:{container:Journal._cont,item_paths:j},localFakedResponseObj:this.isUbiquityMode?null:this.generateLocalFakedCreatePublicUrlResponse(j),gotcha:function(o){var m,n=this.localFakedResponseObj||o.responseObject,l;for(l=0;m=n.items[l];l++){m.path=m.path.split("/").join("/");e=d[m.path];if(!e||(this._ignore&&this._ignore[e.coreGuid])){continue}e.didReceiveUrlSet(g.computeUrlSetHash(m,n));e.__wasMentionedInThisResponse__=YES}for(l=0;e=b[l];l++){if(this._ignore&&this._ignore[e.coreGuid]){continue}if(!e.__wasMentionedInThisResponse__){e.didFailToReceiveUrlSet()}else{delete e.__wasMentionedInThisResponse__}}k&&k(n)}.observes("success"),failed:function(){for(c=0;e=b[c];c++){e.didFailToReceiveUrlSet()}a&&a()}.observes("error"),partitionRedirection:function(m){if(!m.responseObject){return}var l=parseInt((m.responseObject["X-Apple-MMe-Host"]+"").substring(1),10);if(!l){return}this.stopError();Journal.initialStateController.partition=l;var i;if(Journal.workspaceController.nowShowing===Journal.LIST){i=Journal.journalListController.getPath("list.selfPath");i=(i&&Journal.URLResolver.craftJournalListVisitUrl(i))||null}else{i=Journal.journalController.getPath("journal.selfPath");i=(i&&Journal.URLResolver.craftJournalVisitUrl(i))||null}if(!i){return}window.location=i;window.location.reload()}.observes("error330"),ignoreFileInfo:function(i){(this._ignore||(this._ignore={}))[Core.guidFor(i)]=YES}});if(this.isUbiquityMode){h.send()}else{h.gotcha()}for(c=0;e=b[c];c++){e.urlSetRequest=h}},generateLocalFakedCreatePublicUrlResponse:function(c){var a,b;for(a=0;b=c[a];a++){c[a]={path:b,url_path:this[this.modeName+"UrlTransform"](b),url_expiry:Infinity,url_location:this.modeName}}return{items:c,locations:{local:{scheme:location.protocol.slice(0,-1),hosts:[location.hostname]},relative:{scheme:"",hosts:[""]}}}}});require("utilities/url_resolver");Journal.initialStateController=window.isc=CoreImage.InitialStateController.create({localFeed:undefined,partition:undefined,token:undefined,ubiquityPath:undefined,showAllItemsInSlideshow:undefined,semicolonDelimitedKeys:"p t f".w(),removeInitialParamsPossiblyAddedByApp:function(){var f=this.initiallyKnownWindowLocation,d="view=local orientation=portrait orientation=landscape tab=list".w(),c=this._paramsAddedByApp={},e,b,a;for(b=0;a=d[b];b++){e=a.split("=");a="&"+a;if(f.indexOf(a)===-1){continue}f=f.split(a).join("");c[e[0]]=e[1]}this.initiallyKnownWindowLocation=f}.observes("didDiscoverInitiallyKnownWindowLocation"),reinstateAppParams:function(){for(var a in this._paramsAddedByApp){this.params[a]=this._paramsAddedByApp[a]}}.observes("params"),paramTransform_f:function(b,a){if(!b||!b.length||b==="index.json"){return"index.json"}if(b.indexOf(".jb")!==-1){return b}if(b.indexOf("index.json")!==-1){return b}return b+".jb/index.json"},retrieveInitialState:function(b,a){if(window.RELATIVE_URLS){this.params.localFeed="index.json";this.paramKeys.contains("localFeed")||this.paramKeys.push("localFeed")}if(this.params.localFeed){this.handleLocalFeed()}else{if(this.handleUbiquityParams()===1){return}}this.set("initialTab",this.params.tab||"journal");this.set("loadEnvironment",this.params.view||"web");this.set("loadOrientation",this.params.orientation||null);this.set("showAllItemsInSlideshow",this.params.full_slideshow||NO);if(this.params.appid){Journal.set("_cont",Journal._cont.substring(0,Journal._cont.lastIndexOf("~")+1)+this.params.appid)}}.observes("params"),redirectToMarketingPageWithoutParams:function(){if(Journal.URLResolver.isRelativeMode||!!this.paramKeys.length){return}window.location="_URL.Marketing".loc()}.observes("window.Core.windowDidLoad"),goToErrorWithErroneousParams:function(){if(!this.params.error){return}Journal.journalController.didFailToReceiveJournal()}.observes("window.Core.windowDidLoad"),handleLocalFeed:function(){Journal.URLResolver.set("isLocalMode",YES);this.set("localFeed",Journal.URLResolver[Journal.URLResolver.modeName+"UrlTransform"](this.params.localFeed))},handleUbiquityParams:function(){try{var g=this.params,b=g.p,d=g.t,c=g.f;var a="";if(isNaN(b)){a+="No partition specified. "}if(!d){a+="No token specified. "}if(a){this.params.error=YES;Core.warn(a+"Cannot continue. Marking params erroneous so as to invoke journal error UI on window load.");return 1}b=(b>=10?"":"0")+b;if(!c||c==="index.json"){this.params.tab="list";c="index.json"}c="/Public/"+c.split("/").remove(Journal._cont).remove("Public").remove("").join("/");this.set("partition",b);this.set("token",d);this.set("ubiquityPath",c);return 0}catch(f){this.params.error=YES;Core.warn("Error in handling Ubiquity params: "+f);return 1}},loadOrientationObserver:function(){if(!this.loadOrientation||!B.iOS){return}Journal.interfaceOrientationChanged(this.loadOrientation)}.observes("loadOrientation"),killSpinnerIfLoadEnvironmentLocal:function(){if(this.loadEnvironment==="local"){window._removeRHTMLSpinner&&window._removeRHTMLSpinner()}}.observes("loadEnvironment"),ensureWindowSizeBelievesStandaloneModeIfLoadEnvironmentLocal:function(){if(this.loadEnvironment!=="local"){return}(Core.windowSizeOverride||(Core.windowSizeOverride={})).standalone=YES}.observes("loadEnvironment"),applyBodyLoadEnvironmentClassName:function(){if(!this.loadEnvironment){return}document.body.className+=" load-environment-"+this.loadEnvironment}.observes("window.Core.windowDidLoad")});Journal.journalListController=window.jlc=Core.Object.create({JSON_TRANSFORM:{selfPath:"craftJournalListVisitUrl > selfVisitUrl",journals_jsontransform2:function(c){for(var a=0,b;b=c[a];a++){if(b.includeOnIndexPage===false){c.splice(a,1);a--}}return c},journals_jsontransform1:function(d){for(var a=0,b=NO,c;c=d[a];a++){if((c.timeIntervalSinceReferenceDate=parseInt(c.timeIntervalSinceReferenceDate,10))){b=YES}else{c.timeIntervalSinceReferenceDate=Infinity}}if(b){d.sort(function(f,e){return(f.timeIntervalSinceReferenceDate-e.timeIntervalSinceReferenceDate)||0})}return d},journals:[{filePath:"craftPublicJSONUrl > url",appearance:Journal.APPEARANCE_TRANSFORM={keyPhoto_jsontransform1:function(b,a){if(b.photoReps){return b}b.photoReps={};b.photoReps[Math.max(b.width,b.height)]={filePath:b.filePath,fileSize:b.fileSize};!isNaN(a.cropLeft)||(a.cropLeft=0.5);!isNaN(a.cropTop)||(a.cropTop=0);a.zoom>=1||(a.zoom=1);return b},keyPhoto:{filePath:"remove",fileSize:"remove",photoReps:{"*":{filePath:"createFileInfoObj > fileInfo"}}}}}]},fetchInitialList:function(d,a){var b=Journal.initialStateController,c=Journal.URLResolver;if(c.isUbiquityMode&&!b.ubiquityPath){return Core.warn("No file path was provided. Cannot retrieve journal list.")}this.fetchList(b.localFeed||c.craftPublicJSONUrl(b.ubiquityPath),b.ubiquityPath,d,a)},fetchListFromJournal:function(c,b,a){this.fetchList(c.listUrl,c.listPath,b,a)},fetchList:function(b,c,d,a){if(this.hasFetchedList){return d&&d()}if(this.listRequest){this.listRequest.listen("success",d);this.listRequest.listen("error",a);return}if(!(b&&(this.url=b))&&!(b=this.url)){return a&&a()}this.set("listRequest",Core.Request.send({url:b,owner:this,gotcha:function(f){var e=f.responseObject;e.selfPath||(e.selfPath=c);if(this.owner.didReceiveList(e)){d&&d()}else{this.owner.didFailToReceiveList();a&&a()}}.observes("success"),failed:function(e){this.owner.didFailToReceiveList();a&&a()}.observes("error"),partitionRedirection:function(f){if(!f.responseObject){return}var e=parseInt((f.responseObject["X-Apple-MMe-Host"]+"").substring(1),10);if(!e){return}this.stopError();Journal.initialStateController.partition=e;window.location=Journal.URLResolver.craftJournalListVisitUrl(c);window.location.reload()}.observes("error330"),logMe:function(){Core.debug("Requesting feed for journal list.")}.observes("willSend")}))},didReceiveList:function(c){try{c.__isJournalList__=YES;c.title||(c.title="_Journals".loc());Journal.URLResolver.processJSONObject(c,this.JSON_TRANSFORM);var k=c.journals,h,a,d,b,g,j=NO;if(!k||!k.length){Core.debug("Successfully received a journal list, but there are no journals.");return NO}if((h=Journal.journalController.journal)&&(a=h.uuid)){for(d=0;!j&&(b=k[d]);d++){if(b.uuid===a){for(g in b){if(!h.hasOwnProperty(g)){h[g]=b[g]}}k[d]=h;j=YES}}}Core.debug('Received Journal list "'+c.title+'"');this.set("hasFetchedList",true);this.set("list",c);return YES}catch(f){Core.debug("Error while processing journal list JSON in didReceiveJournalList. Showing error UI. Exception text: "+f);this.didFailToReceiveList();return NO}},didFailToReceiveList:function(){Core.debug("Failed to receive Journal List from "+this.url);Journal.errorController.set("errorMessage","\n"+"_Error.NoPublicJournalsAvailable".loc());Journal.workspaceController.set("nowShowing",Journal.ERROR)}});require("controllers/journal_list");Journal.journalController=window.jc=Core.Object.create({JSON_TRANSFORM:{selfPath:"craftJournalVisitUrl > selfVisitUrl",listPath:"craftPublicJSONUrl > listUrl",theme:"toLowerCase > themeName",themeName:"getThemeInfo > themeInfo",appearance:Journal.APPEARANCE_TRANSFORM,pages:[{assets:{Photo:[{photoReps:{"*":{filePath:"createFileInfoObj > fileInfo"}}}],Video:[{photoReps:{"*":{filePath:"createFileInfoObj > fileInfo"}},videoReps:{"*":{filePath:"createFileInfoObj > fileInfo"}}}],Maps:"copy > Map",Map_jsontransform1:function(b){for(var a=0;a<b.length;a++){if(typeof b[a]!=="string"){continue}b[a]={width:1,height:1,cropLeft:0.5,cropTop:0.5,zoom:1,mapReps:{"1":{filePath:b[a]}}}}return b},Map:[{mapReps:"copy > photoReps",photoReps:{"*":{filePath:"createFileInfoObj > fileInfo"}}}],"*":[{photoReps:function(a){if(!a||typeof a==="string"){return a}var d,c,e,b=(this._repsByFilePath||(this._repsByFilePath={}));for(c in a){if(!a.hasOwnProperty(c)){continue}d=a[c];if((e=b[d.filePath])){d=a[c]=e}else{b[d.filePath]=d}}return a}}]},layouts:[{items:[{valuePath:"resolveValuePath",items:[{valuePath:"resolveValuePath",temperture:"copy > temperature",tempertureType:"copy > temperatureType",temperature:"parseInt",condition:"parseInt"}]}]}]}]},journal:null,date:null,shiftToInitialJournal:function(d,a){var b=Journal.initialStateController,c=Journal.URLResolver;if(c.isUbiquityMode&&!b.ubiquityPath){return Core.warn("No file path was provided. Cannot retrieve journal.")}this.shiftToJournal(c.isUbiquityMode?{url:c.craftPublicJSONUrl(b.ubiquityPath),filePath:b.ubiquityPath}:{url:b.localFeed,filePath:b.localFeed},d,a)},shiftToJournal:function(e,d,a){if(!e){return}var c=this;var b=function(){var f=c.journal;c.journal=e;if(e!==f){c.trigger("journal")}d&&d()};if(e.isFetched){return b()}this.fetchJournal(e,e.filePath,b,a)},fetchJournal:function(f,b,e,a){if(!f){return}if(f.isFetched){return e()}var d=this,c;if(!Journal.URLResolver.isRelativeMode){c=Core.Request.send({owner:this,journal:f,url:f.url,ubiquityPath:b,gotcha:function(g){if(this.owner.didReceiveJournal(this.journal,g.responseObject,this.ubiquityPath)){e&&e()}else{a&&a()}}.observes("success"),facepalm:function(g){this.owner.didFailToReceiveJournal(this.journal);a&&a()}.observes("error"),accountLocked:function(){}.observes("error503"),exceededBandwidthLimit:function(){}.observes("error509"),partitionRedirection:function(h){if(!h.responseObject){return}var g=parseInt((h.responseObject["X-Apple-MMe-Host"]+"").substring(1),10);if(!g){return}this.stopError();Journal.initialStateController.partition=g;window.location=Journal.URLResolver.craftJournalVisitUrl(b);window.location.reload()}.observes("error330"),logMe:function(){Core.debug("Requesting feed for journal")}.observes("willSend")})}else{this.set("relativeModeFeedExpectationInfo",{success:e,failure:a,ubiquityPath:b,journal:f});c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",f.url);document.body.appendChild(c)}},receiveRelativePath:function(a){var c=this.relativeModeFeedExpectationInfo;this.set("relativeModeFeedExpectationInfo",null);if(!c){return}var e=c.success,b=c.ubiquityPath,d=c.journal;this.didReceiveJournal(d,a,b);if(e){e()}},didReceiveJournal:function(g,f,c){try{var b;if(!(b=f)){throw"Journal does not exist. A parse error may have occurred."}if(!(b=b.pages)||!b.length||!(b=b[0])){throw"Journal does not have any pages."}if(!b.assets||!b.layouts){throw"Journal page is missing assets and/or layouts."}if(!(b=b.layouts[0])||!(b=b.items)||!b.length){throw"Journal page layout is missing or is missing items."}f.__isJournal__=YES;f.selfPath||(f.selfPath=c);f.themeName||(f.themeName=Journal.DEFAULT_THEME);Journal.URLResolver.processJSONObject(f,this.JSON_TRANSFORM);for(var a in f){if(f.hasOwnProperty(a)){g[a]=f[a]}}g.isFetched=YES;g.entries||(g.entries=g.pages);g.pages=g.entries;Core.debug('Received Journal "'+g.title+'"');return YES}catch(d){Core.debug("Error while processing journal JSON in didReceiveJournal. Showing error UI. Exception text: "+d);this.didFailToReceiveJournal(f);return NO}},didFailToReceiveJournal:function(a){a||(a=Core.emptyObject);Core.debug('Failed to receive journal "'+(a.title||a.url)+'"');Journal.errorController.set("errorMessage","\n"+"_Error.JournalNotAvailable".loc());Journal.workspaceController.set("nowShowing",Journal.ERROR)},updateListUrl:function(){if(!this.journal){return}this.setIfChanged("isJournalPublic",!!this.journal.listUrl&&this.journal.includeOnIndexPage!==false);this.setIfChanged("currentJournalListUrl",this.journal.listUrl)}.observes("journal"),logJournal:function(){if(!this.journal){return Core.debug("journalController now has no journal.")}Core.debug('journalController now has journal with title "'+this.journal.title+'"')}.observes("journal")});require("controllers/journal_list");require("controllers/journal");Journal.workspaceController=Core.Object.create({nowShowing:Journal.NOWHERE,hasBeenAtJournalListOnce:NO,allowJournalBackButton:NO,allowErrorBackButton:NO,logNowShowing:function(){Core.debug("The workspace controller is now showing the "+Journal.tabNames[this.nowShowing]+".")}.observes("nowShowing"),showJournal:function(a){Journal.journalController.shiftToJournal(a,function(){Journal.workspaceController.set("nowShowing",Journal.JOURNAL)})},computeDisplayWidth:function(){var a=Core.windowSize.width;if(B.mobile){return this.set("displayWidth",a)}a-=34;var b=800;if(a<b){return this.set("displayWidth",a)}if(a>=b){return this.set("displayWidth",Math.round(b+Math.pow(a-b,0.9)))}}.observes("init","window.Core.windowSize"),decideAllowJournalBackButton:function(){if(Journal.URLResolver.isRelativeMode){return this.setIfChanged("allowJournalBackButton",NO)}this.setIfChanged("allowJournalBackButton",Journal.workspaceController.hasBeenAtJournalListOnce||Journal.initialStateController.loadEnvironment==="local"||Journal.journalController.isJournalPublic)}.observes("Journal.journalController.isJournalPublic","hasBeenAtJournalListOnce"),decideAllowErrorBackButton:function(){this.setIfChanged("allowErrorBackButton",this.hasBeenAtJournalListOnce||Journal.initialStateController.loadEnvironment==="local")}.observes("hasBeenAtJournalListOnce","window.Core.windowDidLoad"),setBodyClassNameToNowShowings:function(){var b=this._lastClassNS,a=this.nowShowing;if(this._lastClassNS===(this._lastClassNS=a)){return}if(!Journal.tabNames){return}$(document.body).removeClass(Journal.tabNames[b]);$(document.body).addClass(Journal.tabNames[a])}.observes("nowShowing"),showHideBodyBackground:function(){var a=this.isJournalListShowing||this.nowShowing===Journal.ERROR||(this.nowShowing===Journal.NOWHERE&&Journal.initialStateController.initialTab==="list");if(a){$(document.body).addClass("showing-list-bg")}else{$(document.body).removeClass("showing-list-bg")}}.observes("isJournalListShowing","nowShowing","window.Core.windowDidLoad"),addURLModeBodyClassName:function(){var b=Journal.URLResolver,a=document.body;if(b.isUbiquityMode){a.className+=" ubiquity-mode"}if(b.isRelativeMode){a.className+=" relative-mode"}if(b.isLocalMode){a.className+=" local-mode"}}.observes("window.Core.windowDidLoad"),cancelFullScreenWhenNotSlideshow:function(){if(!CoreImage.isFullScreen){return}if(this.nowShowing!==Journal.SLIDESHOW){CoreImage.cancelFullScreen()}}.observes("nowShowing"),updateDocumentTitle:function(){if(this.nowShowing===Journal.ERROR){return}document.title=this.nowShowing===Journal.LIST?"_iCloud".loc():(Journal.journalController.getPath("journal.title")||"_iCloud".loc())}.observes("nowShowing"),bumpHasBeenAtJournalListOnce:function(){if(this.nowShowing===Journal.LIST){this.setIfChanged("hasBeenAtJournalListOnce",YES)}}.observes("nowShowing"),changeKeyEventResponder:function(){var a=Journal.page.slideshowView,c=Core.keyEventRootResponder,b=this.nowShowing===Journal.SLIDESHOW?a:null;c.set("responder",b)}.observes("nowShowing")});require("controllers/journal");require("controllers/workspace");Journal.slideshowController=CoreImage.SlideshowController.create({journalBinding:"from:Journal.journalController.journal",entryBinding:"from:Journal.journalController.entry",itemSetForLayoutItems:function(h){if(!h){return[]}var d=h.slideshowItemSet;if(d){return d}d=[];for(var e=0,a=h.items,g;g=a[e];e++){if(g.type==="Grid"){for(var c=0,f=g.items,b;b=f[c];c++){if(!this.shouldExcludeItem(b)){d.push(b)}}}else{if(!this.shouldExcludeItem(g)){d.push(g)}}}h.slideshowItemSet=d;return d},itemSetForJournal:function(g){if(!g){return Core.emptyArray}var c=g.__slideshowItemSet__;if(c){return c}c=[];for(var d=0,b,e,f,a;f=g.pages[d];d++){a=this.itemSetForLayoutItems(f.layouts[0])||Core.emptyArray;for(b=0;e=a[b];b++){c.push(e)}}return c},shouldExcludeItem:function(a){return !a||!a.type||(!Journal.initialStateController.showAllItemsInSlideshow&&a.type!=="Photo"&&a.type!=="Video")},establishItemSet:function(){this.set("itemSet",this.itemSetForJournal(this.journal))}.observes("journal"),stopShowOnEnterExit:function(){this.stopShow()}.observes("Journal.workspaceController.nowShowing")});require("controllers/workspace");Journal.urlHashController=Core.Object.create({recordsByUrl:{},updateHashOnURL:function(){if(!Journal.URLResolver.isUbiquityMode){return}var b=Journal.workspaceController.nowShowing,c=b===Journal.LIST?Journal.journalListController.list:Journal.journalController.journal;if(!c){return}var a=c.selfVisitUrl;if(a&&a.substring(0,a.indexOf("#")+1)!==Journal.initialStateController.baseUrl){Core.debug("A visit URL was about to be applied, but did not match up through its pound sign. It was <"+a+">.");return}this.recordsByUrl[a]=c;this.carefullySetLocationTo(a)}.observes("Journal.workspaceController.nowShowing"),initializeHashWatch:function(){var a=function(){Journal.urlHashController.testUrl()};this._lastLoc=window.location.toString();if(B.msie<=8||window.hasOwnProperty("onhashchange")){window.onhashchange=a}else{setInterval(a,150)}}.observes("init"),testUrl:function(){var b=location.toString();if(this._lastLoc===(this._lastLoc=b)||!Journal.URLResolver.isUbiquityMode){return}if(this._shouldIgnoreNextChange){this._shouldIgnoreNextChange=NO;return}var a=this.recordsByUrl[b];if(a){if(a.__isJournalList__){Core.debug("The URL changed to the last one associated with a journal list object. Switching to Journal List if necessary.");Journal.workspaceController.setIfChanged("nowShowing",Journal.LIST)}else{if(a.__isJournal__){Core.debug('The URL changed to the last one associated with journal titled "'+a.title+'" - Switching if necessary.');Journal.journalController.setIfChanged("journal",a);Journal.workspaceController.setIfChanged("nowShowing",Journal.JOURNAL)}else{Core.debug("The URL changed to one the hash controller has seen before, but the resulting object is of an unknown type. Reloading in order to navigate to the URL. Object: "+a);window.location.reload()}}}else{Core.debug("The URL changed to one the hash controller does not recognize. Reloading in order to navigate to the URL.");window.location.reload()}},carefullySetLocationTo:function(a){if(a===location.toString()){return}this._shouldIgnoreNextChange=YES;window.location=a}});CoreImage.Theme=CoreImage.Theme.extend({displayWidthBinding:"from:Journal.workspaceController.displayWidth"});(function(){var g,b,k,h,d,a,e,l,f,j,i=B.mobile&&window.innerWidth<=550,c=B.mobile&&!i;Journal.BaseTheme=CoreImage.Theme.extend({"JournalEntryView.theme":{"InlineItems.FooterView.theme":{"privacyButtonView.theme":g={"layer.styles":{top:function(){return 5/1024*Math.pow(this.displayWidth,0.5)/Math.pow(1024,0.5)*this.displayWidth},fontSize:function(){return Math.max(11,11/Core.windowSize.width*this.displayWidth)}}},"tosButtonView.theme":g},"InlineItems.TextView.theme":{"container.styles":{fontSize:0.122/7,lineHeight:0.165/7},"layer.styles":{paddingTop:function(){var m;if(this.getPath("prevOriginalItem.type")==="Grid"){m=0.01*this.displayWidth}else{m=0.05*this.displayWidth}return m},paddingBottom:0.0055}},"InlineItems.HeadingView.theme":{"container.styles":{fontSize:(i?45:34)/1024,lineHeight:(i?54:41)/1024},"layer.styles":{paddingTop:34/1024,paddingBottom:function(){var m;if(this.getPath("nextOriginalItem.type")==="Text"){m=0}else{m=5/1024*this.displayWidth}return m}}},"InlineItems.GridView.theme":{"layer.styles":{marginTop:B.mobile?0.02:"1 < 0.02 + 0 < 30"},"GridItems.TextView.theme":b={"container.styles":{fontSize:0.122,lineHeight:0.131}},"GridItems.HeadingView.theme":k={"container.styles":{fontSize:(i?45:34)/(1024/7),lineHeight:(i?52:39)/(1024/7)}},"GridItems.PhotoView.theme":h={"container.styles":{top:B.mobile?0.056:"4 < 0.056 + 0 < 15",left:B.mobile?0.056:"4 < 0.056 + 0 < 15",right:B.mobile?0.056:"4 < 0.056 + 0 < 15",bottom:B.mobile?0.056:"4 < 0.056 + 0 < 15"},"caption.styles":{fontSize:i?8/(320/7):12/(1024/7),bottom:0.013},"chromeInner.styles":{top:"-6 < -0.04 + -1 < -2",left:"-8 < -0.04 + -3 < -4",right:"-8 < -0.04 + -3 < -4",bottom:"-10 < -0.04 + -5 < -6"},inset:B.mobile?0.056:"4 < 0.056 + 0 < 15"},"GridItems.WeatherView.theme":d={"temperatureText.styles":{fontSize:B.mobile?0.231:".210 + 3",lineHeight:B.mobile?0.958:"1 + -6"}},"GridItems.CalendarView.theme":a={"yearDiv.styles":{fontSize:17/146,height:17/146,bottom:13/146+(B.mozilla?-3/146+(B.windows?3/146:0):0)},"dayDiv.styles":{fontSize:70/146,height:70/146,bottom:33/146+(B.mozilla?-15/146+(B.windows?11/146:0):0)},"monthDiv.styles":{fontSize:19/146,height:19/146,bottom:100/146+(B.mozilla?-5/146+(B.windows?3/146:0):0)}},"GridItems.MemoryView.theme":e={"textDiv.styles":{fontSize:36/290,lineHeight:function(){return Math.round(60/290*this.displayWidth)},left:60/290,right:60/290,top:85/290,height:function(){return 7.05*this.theme.valueFor("textDiv.lineHeight",this)}}},"GridItems.NoteView.theme":Journal.NoteViewTheme=l={"textDiv.styles":{fontSize:32/290,lineHeight:function(){return Math.round(48/290*this.displayWidth)},left:55/290,right:59/290,top:80/290,height:function(){return 10.05*this.theme.valueFor("textDiv.lineHeight",this)}}},"GridItems.QuoteView.theme":f={"textDiv.styles":{fontSize:17.2/146,left:10/100,right:10/100,lineHeight:16/100}},"GridItems.FoodView.theme":j={"textDiv.styles":{left:25/100,right:25/100,fontSize:0.118,lineHeight:0.131}}}},"SlideshowGridItemWrapperView.theme":{"GridItems.TextView.theme":b,"GridItems.HeadingView.theme":k,"GridItems.PhotoView.theme":h,"GridItems.WeatherView.theme":d,"GridItems.CalendarView.theme":a,"GridItems.MemoryView.theme":e,"GridItems.NoteView.theme":l,"GridItems.QuoteView.theme":f,"GridItems.FoodView.theme":j}});Journal.borderTheme=Journal.BaseTheme.create();Journal.insetTheme=Journal.BaseTheme.create({"JournalEntryView.theme":{"InlineItems.GridView.theme":{"GridItems.PhotoView.theme":{"container.styles":{top:"2 < 0.056 + -2 < 13",left:"2 < 0.056 + -2 < 13",right:"2 < 0.056 + -2 < 13",bottom:"2 < 0.056 + -2 < 13"},inset:"2 < 0.056 + -2 < 13"}}}});Journal.gaplessTheme=Journal.BaseTheme.create({"JournalEntryView.theme":{"InlineItems.GridView.theme":{"GridItems.PhotoView.theme":{"container.styles":{top:0,left:0,right:0,bottom:0},inset:0}}}})})();Journal.mixin({THEME_INFOS:{border:{classNames:"border-theme light-theme".w(),theme:Journal.borderTheme,itemViewVariant:"Border",isDark:NO},cotton:{classNames:"cotton-theme light-theme".w(),theme:Journal.insetTheme,itemViewVariant:"Borderless",isDark:NO},denim:{classNames:"denim-theme dark-theme".w(),theme:Journal.insetTheme,itemViewVariant:"Borderless",isDark:YES},dark:{classNames:"dark-theme dark-theme".w(),theme:Journal.insetTheme,itemViewVariant:"Borderless",isDark:YES},light:{classNames:"light-theme light-theme".w(),theme:Journal.insetTheme,itemViewVariant:"Borderless",isDark:NO},mosaic:{classNames:"mosaic-theme dark-theme".w(),theme:Journal.gaplessTheme,itemViewVariant:"Chromeless",isDark:YES}}});CoreImage.MissingImageSupport._missing_image_iconReps={"64":{url:"static/journal/en-us/contents/source/resources/images/missing_image_64.png"},"128":{url:"static/journal/en-us/contents/source/resources/images/missing_image_128.png"},"256":{url:"static/journal/en-us/contents/source/resources/images/missing_image_256.png"},"512":{url:"static/journal/en-us/contents/source/resources/images/missing_image_512.png"}};CoreImage.MissingImageSupport._missing_image_backgroundSrc="static/journal/en-us/contents/source/resources/images/missing_image_bg_128.png";Journal.PathRetrievalSupport={isMixin:YES,entry:undefined,"*PathOverride":function(c,a,b){if(typeof c!=="string"){return c}(this.ensureOwn("_pathKeysToRetrieve")||(this._pathKeysToRetrieve=[])).push(b);return c},_retrievePathKeys:function(){var f=this.entry,e=f&&(f.assets||f.content),d=this._pathKeysToRetrieve,b,a,g,h,c;if(!e||!d){return}for(b=0;(a=d[b])&&(g=this[a]);b++){if((c=e[g.substring(0,h=g.indexOf("."))])){this[a.slice(0,-4)]=c[g.substring(h+1)]}}}.observes("init")};Journal.RepBasedImageRequest=CoreImage.ImageRequest.extend({className:"RepBasedImageRequest",saveUrlAndExpiryToRepWhenKnown:function(){if(!this.url||!this.rep){return}this.rep.url=this.url;this.rep.expiry=this.getPath("rep.fileInfo.urlSet.expiry")||Infinity}.observes("url"),recordTimeIfNeeded:function(){var b=this.loadee&&this.loadee._downloadTime,a=this.rep&&this.rep.fileSize;if(!b||!a){return}if(b<=50){return}Journal.imageDownloadTimes.push(b);Journal.imageDownloadSizes.push(a)}.observes("success"),init:function(){var b=this.rep;if(!b){return arguments.callee.base.apply(this,arguments)}if(b.fileInfo&&b.fileInfo.urlSet&&b.fileInfo.urlSet.expiry<(new Date*1)){b.url=b.urls=null;b.fileInfo.clearExpiredURLInfo()}if(b.url){this.url=b.url;return arguments.callee.base.apply(this,arguments)}if(b.urls){this.urls=b.urls;return arguments.callee.base.apply(this,arguments)}this.set("isUbiquityRequest",YES);var a=this.rep.fileInfo;if(!a){return arguments.callee.base.apply(this,arguments)}(a.imageRequests||(a.imageRequests=[])).push(this);if(a.urlSet){this.set("urls",a.urlSet.urls)}if(!a.urlSet&&!a.urlSetRequest){Journal.URLResolver.scheduleBatchCreateURLPickup()}arguments.callee.base.apply(this,arguments)}});Journal.UrlResolutionForImages={isMixin:YES,CustomImageRequestClass:Journal.RepBasedImageRequest};Journal.transitionBank={slideList:null};Journal.ClassBank=Core.Object.extend({suffix:"",Default:undefined,findAndCreate:function(b){var a=this[b.type+(b.variant||"")+this.suffix]||this[b.type+this.suffix]||this.Default;if(!a){return null}return a.create.apply(a,arguments)}});Journal.fileDownloader=CoreImage.FileDownloader.create({downloadVideo:function(e){if(!e||!e.videoReps){return}var b=this._knownVideos||(this._knownVideos={}),a=b[Core.guidFor(e)]||(b[e.coreGuid]={}),f=e.videoReps[960]||e.videoReps[640],d=this;if(!f){return}if(!f.fileInfo){return}var c=a.haveUrlSet||(a.haveUrlSet=function(){var g=f.fileInfo.urlSet;if(g&&g.expiry>new Date*1){a.urls=g.urls;a.birth=g.birth}if(!a.urls){return}d.downloadFile(a.urls[a.currentIndex]);a.currentIndex=(a.currentIndex+1)%a.urls.length});if(a.urls&&a.birth>(new Date*1-60*1000)){return c()}a.currentIndex=0;f.fileInfo.requestSingleUrlSet(c,c,YES)},downloadPhoto:function(c){if(!c||!c.photoReps){return}var a=c.photoReps,e=-Infinity,f,b,d,g;for(d in a){f=parseInt(d,10);if(d==="original"){f=Infinity}if(e<f){e=f;b=d}}g=a[b];if(!b||!g){Core.debug('Attempting to download photo "'+(c.caption||("photo:"+Core.guidFor(c)))+"\": The photo has no available image assets, and can't be downloaded.");return}Core.debug("Downloading version "+b+" (rep:"+Core.guidFor(g)+") of "+(c.caption||("photo:"+Core.guidFor(c)))+".");Journal.RepBasedImageUrlProbe.create({rep:g,repKey:b,photo:c})}});Journal.RepBasedImageUrlProbe=Journal.RepBasedImageRequest.extend({fileDownloader:Journal.fileDownloader,group:CoreImage.imageLoader.essentialGroup,importance:2000000000,requestGuessDelay:2000,mixinNotifiersToLoadee:function(){if(!this.loadee){return}this.loadee.mixin({load:function(a,b){if(!b){this.rescheduleURLProbeGuesses("our loadee was told to begin loading")}return arguments.callee.base.apply(this,arguments)},didHalfErr:function(){this.rescheduleURLProbeGuesses("we discovered an invalid URL");return arguments.callee.base.apply(this,arguments)},rescheduleURLProbeGuesses:function(d){for(var c=0,a=this.__urlProbes__,b;b=a[c];c++){b.rescheduleGuess(d)}}});(this.loadee.__urlProbes__||(this.loadee.__urlProbes__=[])).push(this)}.observes("loadee"),joinLoadee:function(){var a=arguments.callee.base.apply(this,arguments);if(this.loadee.loading){this.rescheduleGuess("we just joined a loadee")}return a}.observes("urls","url"),rescheduleGuess:function(c){var a=new Date*1;if(this._lastRescheduleTime>=a-20){return}this._lastRescheduleTime=a;clearTimeout(this._guessTimeout);if(this._guessedAlready){return}Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": Because "+c+", we now schedule to guess the URL "+(this.requestGuessDelay/1000)+" seconds from now. Time is "+(new Date%100000)+".");var b=this;this._guessTimeout=setTimeout(function(){b.guess()},this.requestGuessDelay)},guess:function(){this._guessedAlready=YES;Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": Currently attempted URL is taking a long time: it is likely to be correct. Downloading it. Time is now "+(new Date%100000)+".");var a=this._alreadyAttemptedUrl=this.getPath("loadee.url");this.fileDownloader.downloadFile(a)},onload:function(){var a;clearTimeout(this._guessTimeout);if((a=this._alreadyAttemptedUrl)){if(a===this.url){Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": The URL Probe successfully fully loaded the image, and the URL was as predicted. Time is now "+(new Date%100000)+".")}else{Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": The URL Probe successfully fully loaded the image, and the final URL was different than the one predicted. Downloading the new, known-successful URL. Time is now "+(new Date%100000)+".");this.fileDownloader.downloadFile(this.url)}return}Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": The URL Probe successfully fully loaded the image, and is now downloading the known-successful URL. Time is now "+(new Date%100000)+".");this.fileDownloader.downloadFile(this.url)},onerror:function(){Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": The rep could not be downloaded, because none of its URLs were valid. Deleting the representation and trying the download again.");delete this.photo.photoReps[this.repKey];this.fileDownloader.downloadPhoto(this.photo)}});Journal.localizeDate=function(a,h,d,b){var g=a.hours,c=a.minutes,e=a.seconds,f=h.match(/p/);if(f){f=a.hours>=12?b:d;g=g%12;if(g===0){g=12}}var i=h.replace("YYYY",a.year).replace("MM",a.month).replace("DD",a.day).replace("HH",g).replace("mm",c<10?"0"+(""+c):c).replace("SS",e<10?"0"+(""+e):e).replace("p",f);return i};Journal.VideoDetection=Core.Object.create({canUseHTML5:function(){if(Journal.initialStateController.params.no_html5_video){return NO}try{if(B.silk||B.android){return NO}if(this.__dCUH5__===(this.__dCUH5__=YES)){return this._canUseHTML5}var a=document.createElement("video");var b=this._canUseHTML5=((a.canPlayType instanceof Function)&&a.canPlayType(B.android?"video/mp4":"video/x-m4v"));if(b==="no"||!b){b=NO}return b}catch(c){return NO}}.property(),_isQTInstalled:undefined,isQTInstalled:function(){if(Journal.initialStateController.params.no_qt){return NO}if(B.msie===9){return NO}if(this._isQTInstalled===undefined){var b=false;if(navigator.plugins&&navigator.plugins.length){for(var a=0;a<navigator.plugins.length;a++){var c=navigator.plugins[a];if(c.name.indexOf("QuickTime")>-1){b=true}}}else{if(typeof(execScript)!="undefined"){qtObj=false;execScript('on error resume next: qtObj = IsObject(CreateObject("QuickTimeCheckObject.QuickTimeCheck.1"))',"VBScript");b=qtObj}}this._isQTInstalled=b}return this._isQTInstalled},getQTVersion:function(){if(this._qtVersion){return this._qtVersion}var a="0";if(navigator.plugins&&navigator.plugins.length){for(var c=0;c<navigator.plugins.length;c++){var d=navigator.plugins[c];var b=d.name.match(/quicktime\D*([\.\d]*)/i);if(b&&b[1]){a=b[1]}}}else{if(typeof(execScript)!="undefined"){ieQTVersion=null;execScript('on error resume next: ieQTVersion = CreateObject("QuickTimeCheckObject.QuickTimeCheck.1").QuickTimeVersion',"VBScript");if(ieQTVersion){a=ieQTVersion.toString(16);a=[a.charAt(0),a.charAt(1),a.charAt(2)].join(".")}}}return this._qtVersion=a},isQTCompatible:function(c,e){var b=this._compatTest||(this._compatTest=function(g,i){var f=parseInt(g[0],10);if(isNaN(f)){f=0}var h=parseInt(i[0],10);if(isNaN(h)){h=0}if(f===h){if(g.length>1){return b(g.slice(1),i.slice(1))}else{return true}}else{if(f<h){return true}else{return false}}});var d=c.split(/\./);var a=e?e.split(/\./):this.getQTVersion().split(/\./);return b(d,a)},isValidQTAvailable:function(a){return this.isQTInstalled()&&this.isQTCompatible(a||Journal.MIN_QUICKTIME_VERSION)},doesQTExistForPlatform:function(){if(Journal.initialStateController.params.never_qt){return NO}return !B.mobile&&B.msie!==9},canPlayVideoNow:function(){if(arguments.callee.ran===(arguments.callee.ran=YES)){return arguments.callee.answer}return arguments.callee.answer=this.canUseHTML5()||this.isValidQTAvailable()}.property(),canPlayVideoEver:function(){if(arguments.callee.ran===(arguments.callee.ran=YES)){return arguments.callee.answer}return arguments.callee.answer=this.canPlayVideoNow()||this.doesQTExistForPlatform()}.property()});Journal.TopBarView=Core.View.extend({classNames:"top-bar full-width".w(),rootHTML:'<div><div class="front-shadow"></div></div>',initialTabBinding:"Journal.initialStateController.initialTab",frontShadowElement:"layer.firstChild",showBackShadow:YES,_createBackShadowForParentNode:function(){if(!this.isAppendedInWindow||this._backShadowMoved||!this.showBackShadow){return}var a=document.createElement("div");a.className="back-shadow";this.layer.parentNode.appendChild(a);this._backShadowMoved=true}.observes("isAppendedInWindow","showBackShadow"),Dropper:Anim.Animation.extend({layerBinding:".owner.layer",from:-72,to:0,duration:350,tween:Anim.tweens.QUADRATIC_OUT,update:function(){this.layer.style.top=this.current+"px"}}),readyDrop:function(){if(this.initialTab===this.desiredInitialTab){this.layer.style.top="-72px"}}.observes("render"),drop:function(){if(!this.layer||this._dropped){return}if(this.layer.style.top){this.Dropper.create({owner:this}).start()}this._dropped=YES}.observes("dropTrigger")});Journal.TopBarButtonView=Core.ButtonView.extend({classNames:"top-bar-button".w(),rootHTML:'<div><div class="outer"><div class="inner"><span class="shifter"></span></div></div></div>',_innerElement:"layer.firstChild.firstChild.firstChild",title:"",left:function(){var a=this.layer;return a?a.offsetLeft:0}.property(),width:function(){var a=this.layer;return a?a.firstChild.offsetWidth:0}.property(),init:function(){if(this.owner&&!this.useExternalHovers){this.classNames.push("conventional-hover")}arguments.callee.base.apply(this,arguments)},fixTitle:function(){this._inner.innerHTML=Core.escapeHTML(this.title)||"&nbsp;"}.observes("title","render"),fadeHoverer:function(){if(!this.hoverer){return}(this._fader||(this._fader=Anim.Fader.create({element:this.hoverer,revealify:function(){this.element.style.visibility=""}.observes("start"),hiddenify:function(){if(this.to===0){this.element.style.visibility="hidden"}}.observes("finish")}))).redirectTo(0+!!this.isOver).start();this._fader.duration=this.isOver?100:500}.observes("isOver"),appendRemoveHoverer:function(){if(!this.hoverer){return}if(this.isAppended){this.hoverer._parent=this.hoverer.parentNode||this.hoverer._parent;if(this.hoverer.parentNode){this.hoverer.parentNode.removeChild(this.hoverer)}}else{if(this.hoverer._parent){this.hoverer._parent.appendChild(this.hoverer)}}}.observes("isAppended"),updateFrameProperties:function(){if(!this.isAppendedInWindow){return}this.trigger("left");this.trigger("width")}.observes("isAppendedInWindow","render")});require("views/top_bar");require("views/top_bar_button");(function(){var a;Journal.JournalEntrySelectorView=Core.View.extend({useExternalHovers:a=!(B.msie<=8)&&!B.mobile,rootHTML:'<div class="journal-entry-selector full-width"><div class="track-mask"><div class="track-container"><div class="track"><div class="buttons"></div>'+(a?'<div class="hovers"></div>':"")+'</div></div><div class="track-gradient-left"></div><div class="track-gradient-right"></div></div></div>',_trackMaskElement:"layer.firstChild",_trackContainerElement:"_trackMask.firstChild",_trackElement:"_trackContainer.firstChild",_buttonsTrackElement:"_track.firstChild",_hoversTrackElement:"_track.childNodes.1",_gradientRightElement:"_trackMask.lastChild",_gradientLeftElement:"_gradientRight.previousSibling",displayWidthBinding:"from:.owner.displayWidth",journal:null,selectedEntry:null,dropTriggerBinding:"journal",desiredInitialTab:"journal",minLeft:0,minLeftPadding:10,minRight:B.desktop?17:0,minRightPadding:7,maxMouseAutoScrollSpeed:1.3,mouseAutoScrollBoundary:50,_showHideGradient:function(c,b){if(!c){return}if(c._isShowing===(c._isShowing=b)){return}Anim.Fader.go(Anim.DisplayNoneAtZero,{element:c,duration:350,to:0+b})},showHideLeftGradient:function(){this._showHideGradient(this._gradientLeft,this.isShowingLeftGradient)}.observes("isShowingLeftGradient"),showHideRightGradient:function(){this._showHideGradient(this._gradientRight,this.isShowingRightGradient)}.observes("isShowingRightGradient"),refocusScroll:function(){if(!this.journal){return}this.scrollTo(this.selectedEntry)}.observes("selectedEntry"),windowSizeChangeRefocusScroll:function(){if(!this.isAppendedInWindow||!B.mobile){return}var b=this;if(this._wscfs_handle){clearTimeout(this._wscfs_handle)}this._wscfs_handle=setTimeout(function(){b.refocusScroll()},100)}.observes("window.Core.windowSize"),positionMaskAndContainerForMinLeft:function(){if(!this.layer){return}var b=this.minLeft+this.minLeftPadding;this._trackMask.style.left=b+"px";this._trackContainer.style.left=-b+"px"}.observes("minLeft","render"),computeSmallMobileScreenScrollOffset:function(){this.smallMobileScreenScrollOffset=Math.max(Core.windowSize.width,Core.windowSize.height)>550?0:(this.minLeft+this.minLeftPadding-this.minRight-this.minRightPadding)/2}.observes("minLeft"),guaranteeContainerWidth:function(){if(!this._trackContainer){return}this._trackContainer.style.width=Core.windowSize.width+"px"}.observes("window.Core.windowSize","render"),watchMouseForScroll:function(){if(!this.isAppendedInWindow||B.mobile){return}var b=Core.mousePosition.x;if(isNaN(b)){return}var f=this.mouseAutoScrollBoundary,d=this.maxMouseAutoScrollSpeed,c=this.minLeft+2,e=Core.windowSize.width-this.minRight-this.minRightPadding;if(Core.mousePosition.y>44){this._scrollSpeed=0}else{if(b<c+f&&b>=c){this._scrollSpeed=-d*(f-(b-c))/f;this.scroller.start()}else{if(b>Core.windowSize.width-this.minRight-this.minRightPadding-f){this._scrollSpeed=d*(b-e+f)/f;this.scroller.start()}else{this._scrollSpeed=0}}}}.observes("window.Core.mousePosition"),touchStart:function(b){if(!B.onlyiOS){return}if(this._isDragging){return}if(!b||!b.touches||!b.touches.length){return}b.preventDefault&&b.preventDefault();Anim.tellStop(this._inertiaAnimation);this._preTouchScroll=this.scroller.current+this.smallMobileScreenScrollOffset;this._initialTouchX=b.touches[0].clientX;this._isReadyForDrag=YES},touchEnd:function(b){if(!B.onlyiOS){return}if(!this._isDragging){return}b.preventDefault&&b.preventDefault();this._preTouchScroll=this._initialTouchX=undefined;this._isReadyForDrag=NO;this._isDragging=NO;this._inertiaAnimation=this.InertiaAnimation.go({owner:this});this._ppTouchX=this._ppTouchDate=this._previousTouchX=this._previousTouchDate=NaN},touchMove:function(c){if(!B.onlyiOS){return}if(!c||!c.touches||!c.touches.length){return}if(!this._isReadyForDrag){return}var b=c&&c.touches&&c.touches[0]&&c.touches[0].clientX;if(isNaN(b)){return}c.preventDefault&&c.preventDefault();this._isDragging=YES;this._ppTouchX=this._previousTouchX;this._previousTouchX=b;this._ppTouchDate=this._previousTouchDate;this._previousTouchDate=new Date*1;var d=-(b-this._initialTouchX)+this._preTouchScroll;this.scrollTo(d,YES)},InertiaAnimation:Anim.Task.extend({ticked:2,speedFractionPerTick:0.98,speedAsymptoteBoost:0.1,computeInitialSpeed:function(){var c=this.owner,b=((c._previousTouchDate-c._ppTouchDate)/(this.ticked||16))||Infinity;this.speed=-((c._previousTouchX-c._ppTouchX)||0)/b;this.current=c.scroller.current}.observes("start"),run:function(e,c){var b=this.speed>0,d=b?1:-1;if(this.speed){this.speed+=d*this.speedAsymptoteBoost;this.speed*=this.speedFractionPerTick;this.speed-=d*this.speedAsymptoteBoost;if((b&&this.speed<=0)||(!b&&this.speed>=0)){this.speed=0}}this.current+=this.speed;if(c){return}if(!isNaN(this.current)){this.owner.scrollTo(this.current+this.owner.smallMobileScreenScrollOffset,YES)}if(Math.abs(this.speed||0)<0.001||(this.frameCount>=5&&this._lastOSC===(this._lastOSC=this.owner.scroller.current))){this.trigger("finish");this.stop()}}}),scroller:Anim.Animation.extend({inertia:3,speed:10+2*B.mobile,ticked:2,headStart:1,from:0,to:0,update:function(){var c=this.current,b=window.devicePixelRatio||1;if(Core.useGPU){this.view._track.style.webkitTransform="translate3d("+Math.round(-c*b)/b+"px,0,0)"}else{if(!isNaN(this.view.trackWidth)&&!isNaN(c)){this.view._track.style.marginLeft=Math.round(this.view.trackWidth/-2-c)+"px"}}this.view.setIfChanged("isShowingLeftGradient",this.current!==this.maxOffsetLeft);this.view.setIfChanged("isShowingRightGradient",this.current!==this.maxOffsetRight)},adjustTargetScroll:function(){var e=this.view._scrollSpeed,b=this.to,d=this.maxOffsetLeft,c=this.maxOffsetRight;if(!e){return}b+=e;if(b<d){b=d}if(b>c){b=c}this.to=b}.observes("pretick")}),scrollTo:function(n,b){if(!this.isAppendedInWindow){return}if(typeof n==="object"){var i=this.getPath("_buttons."+this.indexForEntry(n)+".layer");if(i){n=i.offsetLeft+i.offsetWidth/2-this.trackWidth/2}else{return}}if(isNaN(n)){return this.scroller.update()}n-=this.smallMobileScreenScrollOffset;var l=this._buttons[this._buttons.length-1],d=l.layer;var r=l.get("left")+l.get("width"),p=r-(this.trackWidth-r),m=Core.windowSize.width,e=m/2-p/2,g=this.minLeft+this.minLeftPadding,k=g-e,q=-Math.max(0,k),c=m/2+p/2,o=m-this.minRight-this.minRightPadding,f=c-o,h=Math.max(0,f);if(n<q){n=q}if(n>h){n=h}this.scroller.maxOffsetLeft=q;this.scroller.maxOffsetRight=h;this.scroller.redirectTo(n);if(b){this.scroller.start();this.scroller.finish()}else{var j=this;clearTimeout(this._timer);this._timer=setTimeout(function(){j.scroller.start()},B.iOS?200:1)}}.observes("trackWidth"),fixScrollOnResize:function(){if(!this.layer||!this.isAppendedInWindow){return}this.scrollTo(this.selectedEntry,YES)}.observes("displayWidth","isAppendedInWindow"),instantiateScroller:function(){this.scroller=this.scroller.create({view:this,animateOldIE:YES})}.observes("render"),selectNextEntry:function(){if(!this.journal.entries){return}var b=this.indexForEntry();if(b===this.journal.entries.length-1){return}if(b===-1||b>this.journal.entries.length-1){return this.set("selectedEntry",this.journal.entries[this.journal.entries.length-1])}this.set("selectedEntry",this.journal.entries[b+1])},selectPreviousEntry:function(){if(!this.journal.entries){return}var b=this.indexForEntry();if(b===0){return}if(b<1||b>this.journal.entries.length-1){return this.set("selectedEntry",this.journal.entries[this.journal.entries.length-1])}this.set("selectedEntry",this.journal.entries[b-1])},indexForEntry:function(c){c||(c=this.selectedEntry);for(var b=0,d;d=this.journal.entries[b];b++){if(c===d){return b}}return -1},ButtonViewExample:Journal.TopBarButtonView.extend({actionDelay:0,entry:null,establishTitle:function(){this.setIfChanged("title",this.entry&&this.entry.title)}.observes("entry","render"),action:function(){if(this.owner){this.owner.setIfChanged("selectedEntry",this.entry)}}}),regenerateButtons:function(){if(!this.isAppendedInWindow){return}var c=this._buttonsTrack,j=this._hoversTrack,h;if(!this.journal){c.innerHTML="";if(j){j.innerHTML=""}!this._buttons||(this._buttons.length=0);return}if(this._lastEntries===(this._lastEntries=Core.guidFor(this.journal.entries))){return}c.innerHTML="";if(j){j.innerHTML=""}(h=this._buttons||(this._buttons=[])).length=0;var f=this.journal.entries.length;for(var e=0,g,d,b;g=this.journal.entries[e];e++){h.push(d=this.ButtonViewExample.create({classNames:((e===0?" left":"")+(e===f-1?" right":"")).substring(1).w(),useExternalHovers:this.useExternalHovers,setSelected:function(){this.setIfChanged("isSelected",this.owner.selectedEntry===this.entry)}.observes(".owner.selectedEntry","render"),owner:this,entry:g}).appendTo(c));if(j){b=d.layer.cloneNode(true);b.id+="Hoverer";Anim.setOpacity(b,0);b.style.visibility="hidden";b.className+=" external-hoverer";$(b).removeClass("sel");b.setAttribute("role","");b.setAttribute("aria-hidden","true");j.appendChild(b);d.setIfChanged("hoverer",b)}}this.sizeContainersToContents();this.adjustMaxButtonWidth();this.scrollTo(this.selectedEntry,YES)}.observes("journal","isAppendedInWindow"),maxButtonWidth:270,maxButtonWidthPadding:50,adjustMaxButtonWidth:function(){var e=this._buttons;if(!this.isAppendedInWindow||!e){return}var f=Core.windowSize.width-this.minLeft-this.minLeftPadding-this.minRight-this.minRightPadding-this.maxButtonWidthPadding;f=Math.round(Math.min(f,this.maxButtonWidth))+"px";for(var d=0,c,b=e.length;c=e[d];d+=1){c.layer.style.maxWidth=f;if(c.hoverer){c.hoverer.style.maxWidth=f}}}.observes("window.Core.windowSize"),sizeContainersToContents:function(){var g=18,b=30,h=0;for(var e=0,j;j=this.journal.entries[e];e++){h+=(j.title||"").length}var d=e,c=g*h+d*b,k=this._buttonsTrack,f=this._hoversTrack;k.style.width=c+"px";if(f){f.style.width=c+"px"}if(Core.useGPU){k.style.marginLeft=Math.round(c/-2)+"px";if(f){f.style.marginLeft=Math.round(c/-2)+"px"}}this.set("trackWidth",c)}})})();Journal.ArtificialIPadBackgroundView=Core.View.extend({initiallyAppended:NO,classNames:"artificial-ipad-background".w(),size:null,TILE_WIDTH:512,TILE_HEIGHT:512,imageCSS:function(){this.imageCSS="position:absolute; width:"+this.TILE_WIDTH+"px; height:"+this.TILE_HEIGHT+"px; pointer-events:none; z-index:1;"}.observes("init"),srcsByTheme:window.devicePixelRatio===2?{denim:"static/journal/en-us/contents/source/resources/images/journal_background_denim_1024.jpg",cotton:"static/journal/en-us/contents/source/resources/images/journal_background_cotton_1024.jpg",border:"static/journal/en-us/contents/source/resources/images/journal_background_cotton_1024.jpg"}:{denim:"static/journal/en-us/contents/source/resources/images/journal_background_denim_512.jpg",cotton:"static/journal/en-us/contents/source/resources/images/journal_background_cotton_512.jpg",border:"static/journal/en-us/contents/source/resources/images/journal_background_cotton_512.jpg"},themeName:null,updateToSize:function(){if(!this.isAppendedInWindow){return}if(!this.size){return}var c=this.size.width,e=this.size.height,j=Math.ceil(c/this.TILE_WIDTH),f=Math.ceil(e/this.TILE_HEIGHT),b=j*f,a=this.images||(this.images=[]),d,g;for(d=0;d<b;d++){(g=a[d])||((g=a[d]=new Image()).style.cssText=this.imageCSS);if(!g._isAppended){this.layer.appendChild(g)}g._isAppended=YES;g.style.left=(d%j)*this.TILE_WIDTH+"px";g.style.top=Math.floor(d/j)*this.TILE_HEIGHT+"px"}for(d=b;g=a[d];d++){if(g._isAppended){this.layer.removeChild(g)}g._isAppended=NO}this.layer.style.width=this.size.width+"px";this.layer.style.height=this.size.height+"px";this.updateToThemeName()}.observes("size","isAppendedInWindow"),updateToThemeName:function(){if(!this.layer){return}var c=this.srcsByTheme[this.themeName];if(!c){return this.remove()}for(var a=0,b;b=this.images&&this.images[a];a++){b.src=c}$(this.layer).removeClass(this._lastThemeName);$(this.layer).addClass(this._lastThemeName=this.themeName);this.append()}.observes("themeName","render")});Journal.TopBarBackToJournalsButtonView=Journal.TopBarButtonView.extend({classNames:"back-button left back right".w(),title:"_Journals".loc(),ariaLabel:"_Journals".loc(),actionDelay:100,action:function(){if(Journal.initialStateController.loadEnvironment==="local"){window.location="http://back-to-journals/";return}if(Journal.workspaceController.hasBeenAtJournalListOnce){Journal.workspaceController.set("nowShowing",Journal.LIST)}else{Journal.journalListController.fetchListFromJournal(this.owner.journal,function(){Journal.workspaceController.set("nowShowing",Journal.LIST)},function(){Journal.journalController.setIfChanged("isJournalPublic",NO)})}}});require("views/top_bar");require("views/top_bar_button");require("views/top_bar_back_button");Journal.JournalTopBarView=Journal.TopBarView.extend(CoreImage.ThemeSupport,{classNames:"journal-top-bar".w(),displayWidth:undefined,journal:null,selectedEntry:null,_selectorMinLeft:0,backButtonView:Journal.TopBarBackToJournalsButtonView.extend({initiallyAppended:NO,isAppendedBinding:"from:Journal.workspaceController.allowJournalBackButton",leftBinding:"to:.owner._backButtonViewLeft",widthBinding:"to:.owner._backButtonViewWidth",action:function(){if(Journal.workspaceController.nowShowing!==Journal.JOURNAL){return}return arguments.callee.base.apply(this,arguments)}}),entrySelectorView:Journal.JournalEntrySelectorView.extend({journalBinding:"from:.owner.journal",selectedEntryBinding:".owner.selectedEntry",minLeftBinding:"hard:from:.owner._selectorMinLeft"}),backButtonViewFrameChanged:function(){var b=this._backButtonViewLeft||0,a=this._backButtonViewWidth||0;if(!a){return}this.set("_selectorMinLeft",b+a)}.observes("_backButtonViewLeft","_backButtonViewWidth")});require("views/journal_entry_selector");require("views/artificial_ipad_background");require("views/journal_top_bar");require("views/top_bar_back_button");Journal.JournalPageView=Core.View.extend({typeInteger:Journal.JOURNAL,initiallyAppended:false,classNames:"journal-page full-width full-height".w(),displayWidth:undefined,journal:null,selectedEntry:null,zoomImageInfo:null,themeName:null,makeDownerGroup:function(){this.set("downerGroup",CoreImage.ImageGroup.create({coreGuid:"JOURNAL_GROUP:"+this.coreGuid,importance:1}).enter(CoreImage.imageLoader.group))}.observes("init"),bumpDownerGroup:function(){if(this.isShowing){this.downerGroup.becomeMostImportant()}}.observes("isShowing"),establishThemeFromJournal:function(){this.setIfChanged("themeName",((this.journal&&this.journal.themeName)||this.themeName||Journal.DEFAULT_THEME).toLowerCase());this.setIfChanged("journalDeferrer",this.journal)}.observes("journal"),autoselectEntry:function(){var a=this.journal;if(!a){this.set("selectedEntry",null)}this.setIfChanged("selectedEntry",a.pages[0])}.observes("journal"),topbarView:Journal.JournalTopBarView.extend({displayWidthBinding:"from:.owner.displayWidth",journalBinding:"from:.owner.journal",selectedEntryBinding:".owner.selectedEntry"}),addSlideAnimStyling:function(c,a,b){if(Journal.page.listView===c||Journal.page.listView===a){this.set("isGPUFriendly",YES);$(this.layer).addClass("is-sliding")}}.observes("willEnterTransition"),removeSlideAnimStyling:function(c,a,b){if(Journal.page.listView===c||Journal.page.listView===a){this.set("isGPUFriendly",NO);$(this.layer).removeClass("is-sliding")}}.observes("didFinishTransition"),bumpIsTransitioning:function(){this.setIfChanged("isTransitioning",YES)}.observes("willEnterTransition"),killIsTransitioning:function(){this.setIfChanged("isTransitioning",NO)}.observes("didFinishTransition"),getSmallZoomInfo:function(){return this.zoomImageInfo},artificialIPadBackgroundView:B.iPad?Journal.ArtificialIPadBackgroundView.extend({themeNameBinding:"from:.owner.themeName",sizeBinding:"hard:from:.owner.layout"}):null});require("views/journal_page");Journal.JournalPageView.reopen(CoreImage.ThemeSupport,{updateToThemeName:function(){var a=this.journal.themeInfo,e=this._currentThemeClasses,d=this._currentThemeClasses=a.classNames,b,f;for(b=0;f=e&&e[b];b++){$(this.layer).removeClass(f)}for(b=0;f=d&&d[b];b++){$(this.layer).addClass(f)}this.setIfChanged("theme",a.theme);this.setIfChanged("themeInfo",a);this.setIfChanged("isDark",a.isDark)}.observes("themeName"),removeBodyThemeClassesOnEntranceToList:function(a,c,b){if(c!==Journal.page.listView){return}this._addOrRemoveBodyClasses(YES)}.observes("Journal.page.listView.willEnterTransition"),addBodyThemeClassesOnExitFromList:function(a,c,b){if(a!==Journal.page.listView){return}this._addOrRemoveBodyClasses()}.observes("Journal.page.listView.didFinishTransition"),_addOrRemoveBodyClasses:function(a){var d=this._currentThemeClasses,b,e;if(!d){return}for(b=0;e=d[b];b++){$(document.body)[a?"removeClass":"addClass"](e)}}});require("views/journal_page");Journal.JournalPageView.reopen(Core.PinchZoomability,{rootHTML:'<div><div style="z-index:50000; top:41px; position:absolute; left:0px;"></div></div>',logElement:"layer.firstChild",maximumZoom:4,speedFractionPerTick:0.994,speedAsymptoteBoost:0.03,shouldSnapToTop:YES,neverLockYAxis:YES,defendAgainstAbnormallyFastFlicks:YES,allowZoom:function(){this.allowZoom=!B.android&&B.iOS&&!!Journal.initialStateController.params.zoom}.observes("init"),touchIgnoreTest:function(a){if(!a||!a.touches||!a.touches.length){return YES}if(a.touches[0].clientY<43){return YES}return NO},defaultZoomState:{zoom:1,y:Infinity,x:0},addZoomableClass:function(){if(this.allowZoom){this.classNames.push("zoomable")}}.observes("init"),computeLayoutForNonZoom:function(){if(this.allowZoom||!this.isAppendedInWindow){return}var a=(this.currentEntryHeight+41)||0;a=Math.max(Core.windowSize.height,a);var b=this.layout||(this.layout={});b.width=Core.windowSize.width;b.height=a;b.top=b.left=0;this.trigger("layout")}.observes("render","currentEntryHeight","window.Core.windowSize","isAppendedInWindow"),computeLayoutAndProvideZoomContainerSizeForZoom:function(){if(!this.allowZoom){return}var a=this.zoomContainerSize||(this.zoomContainerSize={});a.width=Core.windowSize.width;a.height=Core.windowSize.height-41;a.top=41;a.left=0;Core.cloneHash(a,this.layout||(this.layout={}));this.layout.height+=41;this.layout.top=0;this.trigger("layout");this.resetZoom();this.resetZoom(YES);this.trigger("zoomContainerSize")}.observes("init","window.Core.windowSize"),setLayerHeightForNonZoom:function(){if(this.allowZoom){return}var a=Math.ceil(this.layout.height)+"px";this.layer.style.height===a||(this.layer.style.height=a)}.observes("layout"),updateToEntry:function(){if(!this.selectedEntry||!this.isAppendedInWindow){return}var d=this.selectedEntry,b=this.viewForEntry(d),a=this.currentEntryView;if(a&&a!==b){a.remove()}if(a===b){return}b.appendTo(this);this.resetZoom(YES);this.setIfChanged("currentEntryView",b);this.resetZoom();if(!this.allowZoom){return}var c=this;clearTimeout(this._dupeTimeout);this._dupeTimeout=setTimeout(function(){c.ensureDupeExistence()},200)}.observes("selectedEntry","isAppendedInWindow"),ensureDupeExistence:function(){if(!this.allowZoom||!this.currentEntryView){return}this.gpuDupeForView(this.currentEntryView)},gpuDupeForView:function(a){if(!a){return}var b=a.gpuDupe||(a.gpuDupe=Journal.JournalEntryView.create({isDupe:YES,isGPUFriendly:YES,isHidden:NO,isOnscreenBinding:".owner.isZoomHappening",appendTo:function(){if(!this.original.isAppended){return this.remove()}return arguments.callee.base.apply(this,arguments)},removeWithOriginal:function(){if(!this.original.isAppended){this.remove()}}.observes(".original.isAppended"),journal:this.journal,entry:a.entry,layoutItems:a.layoutItems,owner:this,pageView:this,original:a,downerGroup:CoreImage.imageLoader.passiveGroup}));b.append()},viewForEntry:function(d){if(!d){return null}var e=d.layouts,b=Core.windowSize.width,f;for(var a=0,c;c=e[a];a++){if(b<=(c.maxWidth||Infinity)){f=c}}if(!f&&!(f=e[e.length-1])){return null}return f.view||(f.view=Journal.JournalEntryView.create({isGPUFriendly:NO,isOnscreen:YES,isHiddenBinding:".owner.isZoomHappening",journal:this.journal,entry:d,layoutItems:f,owner:this,pageView:this,downerGroup:this.downerGroup}))},provideZoomTriggers:function(){this.trigger(this.isZoomHappening?"zoomDidStart":"zoomDidFinish")}.observes("isZoomHappening"),touchStart:function(a){if(!this.allowZoom){return arguments.callee.base.apply(this,arguments)}Core.hideIOSAddressBar();if(a&&a.preventDefault){a.preventDefault()}return arguments.callee.base.apply(this,arguments)},killAddressBarOnEnter:B.mobile?function(){if(!this.isShowing){return}Core.hideIOSAddressBar()}.observes("isShowing"):null});Anim.speedMultiplier=1;(function(){var a;Journal.AppleLogoView=CoreImage.EasyDomImageView.extend(Core.ButtonnessMixin,{themeName:null,downerGroup:CoreImage.imageLoader.essentialGroup,rootHTML:'<div style="cursor:pointer"></div>',actionDelay:0,aspectRatio:17/20,action:function(){window.open("_URL.Marketing".loc())},establishReps:function(){if(!this.isAppendedInWindow){return}var b=this.isActive?"ActiveReps":this.isOver?"OverReps":"Reps";this._currentSuffix=b;this.setIfChanged("reps",this[this.themeName+b])}.observes("isOver","isActive","themeName","isAppendedInWindow"),requestPeers:function(){if(!this.currentRep||this._currentSuffix!=="Reps"){return}if(this.currentRep.__hasRequestedPeers__===(this.currentRep.__hasRequestedPeers__=YES)){return}CoreImage.ImageRequest.create({downerGroup:this.downerGroup,url:this.getPath(this.themeName+"ActiveReps."+this.currentRep._key+".url")});if(B.mobile){return}CoreImage.ImageRequest.create({downerGroup:this.downerGroup,url:this.getPath(this.themeName+"OverReps."+this.currentRep._key+".url")})}.observes("currentRep"),shelfReps:{"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/shelf_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/shelf_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/shelf_200.png"}},darkReps:a={"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/dark_mosaic_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/dark_mosaic_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/dark_mosaic_200.png"}},mosaicReps:a,denimReps:{"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/denim_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/denim_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/denim_200.png"}},lightReps:{"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/light_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/light_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/light_200.png"}},cottonReps:a={"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/cotton_border_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/cotton_border_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/cotton_border_200.png"}},borderReps:a,shelfOverReps:{"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/shelf_hover_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/shelf_hover_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/shelf_hover_200.png"}},darkOverReps:a={"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/dark_mosaic_hover_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/dark_mosaic_hover_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/dark_mosaic_hover_200.png"}},mosaicOverReps:a,denimOverReps:{"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/denim_hover_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/denim_hover_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/denim_hover_200.png"}},lightOverReps:{"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/light_hover_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/light_hover_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/light_hover_200.png"}},cottonOverReps:a={"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/cotton_border_hover_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/cotton_border_hover_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/cotton_border_hover_200.png"}},borderOverReps:a,shelfActiveReps:{"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/shelf_active_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/shelf_active_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/shelf_active_200.png"}},darkActiveReps:a={"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/dark_mosaic_active_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/dark_mosaic_active_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/dark_mosaic_active_200.png"}},mosaicActiveReps:a,denimActiveReps:{"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/denim_active_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/denim_active_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/denim_active_200.png"}},lightActiveReps:{"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/light_active_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/light_active_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/light_active_200.png"}},cottonActiveReps:a={"20":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/cotton_border_active_20.png"},"40":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/cotton_border_active_40.png"},"200":{url:"static/journal/en-us/contents/source/resources/images/footer_apples/cotton_border_active_200.png"}},borderActiveReps:a})})();Journal.BasicDialogView=Core.View.extend({className:"Journal.BasicDialogView",rootHTML:'<div class="basic-dialog"><div class="background"><div class="middle"></div><div class="right"></div><div class="left"></div></div><div class="caption"></div></div>',captionElement:"layer.lastChild",title:null,widthPadding:0,leftPadding:0,titleDidChange:function(){this.caption.innerHTML=this.title||"&nbsp;";this.doLayerAdjustments()}.observes("title","render"),doLayerAdjustments:function(){if(!this.isAppendedInWindow){return}this.adjustLayerWidth();this.centerLayerHorizontally();this.centerLayerVertically()}.observes("isAppendedInWindow",".owner.size"),adjustLayerWidth:function(){if(this._adjustedLayerWidth){return}this.caption.style.marginLeft=this.leftPadding-1+"px";var a=this.caption.offsetWidth+this.widthPadding;if(isNaN(a)){return}this.layer.style.width=Math.round(a)+"px";this._adjustedLayerWidth=true},centerLayerHorizontally:function(){var b=this.layer,a=Math.round(this.owner.size.height/2),c=a-Math.round(b.clientHeight/2);if(isNaN(c)){return}this.layer.style.top=Math.round(c)+"px"},centerLayerVertically:function(){var a=this.layer,b=Math.round(this.owner.size.width/2),c=b-Math.round(a.clientWidth/2);if(isNaN(c)){return}this.layer.style.left=Math.round(c)+"px"}});require("views/basic_dialog");Journal.CanNotPlayVideoErrorView=Journal.BasicDialogView.extend({title:"_Error.CanNotPlayVideo".loc(),widthPadding:41});Journal.GridItems=Journal.ClassBank.create({suffix:"View",Default:(Journal.GridItemView=Core.ButtonView.extend(Journal.PathRetrievalSupport,CoreImage.GridItemMixin,CoreImage.ThemeSupport,{classNames:"grid-item".w(),downerGroupBinding:"from:.owner.downerGroup",shouldHoldOffBinding:"from:.pageView.isTransitioning",maxWaitDelay:15000,init:function(){this.isPurelyDecorative=Journal.slideshowController.shouldExcludeItem(this.originalItem);arguments.callee.base.apply(this,arguments)},initiallyAppended:function(){this.initiallyAppended=!this.hasWaitSupport;if(!this.hasWaitSupport){return}var a=this;setTimeout(function(){a.forceWaitCompletion()},this.maxWaitDelay)}.observes("init"),entry:undefined,action:function(){var a=this;if(this.pageView&&this.pageView.isZoomHappening){return}this.pageView&&this.pageView.set("zoomImageInfo",null);setTimeout(function(){Journal.slideshowController.set("currentItem",a.originalItem);Journal.workspaceController.set("nowShowing",Journal.SLIDESHOW);a.mouseExited()},150)},appendWhenReady:function(){if(this.isAppended){return}this.append();if(B.iOS||B.msie<=8){return}var a=Core.useGPU&&this.pageView&&this.owner&&this.owner.isAppendedInWindow;Anim.Fader.go({element:this.layer,from:0,to:1,duration:350,owner:this,notifyDone:function(){this.owner.trigger("appendFadeDidFinish")}.observes("finish"),applyGPU:a?function(){this._oldTransform=this.element.style.webkitTransform;this.element.style.webkitTransform="translate3d(0,0,0)"}.observes("start"):null,removeGPU:a?function(){this.element.style.webkitTransform=this._oldTransform||""}.observes("stop"):null})}.observes("waitDidComplete")})).extend({isPurelyDecorative:YES})});Journal.ImageBasedGridItemView=Journal.GridItemView.extend(Core.WaitSupport,{classNames:"image-based-grid-item".w(),numReqs:1,imageInset:{left:0,top:0,right:0,bottom:0},imageView:CoreImage.EasyDomImageView.extend({repsBinding:"from:.owner.reps",shouldHoldOffBinding:"from:.owner.shouldHoldOff",downerGroup:CoreImage.imageLoader.essentialGroup,establishLayout:function(){var c=this.owner.layout;if(!c){return}var m=this.owner.maxImageWidth,f=this.owner.maxImageHeight;if(!m||!f){return this.setSize(c.width,c.height)}var o=this.owner.imageInset,a=this.owner.cellSize,j=m/f,h=c.width-o.left*a-o.right*a,d=c.height-o.top*a-o.bottom*a,g=h/d,k=j>g,b=k?h:d*j,n=k?h/j:d,i=Math.round((h-b)/2)+o.left*a,e=Math.round((d-n)/2)+o.top*a;this.setLayout(i,e,b,n)}.observes(".owner.layout"),notifyReady:function(){this.owner.closeReq()}.observes("waitDidComplete")}),establishSlideshowSize:function(){this.setIfChanged("maxSlideshowSize",Math.max(this.maxImageHeight,this.maxImageWidth)||Infinity)}.observes("init","maxImageHeight","maxImageWidth")});require("views/grid_items/_bank");Journal.FullImageSingleTextBlockGridItemView=Journal.ImageBasedGridItemView.extend({classNames:"single-text-on-image".w(),rootHTML:'<div><div class="text selectable"></div></div>',textDivElement:"layer.firstChild",writeText:function(){if(!this.layer){return}this.textDiv.innerHTML=(Core.escapeHTML(this.value)+"").split("↵").join("<br>").split("\n").join("<br>")}.observes("render","value")});Journal.GridItems.NoteView=Journal.FullImageSingleTextBlockGridItemView.extend({className:"GridItems.NoteView",imageInset:{left:-0.16,top:0.009,right:-0.18,bottom:-0.199},classNames:"note".w(),maxImageWidth:580,maxImageHeight:580,reps:{"290":{url:"static/journal/en-us/contents/source/resources/images/note_290.png"},"580":{url:"static/journal/en-us/contents/source/resources/images/note_580.png"}}});Journal.GridItems.MemoryView=Journal.FullImageSingleTextBlockGridItemView.extend({className:"GridItems.MemoryView",classNames:"memory".w(),maxImageWidth:580,maxImageHeight:580,reps:{"290":{url:"static/journal/en-us/contents/source/resources/images/memory_290.png"},"580":{url:"static/journal/en-us/contents/source/resources/images/memory_580.png"}}});require("views/grid_items/note_and_memory");require("views/top_bar_back_button");Journal.ErrorPageView=Core.View.extend({typeInteger:Journal.ERROR,classNames:"error-page showing-list-bg full-width full-height light-theme".w(),initiallyAppended:NO,cellSize:undefined,displayWidth:undefined,killAddressBar:B.iOS?function(a,c,b){if(this===c){Core.hideIOSAddressBar()}}.observes("didEndTransition"):null,touchStart:function(){Core.scrollTop(0)},doLayout:function(){if(!this.isAppendedInWindow){return}var d=Math.round(this.displayWidth/5);if(this.displayWidth<1000){d=200-1/6*(1000-this.displayWidth)}d*=0.9;d=Math.min(d,110);this.set("cellSize",d);var c=this.container.style,a,b;c.left=Math.round(Core.windowSize.width/2-this.cellSize)+"px";c.top=(a=Math.round(41+Math.max(Core.windowSize.height/35,Math.round(Core.windowSize.height/3.1-this.cellSize))))+"px";c.width=c.height=(b=Math.round(2*this.cellSize))+"px";this.layer.style.height=Math.max(Core.windowSize.height,a+b+45)+"px"}.observes("displayWidth","window.Core.windowSize","isAppendedInWindow"),rootHTML:'<div><div style="position:absolute; z-index:20; overflow:visible;"></div></div>',containerElement:"layer.firstChild",topBarView:Journal.TopBarView.extend({initiallyAppended:NO,isAppendedBinding:"from:Journal.workspaceController.allowErrorBackButton",appendInto:"layer",backButtonView:Journal.TopBarBackToJournalsButtonView}),noteView:Journal.GridItems.NoteView.extend({action:Core.noOp,isPurelyDecorative:YES,classNames:"error".w(),cellSizeBinding:".owner.cellSize",valueBinding:".owner.errorMessage",theme:CoreImage.Theme.create({"textDiv.styles":{fontSize:60/290,left:80/290,right:85/290,top:50/290,bottom:100/290}}),left:0,top:0,width:2,height:2,rotateMe:function(){var a=B.safari?"webkit":B.mozilla?"Moz":B.msie?"ms":null;if(!a){return}this.layer.style[a+"Transform"]="rotate(-3.5deg)"}.observes("render")}),});Journal.GridItems.CalendarView=Journal.ImageBasedGridItemView.extend({className:"GridItems.CalendarView",classNames:"calendar",maxImageWidth:276*2,maxImageHeight:292*2,imageInset:{left:0.01,right:-0.002,top:0.02,bottom:-0.02},reps:{"146":{url:"static/journal/en-us/contents/source/resources/images/calendar_146.png"},"292":{url:"static/journal/en-us/contents/source/resources/images/calendar_292.png"},"584":{url:"static/journal/en-us/contents/source/resources/images/calendar_584.png"}},rootHTML:'<div><div class="month"></div><div class="day"></div><div class="year"></div></div>',monthDivElement:"layer.firstChild",dayDivElement:"monthDiv.nextSibling",yearDivElement:"dayDiv.nextSibling",computeValues:function(){this.monthDiv.innerHTML=this.month||"1";this.dayDiv.innerHTML=this.day||"";this.yearDiv.innerHTML=this.year||""}.observes("render","day","month","year")});Journal.GridItems.TextView=Journal.GridItemView.extend({className:"GridItems.TextView",rootHTML:'<div class="text"><div class="content selectable"></div></div>',containerElement:"layer.firstChild",value:"",update:function(){var a=Core.escapeHTML(this.value);a=a.split("\n ").join("\n&nbsp;").split("\n").join("<br>").split("  ").join("&nbsp; ");this.container.innerHTML=a}.observes("value","align","render")});Journal.GridItems.HeadingView=Journal.GridItems.TextView.extend({className:"GridItems.HeadingView",classNames:"heading".w()});Journal.GridItems.PhotoView=Journal.GridItemView.extend(Core.WaitSupport,CoreImage.PhotoGridItemMixin,CoreImage.MissingImageSupport,{className:"GridItems.PhotoView",classNames:"photo".w(),rootHTML:'<div><div class="container"><div class="image-container full-width full-height"><div class="caption-container"><span class="caption"></span><img src="static/journal/en-us/contents/source/resources/images/caption_shadow.png"></div></div><div class="chrome full-width full-height"><div class="chrome-inner"><div class=top-left></div><div class=top></div><div class=top-right></div><div class=nonsliced-left></div><div class=nonsliced-right></div><div class=bottom-left></div><div class=bottom></div><div class=bottom-right></div></div></div></div></div>',containerElement:"layer.firstChild",imageContainerElement:"container.firstChild",captionContainerElement:"imageContainer.firstChild",captionElement:"captionContainer.firstChild",captionShadowElement:"captionContainer.lastChild",chromeInnerElement:"imageContainer.nextSibling.firstChild",missingImageParent:"imageContainer",numReqs:1,computeMissingImageLayout:function(){var a=this.layout;if(!a){return}var c=this.missingImageLayout||(this.missingImageLayout={}),b=this.getInset();c.left=0;c.top=0;c.width=a.width-2*b;c.height=a.height-2*b;this.trigger("missingImageLayout")}.observes("layout"),getInset:function(){return this.theme.valueFor("inset",this)},imageView:CoreImage.PhotoGridItemMixin.imageView.extend(Journal.UrlResolutionForImages,{shouldFade:NO,importanceBinding:".owner.downerImportance",shouldHoldOffBinding:"from:.owner.shouldHoldOff",currentSrcBinding:"to:.owner.currentSrc",establishReps:function(){this.set("reps",this.owner.getPath("value.photoReps"))}.observes(".owner.value","init"),notifyReady:function(){this.owner.closeReq()}.observes("waitDidComplete")}),reenableImageFadingOnSelfAppendFinish:function(){this.imageView.shouldFade=YES}.observes("appendFadeDidFinish"),handleCaption:function(){if(!this.layer){return}var a=this.value,b=this.captionContainer.style;if(!a||!a.caption){b.display="none"}else{b.display="";this.caption.innerHTML=(Core.escapeHTML(a.caption+"")).split(" ").join("&nbsp;")}}.observes("render","value"),sizeCaptionShadow:function(){if(!this.layer||!this.value||!this.value.caption){return}var a=this.height===1?31/137*this.cellSize:46/137*this.cellSize;this.captionShadow.style.height=Math.round(a)+"px"}.observes("cellSize","render")});Journal.GridItems.PhotoChromelessView=Journal.GridItems.PhotoView.extend(Journal.GridItems.PhotoView.chromelessModification={classNames:"chromeless".w(),rootHTML:'<div><div class="container"><div class="image-container full-width full-height"><div class="caption-container"><span class="caption light"></span><img src="static/journal/en-us/contents/source/resources/images/caption_shadow.png"></div></div></div></div>'});Journal.GridItems.PhotoBorderlessView=Journal.GridItems.PhotoView.extend(Journal.GridItems.PhotoView.borderlessModification={classNames:"borderless".w(),chromeInnerElement:null});Journal.GridItems.MapView=Journal.GridItems.MapBorderlessView=Journal.GridItems.PhotoBorderlessView.extend({classNames:"map".w()});Journal.GridItems.MapChromelessView=Journal.GridItems.PhotoChromelessView.extend({classNames:"map".w()});(function(){var b=CoreImage.EasyDomImageView.extend({downerGroup:CoreImage.imageLoader.essentialGroup,establishReps:function(){this.set("reps",this.getPath("owner.pageView.isDark")?this.DARK_REPS:this.LIGHT_REPS)}.observes("init")});var a=Journal.GridItemView.extend({classNames:"text-layout-dependent selectable".w(),rootHTML:'<div><div class="text"></div></div>',textDivElement:"layer.firstChild",textVerticalOffset:0,writeText:function(){window.it=this;this.textDiv.innerHTML=Core.escapeHTML(this.value).split("\n").join("<br>").split("  ").join("&nbsp; ");this.trigger("cellSize")}.observes("render","value"),positionTextVertically:function(){if(!this.isAppendedInWindow){return}var e=this.textDiv.offsetHeight,c=(this.layout.height-e)/2+this.textVerticalOffset*this.cellSize,d=this.theme.valueFor("textDiv.lineHeight",this);this.textDiv.style.top=c+"px";this.suspendTriggers();this.setIfChanged("textTop",c);this.setIfChanged("textBottom",c+e);this.resumeTriggers()}.observes("cellSize","isAppendedInWindow")});Journal.GridItems.QuoteView=a.extend({className:"GridItems.QuoteView",classNames:"quote".w(),startQuoteView:b.extend({shouldHoldOffBinding:"from:.owner.shouldHoldOff",DARK_REPS:{"18":{url:"static/journal/en-us/contents/source/resources/images/quote_start_dark_18.png"},"36":{url:"static/journal/en-us/contents/source/resources/images/quote_start_dark_36.png"},"72":{url:"static/journal/en-us/contents/source/resources/images/quote_start_dark_72.png"},"144":{url:"static/journal/en-us/contents/source/resources/images/quote_start_dark_144.png"}},LIGHT_REPS:{"18":{url:"static/journal/en-us/contents/source/resources/images/quote_start_light_18.png"},"36":{url:"static/journal/en-us/contents/source/resources/images/quote_start_light_36.png"},"72":{url:"static/journal/en-us/contents/source/resources/images/quote_start_light_72.png"},"144":{url:"static/journal/en-us/contents/source/resources/images/quote_start_light_144.png"}},doLayout:function(){var d=this.owner.textTop,f=this.owner.cellSize,e=0.15*f,c=8/9*e;this.setLayout(0.1*f,d-0.02*f-c,e,c)}.observes(".owner.textTop")}),endQuoteView:b.extend({shouldHoldOffBinding:"from:.owner.shouldHoldOff",DARK_REPS:{"18":{url:"static/journal/en-us/contents/source/resources/images/quote_end_dark_18.png"},"36":{url:"static/journal/en-us/contents/source/resources/images/quote_end_dark_36.png"},"72":{url:"static/journal/en-us/contents/source/resources/images/quote_end_dark_72.png"},"144":{url:"static/journal/en-us/contents/source/resources/images/quote_end_dark_144.png"}},LIGHT_REPS:{"18":{url:"static/journal/en-us/contents/source/resources/images/quote_end_light_18.png"},"36":{url:"static/journal/en-us/contents/source/resources/images/quote_end_light_36.png"},"72":{url:"static/journal/en-us/contents/source/resources/images/quote_end_light_72.png"},"144":{url:"static/journal/en-us/contents/source/resources/images/quote_end_light_144.png"}},doLayout:function(){var d=this.owner.textBottom,f=this.owner.cellSize,e=0.15*f,c=8/9*e;this.setLayout(1.9*f-e,d,e,c)}.observes(".owner.textBottom")})});Journal.GridItems.FoodView=a.extend({className:"GridItems.FoodView",classNames:"food".w(),textVerticalOffset:0.235,iconView:b.extend({shouldHoldOffBinding:"from:.owner.shouldHoldOff",DARK_REPS:{"41":{url:"static/journal/en-us/contents/source/resources/images/food_dark_41.png"},"82":{url:"static/journal/en-us/contents/source/resources/images/food_dark_82.png"},"164":{url:"static/journal/en-us/contents/source/resources/images/food_dark_164.png"},"328":{url:"static/journal/en-us/contents/source/resources/images/food_dark_328.png"}},LIGHT_REPS:{"41":{url:"static/journal/en-us/contents/source/resources/images/food_light_41.png"},"82":{url:"static/journal/en-us/contents/source/resources/images/food_light_82.png"},"164":{url:"static/journal/en-us/contents/source/resources/images/food_light_164.png"},"328":{url:"static/journal/en-us/contents/source/resources/images/food_light_328.png"}},doLayout:function(){var c=this.owner.textTop,f=this.owner.cellSize,e=0.3*f,d=e*28/41;this.setLayout(f-d/2,c-e-0.135*f,d,e)}.observes(".owner.textTop")})})})();require("views/play_button");Journal.GridItems.VideoView=Journal.GridItems.PhotoView.extend({classNames:"video".w(),appendVideoEmblemIfNeeded:function(){if(!Journal.VideoDetection.canPlayVideoEver()){return}this.videoEmblemView.append()}.observes("render"),videoEmblemView:CoreImage.EasyDomImageView.extend({classNames:"video-emblem".w(),zIndex:50,downerGroup:CoreImage.imageLoader.essentialGroup,initiallyAppended:NO,aspectRatio:19/14,reps:{"19":"static/journal/en-us/contents/source/resources/images/video_emblem_19.png","38":"static/journal/en-us/contents/source/resources/images/video_emblem_38.png"},doLayout:function(){if(!this.isAppendedInWindow){return}if(B.mobile){var a=this.owner.cellSize,b=this.getPath("owner.owner.displayWidth")||(a*7);this.setLayout(a*0.05,a*0.05,19*b/Core.windowSize.width)}else{this.setLayout(8,8,19)}}.observes("isAppendedInWindow",".owner.cellSize")})});Journal.GridItems.VideoChromelessView=Journal.GridItems.VideoView.extend(Journal.GridItems.VideoView.chromelessModification);Journal.GridItems.VideoBorderlessView=Journal.GridItems.VideoView.extend(Journal.GridItems.VideoView.borderlessModification);Journal.GridItems.WeatherView=Journal.ImageBasedGridItemView.extend({className:"GridItems.WeatherView",classNames:"weather".w(),maxImageWidth:574,maxImageHeight:284,imageInset:{left:0.011,right:0.011,top:0.014,bottom:-0.014},rootHTML:'<div><div class="temperature"></div></div>',temperatureTextElement:"layer.firstChild",condition:0,temperature:NaN,temperatureType:null,fixConditionFirst:function(){this.condition=(this.condition||0)%this.CONDITION_REPSETS.length}.observes("init","condition"),updateToCondition:function(){this.set("reps",this.CONDITION_REPSETS[this.condition])}.observes("init","condition"),writeTemp:function(){if(isNaN(this.temperature)||!this.condition){return}this.temperatureText.innerHTML=this.temperature+""+(this.TEMPTYPE_STRINGS[this.temperatureType]||"")}.observes("render","temperature","temperatureType"),TEMPTYPE_STRINGS:{fahrenheit:"°F",celcius:"°C",kelvin:"K"},CONDITION_REPSETS:[{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherUnknown_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherUnknown_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherClear_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherClear_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherCloudy_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherCloudy_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherFlurries_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherFlurries_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherFog_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherFog_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherHaze_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherHaze_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherMostlyCloudy_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherMostlyCloudy_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherMostlySunny_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherMostlySunny_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherPartlyCloudy_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherPartlyCloudy_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherPartlySunny_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherPartlySunny_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherFreezingRain_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherFreezingRain_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherRain_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherRain_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherSleet_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherSleet_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherSnow_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherSnow_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherSunny_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherSunny_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherThunderstorms_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherThunderstorms_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherThunderstorm_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherThunderstorm_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherOvercast_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherOvercast_287.png"}},{"574":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherScatteredClouds_574.png"},"287":{url:"static/journal/en-us/contents/source/resources/images/weather/weatherScatteredClouds_287.png"}}]});Journal.InlineItems=Journal.ClassBank.create({suffix:"View",Default:Journal.InlineItemView=Core.View.extend(CoreImage.ThemeSupport,Journal.PathRetrievalSupport,{classNames:"inline inline-item".w(),entry:undefined,displayWidthBinding:"from:.owner.displayWidthDeferrer",downerGroupBinding:"from:.owner.downerGroup",addClassForPrevAndNext:function(){var b=(this.getPath("prevOriginalItem.type")||"beginning").toString().toLowerCase();this.layer.className+=" after-"+b;var a=(this.getPath("nextOriginalItem.type")||"end").toString().toLowerCase();this.layer.className+=" before-"+a}.observes("render")})});Journal.InlineItems.TextView=Journal.InlineItemView.extend({className:"InlineItems.TextView",rootHTML:'<div class="text"><div class="selectable"></div></div>',containerElement:"layer.firstChild",value:"",update:function(){if(this.className==="InlineItems.TextView"){window.tv=this}if(this.className==="InlineItems.HeadingView"){window.hv=this}if(!this.layer){return}var a=Core.escapeHTML(this.value);a=a.split("\n ").join("\n&nbsp;").split("\n").join("<br>").split("  ").join("&nbsp; ");this.container.innerHTML=a}.observes("text","render")});Journal.InlineItems.HeadingView=Journal.InlineItems.TextView.extend({className:"InlineItems.HeadingView",classNames:"heading".w(),rootHTML:'<div class="text"><div class="selectable"></div></div>'});require("views/inline_items/_bank");require("views/inline_items/text");require("views/apple_logo");Journal.InlineItems.FooterView=Journal.InlineItemView.extend({className:"InlineItems.FooterView",classNames:"footer".w(),appleLogoView:Journal.AppleLogoView.extend({themeNameBinding:".owner.pageView.themeName"}),privacyButtonView:Core.ButtonView.extend(CoreImage.ThemeSupport,{classNames:"footer-text-button left".w(),className:"privacyButtonView",displayWidthBinding:".owner.displayWidth",title:"_Footer.PrivacyPolicy".loc(),actionDelay:0,action:function(){window.open("_URL.PrivacyPolicy".loc())},render:function(a){a.innerHTML=this.title;this.set("aria-label",this.title)}}),tosButtonView:Core.ButtonView.extend(CoreImage.ThemeSupport,{classNames:"footer-text-button right".w(),className:"tosButtonView",displayWidthBinding:".owner.displayWidth",title:"_Footer.TermsOfService".loc(),actionDelay:0,action:function(){window.open("_URL.TermsOfService".loc())},render:function(a){tos=this;a.innerHTML=this.title;this.set("aria-label",this.title)}}),doLayout:function(){if(!this.layer||!this.displayWidth){return}var a=this.displayWidth,b=20;if(B.iPhone&&!B.android){b=20*a/Core.windowSize.width}else{if(B.iPad){b=20*a/Core.windowSize.width}}this.appleLogoView.setLayout((a-b*17/20)/2,0,NaN,b);this.layer.style.height=b+"px";this.layer.style.marginTop=Math.round(0.04*a)+"px";this.layer.style.width=a+"px"}.observes("displayWidth","render")});Journal.InlineItems.GridView=Journal.InlineItemView.extend(Core.WaitSupport,{className:"InlineItems.GridView",rootHTML:'<div class="grid"><div class="container full-height"></div></div>',containerElement:"layer.firstChild",numColumns:7,children:null,generateNewItemViews:function(){window.gv=this;var f=this.items,d=this.pageView;if(!f){return}this.computeLayout();var a=this.gridItemViews||(this.gridItemViews=[]);a.length=0;if(this.container.innerHTML){this.container.innerHTML=""}var b=function(){this.owner.closeReq()}.observes("waitDidComplete");this.openReq();for(var j=0,e=0,c,h,g;h=f[e];e++){this.openReq();h.variant=d&&d.themeInfo&&d.themeInfo.itemViewVariant;c=Journal.GridItems.findAndCreate(h,{journal:this.journal,indexInGrid:e,downerImportance:-e-1000*this.indexInEntry,entry:this.entry,owner:this,originalItem:h,notifyReady:b,pageView:d});if(c){j>(g=c.top+c.height)||(j=g);if(c.initiallyAppended){c.appendTo(this)}a.push(c)}if(!c||!c.hasWaitSupport){this.closeReq()}}this.closeReq();this.setIfChanged("numRows",j)}.observes("items","render"),computeLayout:function(){if(!this.layer){return}var c=this.displayWidth,b=this.numColumns,e=Math.floor(c/b),d=e*b,a=Math.round((c-d)/2);this.suspendTriggers();this.setIfChanged("usedWidth",d);this.setIfChanged("cellSize",e);this.setIfChanged("leftInset",a);this.resumeTriggers()}.observes("displayWidth"),positionContainer:function(){this.container.style.left=this.leftInset+"px"}.observes("leftInset"),sizeContainer:function(){this.container.style.width=this.usedWidth+"px"}.observes("usedWidth"),computeHeight:function(){if(this.numRows){this.setIfChanged("height",Math.floor((this.numRows+0.1)*this.cellSize))}}.observes("numRows","cellSize"),sizeLayer:function(){this.layer.style.height=this.height+"px"}.observes("height")});Journal.JournalEntryView=Core.View.extend(Core.GPUFriendliness,CoreImage.ThemeSupport,Core.WaitSupport,{className:"JournalEntryView",classNames:"journal-entry".w(),journal:undefined,entry:undefined,layoutItems:undefined,displayWidthBinding:".owner.displayWidth",selfHeightBinding:"to:.owner.currentEntryHeight",unzoomedSizeBinding:"hard:to:.owner.zoomContentSize",downerGroup:undefined,rootHTML:'<div><div class="container full-width"><div class="height-measurer"></div></div></div>',containerElement:"layer.firstChild",heightMeasurerElement:"container.firstChild",updateToLayoutItems:function(){var h=this.layoutItems;if(!h||!this.layer){return}var b=this.inlineItemViews||(this.inlineItemViews=[]),g=this.pageView;b.length=0;var d=function(){this.owner.closeReq()}.observes("waitDidComplete");this.openReq();this.setIfChanged("displayWidthDeferrer",this.displayWidth);for(var e=0,c=h.items,a,f;(f=c[e])||(e===c.length&&(f=Journal.initialStateController.loadEnvironment==="local"?undefined:{type:"Footer"}));e++){this.openReq();f.variant=g&&g.themeInfo&&g.themeInfo.itemViewVariant;a=Journal.InlineItems.findAndCreate(f,{indexInEntry:e,owner:this,pageView:g,entry:this.entry,journal:this.journal,originalItem:f,nextOriginalItem:c[e+1],prevOriginalItem:c[e-1],notifyReady:d}).appendTo(this.heightMeasurer);if(!a||!a.hasWaitSupport){this.closeReq()}if(a){b.push(a)}}this.closeReq()}.observes("render"),measuredHeight:function(){return Math.ceil(((this.heightMeasurer.offsetHeight||NaN)+this.displayWidth/20)||this.layout.height)}.property(),updateLayoutNonZoom:function(){if(this.owner.allowZoom){return}if(!this.isAppendedInWindow){this.__lIAIW__=NO;return}var a=Core.windowSize,b=this.layout;this.layer.style.width=this.container.style.width=this.displayWidth+"px";this.setIfChanged("displayWidthDeferrer",this.displayWidth);b.height=this.get("measuredHeight");b.width=this.displayWidth;b.left=Math.round(a.width/2-b.width/2);b.top=41;this.trigger("layout");if(this.__lIAIW__!==(this.__lIAIW__=YES)){this.selfHeight=NaN}this.setIfChanged("selfHeight",b.height)}.observes("displayWidth","isAppendedInWindow"),updateToDisplayNone:function(){if(!this.layer){return}this.layer.style.visibility=this.isHidden?"hidden":""}.observes("isHidden","render"),updateToOnscreen:function(){if(!this.layer){return}this.layer.style.marginLeft=this.layer.style.marginTop=this.isOnscreen?"0px":"-10000px"}.observes("isOnscreen","render"),updateLayoutForFullResInstance:function(){if(!this.owner.allowZoom||this.isGPUFriendly||!this.isAppendedInWindow||this.isHidden){return}var b=this.owner.zoomState,d=this.owner.zoomContainerSize,c=b.zoom*this.displayWidth;this.setIfChanged("displayWidthDeferrer",c);var a=this.layout;a.scale=1;a.translateX=a.translateY=0;a.height=this.get("measuredHeight");a.width=c;a.left=Math.round(d.width/2-c/2)+b.x+(d.left||0);a.top=Math.round(d.height/2-a.height/2)+b.y+(d.top||0);if(b.zoom===1){Core.cloneHash(a,this.unzoomedSize||(this.unzoomedSize={}));this.trigger("unzoomedSize")}this.trigger("layout")}.observes(".owner.zoomContainerSize",".owner.zoomState","isAppendedInWindow","isHidden"),updateLayoutForZoomInstance:function(){if(!this.owner.allowZoom||!this.isGPUFriendly||!this.isAppendedInWindow){return}var b=this.owner.zoomState,e=this.owner.zoomContainerSize,d=this.displayWidth;var c=this.setIfChanged("displayWidthDeferrer",d);var a=this.layout;a.scale=b.zoom;a.translateX=b.x;a.translateY=b.y;a.translateY+=(b.zoom-1)*23*Core.windowSize.width/768;a.height=c?this.get("measuredHeight"):a.height||this.get("measuredHeight");a.width=d;a.left=Math.round(e.width/2-d/2)+(e.left||0);a.top=Math.round(e.height/2-a.height/2)+(e.top||0);this.trigger("layout")}.observes(".owner.zoomContainerSize",".owner.zoomState","isAppendedInWindow","isOnscreen")});Journal.JournalListView=Core.View.extend({classNames:"journal-list full-width".w(),externalDisplayWidthBinding:"from:.owner.displayWidth",list:null,downerGroupBinding:"from:.owner.downerGroup",LAYER_TOP:41,decideIsSmall:function(){this.isSmall=Math.max(Core.windowSize.width,Core.windowSize.height)<=550;this.ensureOwn("classNames").push(this.isSmall?"small":"big")}.observes("init"),establishDisplayWidth:function(){var a=this.externalDisplayWidth;if(B.iPad||!B.mobile){return this.setIfChanged("displayWidth",a<1024?768:1024)}return this.setIfChanged("displayWidth",a)}.observes("externalDisplayWidth"),updateToList:function(){if(!this.layer||!this.list){return}var d=this.layer,a=this.list.journals,b;d.innerHTML="";(b=this._children||(this._children=[])).length=0;for(var c=0,f,e;f=a[c];c++){b.push(e=Journal.JournalListItemView.create({downerImportance:-c,indexInList:c,owner:this,journal:f,isSmall:this.isSmall}).appendTo(this))}}.observes("list","render"),doLayout:function(){if(!this.layer||!this._children||!this._children.length){return}var e=this.displayWidth;var o=this.isSmall;var E=this.layer,t=this._children,D=t.length,a=!o?(e<=250?1:e<=450?2:e<=800?3:e<=980?4:e<=1250?5:e<=1536?6:7):(e<=210?1:e<=315?2:e<=400?3:e<=479?4:e<=590?5:6),f=!o?205:103,C=!o?208:117,g=!o?0:f/6,r=e/(a+0.5)+g/(a),A=(r-f)/2,b=!o?221:122,k=(!o?1:0)+r/4+A+(Core.windowSize.width-e)/2-g/2,y=!o?50:20;for(var v=0,x,c,s;x=t[v];v++){c=k+r*(v%a);s=y+b*Math.floor(v/a);x.set("width",f);x.layer.style.left=Math.floor(c)+"px";x.layer.style.top=Math.round(s)+"px"}var n=this._shelves||(this._shelves=[]),l=Math.ceil(D/a),m=e,p=!o?150:75,h=(Core.windowSize.width-m)/2,d=!o?(window.devicePixelRatio>=2?148:150):87,q=null;for(var u=0,z,w;u<l;u++){if(!(z=n[u])){z=n[u]=document.createElement("div");z.className="shelf";z.innerHTML='<div class="left"></div><div class="middle"></div><div class="right"></div>';z._isInUse=NO}if(!z._isInUse){this.layer.appendChild(z)}z._isInUse=YES;z.style.left=Math.round(h)+"px";z.style.top=Math.round(z._top=u*b+y+d)+"px";z.style.width=Math.round(m)+"px";z.style.height=Math.round(z._height=p)+"px";q=z}for(;z=n[u];u++){if(z._isInUse){z.parentNode&&z.parentNode.removeChild(z)}z._isInUse=NO}this._lastShelfBottom=(q&&q._top+q._height)||0;this._extraHeight=40;this.computeHeight()}.observes("externalDisplayWidth","list","render"),computeHeight:function(){var b=this.layer,c=Core.windowSize.height;if(!b||!c||isNaN(this._lastShelfBottom)){return}this.setIfChanged("contentHeight",this._lastShelfBottom+this._extraHeight);var a=Math.max(c-this.LAYER_TOP,this.contentHeight);this.setIfChanged("height",Math.round(a))}.observes("window.Core.windowSize"),setLayerHeight:function(){if(!this.layer&&isNaN(this.height)){return}this.layer.style.height=this.height+"px"}.observes("height")});(function(){var a=Core.View.extend({rootHTML:'<div class="journal-item-spinner"><div class="inner"></div></div>',innerElement:"layer.firstChild",width:35,height:35,spinDelay:500,hasSpin:NO,_spinnerAnim:Anim.Animation.extend({from:0,to:11,duration:1500,discreteness:1,repeat:Infinity,tween:Anim.tweens.LINEAR,update:function(){this.view.inner.style.top=-this.current*35+"px"}}),instantiateAnim:function(){this._spinnerAnim=this._spinnerAnim.create({view:this})}.observes("render"),spinDidChange:function(){var c=this._spinnerAnim;if(this.hasSpin){c.start();var b=(this.owner.photoMaskWidth-this.width)/2,d=(this.owner.photoMaskHeight-this.height)/2;this.layer.style.top=Math.round(d)+"px";this.layer.style.left=Math.round(b)+"px";this.appendTo(this.owner.photoMask)}else{this.remove();c.stop()}}.observes("hasSpin"),scheduleHasSpin:function(){var b=this;if(this.wantsSpin){if(!this._hasSpinTimeout){this._hasSpinTimeout=setTimeout(function(){b.setIfChanged("hasSpin",YES)},this.spinDelay)}}else{clearTimeout(this._hasSpinTimeout);this._hasSpinTimeout=undefined;this.setIfChanged("hasSpin",NO)}}.observes("wantsSpin")});Journal.JournalListItemView=Core.ButtonView.extend(CoreImage.MissingImageSupport,{rootHTML:'<div class="journal-list-item"><div class="book"></div><div class="title selectable"></div><div class="photo-mask"></div></div>',bookElement:"layer.firstChild",titleElement:"book.nextSibling",photoMaskElement:"title.nextSibling",downerGroupBinding:".owner.downerGroup",journal:null,isSmall:NO,decideSmallnessDependentValues:function(){this.ensureOwn("classNames").push(this.isSmall?"small":"big");this.photoMaskWidth=this.isSmall?67:124;this.photoMaskHeight=this.isSmall?53:98}.observes("init"),fetchingJournal:NO,spinnerView:a.extend({wantsSpinBinding:"from:.owner.fetchingJournal",initiallyAppended:NO}),keyPhotoView:CoreImage.EasyDomImageView.extend(Journal.UrlResolutionForImages,{classNames:"photo".w(),appendInto:"photoMask",downerGroupBinding:".owner.downerGroup",importanceBinding:".owner.downerImportance",getReps:function(){this.setIfChanged("reps",this.owner.getPath("journal.appearance.keyPhoto.photoReps"))}.observes(".owner.journal","init")}),missingImageParent:"photoMask",computeMissingImageLayout:function(){var b=this.missingImageLayout||(this.missingImageLayout={});b.top=0;b.left=0;b.width=this.photoMaskWidth;b.height=this.photoMaskHeight;this.trigger("missingImageLayout")}.observes("render"),fallBackOnMissingImage:function(){if(!this.isAppendedInWindow){return}if(this.currentSrc){return}this.set("isShowingMissingImage",YES)}.observes("isAppendedInWindow"),removeMissingImage:function(){if(!this.isImageOpaque){return}this.set("isShowingMissingImage",NO)}.observes("isImageOpaque"),action:function(){this.mouseExited();var b=this;b.setIfChanged("fetchingJournal",YES);Journal.workspaceController.showJournal(b.journal)},noLongerFetchingJournal:function(){this.setIfChanged("fetchingJournal",NO)}.observes("window.Journal.workspaceController.nowShowing"),updateToJournal:function(){window.jliv=this;if(!this.layer||!this.journal){return}var e=this.journal,b=e.appearance||{color:"black"},c=this,d=Core.escapeHTML(e.title||"");this.title.innerHTML=d.split(" ").join("&nbsp;").split("\n").join("");this.setIfChanged("ariaLabel",e.title);this.doPhotoLayout()}.observes("journal","render"),doPhotoLayout:function(){if(!this.journal.appearance){return}var l=this.journal.appearance,e=l.keyPhoto,n=e.width,p=e.height,b=n/p,q=this.photoMaskWidth,f=this.photoMaskHeight,i=q/f,k=b>i,c=l.zoom,g=c*(k?b/i:1),m=c*(k?1:1/b*i),s=l.cropLeft,o=l.cropTop,d=1-g,r=1-m,j=s*d,h=o*r;this.keyPhotoView.setLayout(Math.round(j*q),Math.round(h*f),Math.round(g*q),Math.round(m*f))}.observes("render")})})();require("views/journal_entry_selector");require("views/journal_list");require("views/top_bar");Journal.JournalListPageView=Core.View.extend({typeInteger:Journal.LIST,isShowingBinding:"to:Journal.workspaceController.isJournalListShowing",initiallyAppended:NO,classNames:"journal-list-page full-width".w(),displayWidth:undefined,topBarView:Journal.TopBarView.extend({desiredInitialTab:"list",dropTriggerBinding:".owner.list",rootHTML:'<div><div class="title full-width full-height"></div><div class="ghost-title-container full-width" aria-hidden="true"><div class="title ghost full-width full-height"></div></div><div class="title-mask full-width" aria-hidden="true"></div><div class="front-shadow"></div></div>',titleElement:"layer.firstChild",ghostTitleElement:"title.nextSibling.firstChild",backShadowElement:"layer.lastChild",frontShadowElement:"backShadow.previousSibling",writeTitle:function(){if(!this.layer){return}this.ghostTitle.innerHTML=this.title.innerHTML="_Journals".loc()}.observes(".owner.list")}),journalListView:Journal.JournalListView.extend({listBinding:"from:.owner.list",downerGroupBinding:"from:.owner.downerGroup",heightBinding:"to:.owner.journalListHeight"}),footerAppleView:Journal.AppleLogoView.extend({themeName:"shelf",initiallyAppended:NO,zIndex:200}),privacyButtonView:Core.ButtonView.extend({classNames:"footer-text-button left".w(),title:"_Footer.PrivacyPolicy".loc(),actionDelay:0,action:function(){window.open("_URL.PrivacyPolicy".loc())},render:function(a){a.innerHTML=this.title;this.set("aria-label",this.title)}}),tosButtonView:Core.ButtonView.extend({classNames:"footer-text-button right".w(),title:"_Footer.TermsOfService".loc(),actionDelay:0,action:function(){window.open("_URL.TermsOfService".loc())},render:function(a){a.innerHTML=this.title;this.set("aria-label",this.title)}}),makeDownerGroup:function(){this.set("downerGroup",CoreImage.ImageGroup.create({coreGuid:"LIST_GROUP:"+this.coreGuid,importance:1}).enter(CoreImage.imageLoader.group))}.observes("init"),bumpDownerGroup:function(){if(this.isShowing){this.downerGroup.becomeMostImportant()}}.observes("isShowing"),positionFooter:function(){if(!this.isAppendedInWindow){return}if(!this.journalListHeight){return}var a=this.journalListHeight;this.footerAppleView.append();this.footerAppleView.setSize(NaN,20);this.footerAppleView.setLayout((Core.windowSize.width-this.footerAppleView.width)/2,a);this.privacyButtonView.layer.style.top=this.tosButtonView.layer.style.top=Math.round(a+6)+"px"}.observes("journalListHeight","isAppendedInWindow","window.Core.windowSize")});require("views/basic_dialog");Journal.QuickTimeErrorView=Journal.BasicDialogView.extend({title:"_Error.MissingQuicktime".loc(),widthPadding:B.rightToLeft?70:75,leftPadding:B.rightToLeft?25:0,dlButtonView:Core.ButtonView.extend({rootHTML:'<div><div class="crazy-extender eye-transparent-mouse-opaque"></div><div>',crazyExtenderElement:"layer.firstChild",action:function(){window.location.href="_URL.DownloadQuicktime".loc()},getLinkAndSizeExtender:function(){if(!this.isAppended){return}this.link=this.getPath(B.leftToRight?"layer.previousSibling.lastChild":"layer.previousSibling.firstChild");if(!this.link){return}if((this.link.tagName||"").toLowerCase()!=="a"){this.link=null}if(!this.link){return}this.crazyExtender.style[B.leftToRight?"left":"right"]=-this.link.offsetWidth-12+"px"}.observes("isAppendedInWindow"),brightenLinkText:function(){if(!this.link){return}if(this.isOver){$(this.link).addClass("hover")}else{$(this.link).removeClass("hover")}}.observes("isOver"),brightenLinkTextMore:function(){if(!this.link){return}if(this.isActive){$(this.link).addClass("active")}else{$(this.link).removeClass("active")}}.observes("isActive")})});(function(){var b=Core.ButtonView.extend({layerHeightBinding:".owner.VISUAL_HEIGHT",spacingBinding:".owner.SPACING",rootHTML:'<div><div class="icon"></div></div>',iconElement:"layer.firstChild",renderSize:function(){var e=this.icon.style,d=this.layer.style;e.width=this.width+"px";e.height=this.height+"px";e.left=Math.round(this.spacing/2)+"px";e.top=Math.round((this.layerHeight-this.height)/2)+"px";d.top="0px";d.height=this.layerHeight+"px";d.width=(this.layerWidth=this.spacing+this.width)+"px"}.observes("render")});var a=Core.View.extend({width:2,layerHeightBinding:".owner.VISUAL_HEIGHT",spacingBinding:".owner.SPACING",isDivider:YES,rootHTML:'<div class="divider"><div class="img"></div></div>',renderSize:function(){var d=this.layer.style;d.width=(this.layerWidth=this.width+Math.round(this.spacing/2))+"px";d.height=this.layerHeight}.observes("render")});var c=Journal.URLResolver.isUbiquityMode&&!B.mobile;Journal.SlideshowHudView=Core.View.extend(Core.FadeShowHide,{classNames:"hud".w(),rootHTML:'<div><div class="background"><div class="left"></div><div class="middle"></div><div class="right"></div></div><div class="divider"></div></div>',VISUAL_HEIGHT:74,SPACING:35,EXTRA_SIDE:10,isMouseOverMe:NO,mouseEntered:function(){this.set("isMouseOverMe",YES)},mouseExited:function(){this.set("isMouseOverMe",NO)},showDividers:function(){this.showDividers=c&&CoreImage.fullScreenSupported()}.observes("init"),touchStart:function(d){if(this.owner){clearTimeout(this.owner._touchHideHudTimeout)}d._doNotHideHud=YES},doLayout:function(){for(var f=0,h=this.initialChildViews,e=this.EXTRA_SIDE,d,g;d=this[h[f]];f++){if(!d.isAppended){continue}if(d.isDivider&&!this.showDividers){d.set("isAppended",NO);continue}d.layer.style.left=e+"px";e+=d.layerWidth}e+=this.EXTRA_SIDE;this.layer.style.width=e+"px";this.layer.style.left=Math.round((Core.windowSize.width-e)/2)+"px"}.observes("render","window.Core.windowSize"),downloadView:c?b.extend({classNames:"download".w(),width:27,height:28,currentItemBinding:"from:Journal.slideshowController.currentItem",isEnabledBinding:"from:value",establishPhoto:function(){var d=this.getPath("currentItem._slideshowItemView.value");this.setIfChanged("value",d&&!d.videoReps&&d.photoReps?d:null)}.observes("currentItem"),action:function(){if(!this.value){return}if(this.value.videoReps){Journal.fileDownloader.downloadVideo(this.value)}else{Journal.fileDownloader.downloadPhoto(this.value)}}}):null,firstDividerView:a,prevView:b.extend({classNames:"prev".w(),isEnabledBinding:".owner.shouldEnableControls",width:34,height:28,action:function(){Journal.slideshowController.selectPrevious()}}),playView:b.extend({width:26,height:32,isPauseBinding:"from:Journal.slideshowController.isPlaying",isEnabledBinding:".owner.shouldEnableControls",watchState:function(){var d=this.isPause;$(this.layer).addClass(d?"pause":"play");$(this.layer).removeClass(d?"play":"pause")}.observes("isPause","render"),action:function(){Journal.slideshowController.toggleShow()}}),nextView:b.extend({classNames:"next".w(),isEnabledBinding:".owner.shouldEnableControls",width:34,height:28,action:function(){Journal.slideshowController.selectNext()}}),secondDividerView:a,fullscreenView:b.extend({width:27,height:30,actionDelay:0,isFullScreenBinding:"from:window.CoreImage.isFullScreen",initiallyAppended:function(){this.initiallyAppended=CoreImage.fullScreenSupported()}.observes("init"),action:function(){if(CoreImage.isFullScreen){CoreImage.cancelFullScreen()}else{CoreImage.requestFullScreen()}},watchState:function(){var d=this.isFullScreen;$(this.layer).addClass(d?"collapse":"full");$(this.layer).removeClass(d?"full":"collapse")}.observes("isFullScreen","render")}),hackFixWebkitImageBuffers:(B.safari>=535)&&!B.mobile?function(h,g){if(!this.isAppendedInWindow){return}h||(h=this.layer);for(var f=0,d,e;d=h.childNodes&&h.childNodes[f];f++){if(g){e=d.__HFWSBG__||(d.__HFWSBG__=Core.getStyle(d,"background-image"));d.style.backgroundImage="none ! important"}else{if(d.__HFCSBG__){d.style.backgroundImage=d.__HFCSBG__}}this.hackFixWebkitImageBuffers(d,g)}}:function(){},showHideAnimationExample:Anim.Fader.extend({recordIt:function(){if(this.to===1){this.owner.hackFixWebkitImageBuffers(undefined,YES)}}.observes("frame1"),restoreIt:function(){if(this.to===1){this.owner.hackFixWebkitImageBuffers(undefined,NO)}}.observes("frame2")})})})();Journal.SlideshowItems=Journal.ClassBank.create({suffix:"View"});Journal.SlideshowItemView=Core.View.extend(Journal.PathRetrievalSupport,CoreImage.SlideshowItemMixin,{typeInteger:Journal.SLIDESHOW_ITEM=2,classNames:"slideshow-item".w(),entry:undefined,downerGroupBinding:"from:.owner.downerGroup",touchStart:function(){if(this.owner&&this.owner.reshowHud){this.owner.reshowHud()}}});Journal.SlideshowItems.Default=Journal.SlideshowGridItemWrapperView=Journal.SlideshowItemView.extend(CoreImage.ThemeSupport,{className:"SlideshowGridItemWrapperView",initializeAndAppendGridItem:function(){var a=Journal.GridItems.findAndCreate(this.originalItem,{isPurelyDecorative:NO,originalItem:this.originalItem,owner:this,top:0,left:0,entry:this.entry,journal:this.journal,pageView:this.pageView,action:function(){},imageInset:{top:0,left:0,right:0,bottom:0}});if(!a){return}this.setIfChanged("gridItemView",a.appendTo(this))}.observes("render"),computeSize:function(){if(!this.layer||!this.gridItemView){return}var d=this.availableSize,g=d.width,a=d.height,f=g/a,l=this.gridItemView,k=l.width,e=l.height,j=k/e,b=j>f,i=b?g:a*j,c=b?g/j:a,h=l.maxSlideshowSize;if(h<i){i=h;c=i/j}if(h<c){c=h;i=i*j}this.size.width=i;this.size.height=c;this.setIfChanged("cellSize",i/k);this.trigger("size")}.observes("render","availableSize")});Journal.SlideshowItems.TextView=Journal.SlideshowItemView.extend({classNames:"text".w(),rootHTML:'<div><table cellspacing=0 cellpadding=0 border=0 width=100% height=100%><tbody><tr><td valign=center align=center><span class="selectable"></span></td></tbody></div>',containerElement:"layer.firstChild.firstChild.firstChild.firstChild",spanElement:"container.firstChild",sizeFactor:35/1000,value:"",align:"center",color:"#cccccc",update:function(){this.span.innerHTML=this.value;this.span.style.color=this.color;this.container.setAttribute("align",this.align)}.observes("value","align","render","color"),doLayout:function(){var a=this.availableSize;this.set("size",{width:a.width*0.9,height:a.height*0.9});this.span.style.fontSize=Math.round(this.sizeFactor*(a.width+a.height)/2)+"px"}.observes("availableSize")});Journal.SlideshowItems.HeadingView=Journal.SlideshowItems.TextView.extend({classNames:"heading".w(),sizeFactor:100/1000});Journal.SlideshowItems.PhotoView=Journal.SlideshowItemView.extend(CoreImage.MissingImageSupport,Core.PinchZoomability,CoreImage.SlideshowPhotoMixin,{className:"SlideshowItems.PhotoView",typeInteger:Journal.SLIDESHOW_PHOTO=2,classNames:"photo".w(),imageView:CoreImage.SlideshowPhotoMixin.imageView.extend(Journal.UrlResolutionForImages,{establishReps:function(){this.set("reps",this.owner.getPath("value.photoReps"))}.observes(".owner.value","init"),isLoadingBinding:"to:.owner.isLoading",downerImportanceBinding:".owner.downerImportance"}),establishTitle:function(){this.setIfChanged("title",this.getPath("value.caption"))}.observes("init","value")});require("views/slideshow_items/photo");require("views/qt_error");(function(){var a="_Error.FailureTryingToPlayVideo".loc();if(B.iPhone){a=a.split(". ")[0]+"."}Journal.SlideshowItems.VideoView=Journal.SlideshowItems.PhotoView.extend({classNames:"video".w(),shouldAttemptToFillScreen:NO,allowsHudToHide:!B.mobile,allowZoom:NO,playButtonView:Core.ButtonView.extend({initiallyAppended:NO,actionDelay:0,classNames:"play-button".w(),action:function(){this.owner.playVideo()}}),qtErrorView:Journal.QuickTimeErrorView.extend({initiallyAppended:NO}),canNotPlayVideoView:Journal.BasicDialogView.extend({initiallyAppended:NO,title:"_Error.CanNotPlayVideo".loc(),widthPadding:41}),failedToPlayVideoView:Journal.BasicDialogView.extend({initiallyAppended:NO,title:a,widthPadding:41}),isShowingVideo:NO,playVideo:function(){if(!Journal.VideoDetection.canPlayVideoNow()){return}this.setIfChanged("isShowingVideo",YES);this.videoPlayerView.play();var b=this.owner.controller;this._wasSlideshowPlaying=b&&b.isPlaying;b.stopShow()},resetState:function(){this.failedToPlayVideoView.remove();this.set("isShowingVideo",NO)},pauseVideoOnSlideshowStart:function(){if(!this.getPath("owner.controller.isPlaying")){return}if(!this.videoPlayerView){return}if(this.videoPlayerView.pause()){this.set("isShowingVideo")}}.observes(".owner.controller.isPlaying"),resetOnEnterForQTBrowsers:function(b,d,c){if(!this.isAppendedInWindow||(b!==this&&b!==this.owner)||!this.getPath("videoPlayerView.video.isQT")){return}this.resetState()}.observes("willEnterTransition",".owner.willEnterTransition"),showVideo:function(){if(B.onlyiOS){return}if(!this.isShowingVideo){return}if(!this.videoPlayerView){this.videoPlayerView=Journal.VideoPlayerView.create(this.originalItem,{owner:this,originalItem:this.originalItem,entry:this.entry,playbackDidEndBinding:"hard:.owner.playbackDidEnd",playbackDidErrBinding:"hard:.owner.playbackDidErr"})}this.imageView.remove();this.playButtonView.remove();this.videoPlayerView.appendTo(this)}.observes("isShowingVideo"),hideVideo:function(){if(B.onlyiOS){return}if(this.isShowingVideo){return}Anim.tellStop(this._videoFader);if(this.videoPlayerView){this.videoPlayerView.remove();this.videoPlayerView=null}this.imageView.append();this.playButtonView.append()}.observes("isShowingVideo"),appendErrorDialogIfNeeded:function(){if(!Journal.VideoDetection.canPlayVideoEver()){this.canNotPlayVideoView.appendTo(this)}else{if(!Journal.VideoDetection.canPlayVideoNow()&&Journal.VideoDetection.doesQTExistForPlatform()){this.qtErrorView.appendTo(this)}}}.observes("render"),appendPlayButtonIfNeeded:function(){if(B.onlyiOS){return}if(Journal.VideoDetection.canPlayVideoNow()){this.playButtonView.appendTo(this)}}.observes("render"),_iOSVideoHack:function(){if(!B.onlyiOS||!this.isAppendedInWindow){return}this.imageView.remove();this.playButtonView.append();if(this.videoPlayerView){this.videoPlayerView.remove()}this.videoPlayerView=Journal.VideoPlayerView.create(this.originalItem,{owner:this,originalItem:this.originalItem,entry:this.entry,playbackDidEndBinding:"hard:.owner.playbackDidEnd",playbackDidErrBinding:"hard:.owner.playbackDidErr"});this.imageView.append();this.videoPlayerView.appendTo(this)}.observes("isAppendedInWindow"),notifiediOSVideoDidBeginPlaying:function(){this.playButtonView.remove()}.observes("ios_videoDidBeginPlaying"),resetStateOnPlaybackEnd:function(){this.resetState()}.observes("playbackDidEnd"),resetStateOnPlaybackError:function(){if(!B.onlyiOS){this.resetState()}this.playButtonView.remove();this.failedToPlayVideoView.appendTo(this)}.observes("playbackDidErr"),possiblyContinueSlideshowOnEndAndError:function(){if(B.onlyiOS){return}if(this._wasSlideshowPlaying){this.owner.controller.startShow()}}.observes("playbackDidEnd","playbackDidErr"),doLayout:function(){if(!this.value||!this.layer){return}var b=this.value;if(!b.width||!b.height){b.width=b.height=1}var g=this.availableSize,d=B.iPad?0.04:B.mobile?0.01:0.07,e=g.height*(1-d)-(this.getPath("owner.hudHeight")||74)-(41+16),c=this.size||(this.size={}),f=this.zoomContentSize||(this.zoomContentSize={});Core.cloneHash(Core.innerSizeInOuter(b.width,b.height,g.width,e),c);Core.cloneHash(c,f);this.zoomContainerSize=this.size;if(!this.zoomState){this.resetState(YES)}c.offsetTop=-(g.height-c.height)/2+41+10+(e-c.height)/2;this.trigger("size");this.trigger("imageLayout")}.observes("availableSize","value"),_notifiedRequestingFullScreenMode:function(){if(!(B.safari&&!B.chrome)||!this.isAppendedInWindow){return}this._didRequestFullScreenMode=true}.observes("window.CoreImage.requestingFullScreenMode"),_notifiedEnteredFullScreenMode:function(){if(!(B.safari&&!B.chrome)||!this.isAppendedInWindow){return}if(!this._didRequestFullScreenMode){$(document.body).addClass("safari").addClass("accidental-fullscreen")}}.observes("window.CoreImage.enteredFullScreenMode"),_notifiedExitedFullScreenMode:function(){if(!(B.safari&&!B.chrome)||!this.isAppendedInWindow){return}$(document.body).removeClass("safari").removeClass("accidental-fullscreen");this._didRequestFullScreenMode=false}.observes("window.CoreImage.exitedFullScreenMode")})})();Journal.SlideshowTopBarView=Journal.TopBarView.extend(Core.FadeShowHide,{classNames:"slideshow-top-bar".w(),shouldShowBinding:"from:.owner.isHudShowing",journalBinding:"from:.owner.journal",transitionDirectionBinding:"from:.owner.transitionDirection",dateTextPadding:10,showBackShadow:NO,isMouseOverMe:NO,mouseEntered:function(){this.set("isMouseOverMe",YES)},mouseExited:function(){this.set("isMouseOverMe",NO)},backButtonView:Journal.TopBarButtonView.extend({classNames:"back-button left back right".w(),leftBinding:"to:.owner._backButtonViewLeft",widthBinding:"to:.owner._backButtonViewWidth",actionDelay:B.iOS||B.safari||B.chrome?Journal.TopBarButtonView.prototype.actionDelay:0,updateToTitle:function(){var a=this.getPath("owner.journal.title");this.setIfChanged("ariaLabel",a);this.setIfChanged("title",a)}.observes(".owner.journal"),action:function(){Journal.workspaceController.set("nowShowing",Journal.JOURNAL)}}),leftSlider:(Core.transitionBank.xFadeSlideLeft&&Core.transitionBank.xFadeSlideLeft.extend({direction:-0.05}))||null,rightSlider:(Core.transitionBank.xFadeSlideRight&&Core.transitionBank.xFadeSlideRight.extend({direction:0.05}))||null,decideTransition:function(){this.titleSwapperView.defaultTransition=this.dateTextView.defaultTransition=this[this.transitionDirection+"Slider"]}.observes("transitionDirection"),titleSwapperView:CoreImage.FadingTextSwapperView.extend({classNames:"title-swapper full-width full-height".w(),valueBinding:"from:.owner.titleText",minLeftBinding:"from:.owner.titleMinLeft",textWidthBinding:"to:.owner._titleTextWidth",textLeftBinding:"to:.owner._titleTextLeft"}),dateTextView:CoreImage.FadingTextSwapperView.extend({classNames:"date-swapper",align:"right",valueBinding:"from:.owner.dateText",showTextBinding:"from:.owner.showDateText",textLeftBinding:"to:.owner._dateTextLeft"}),backButtonViewFrameChanged:function(){var b=this._backButtonViewLeft||0,a=this._backButtonViewWidth||0;if(!a){return}this.setIfChanged("titleMinLeft",b+a)}.observes("_backButtonViewLeft","_backButtonViewWidth"),titleAndDateTextFrameChanged:function(){var a=this._titleTextLeft||0,d=this._titleTextWidth||0,b=this._dateTextLeft||0,c=this.dateTextPadding;this.setIfChanged("showDateText",(a+d)<(b-c))}.observes("_titleTextWidth","_titleTextLeft","_dateTextLeft"),explicitlySetInlinePixelWidth:function(){if(!this.isAppendedInWindow){return}this.layer.style.width=Core.windowSize.width+"px"}.observes("isAppendedInWindow","window.Core.windowSize")});require("views/slideshow_hud");require("views/slideshow_top_bar");(function(){var a=Core.transitionBank,b=(a.slideLeft&&a.slideLeft.extend({tween:Anim.tweens.QUADRATIC_OUT,duration:200}))||null,c=(a.slideRight&&a.slideRight.extend({tween:Anim.tweens.QUADRATIC_OUT,duration:200}))||null;Journal.SlideshowPageView=CoreImage.SlideshowView.extend({typeInteger:Journal.SLIDESHOW,isLoading:NO,initiallyAppended:NO,classNames:"slideshow-page full-width full-height dark-theme".w(),entry:null,journal:null,isDark:YES,initialHudLifespan:4000,preserveUpSlideGPULayers:B.iOS||B.safari,rootHTML:'<div><div class="container full-width"></div></div>',containerElement:"layer.lastChild",computeLayerAndContainerHeights:function(){var d=Core.windowSize.height;if(this._lastHeight===(this._lastHeight=d)){return}this.layer.style.height=d+"px";this.container.style.height=d+"px"}.observes("render","window.Core.windowSize"),viewForItem:function(e,d){if(!e){return null}if(e._slideshowItemView){return e._slideshowItemView}return e._slideshowItemView=Journal.SlideshowItems.findAndCreate(e,{owner:this,downerImportance:d,entry:this.entry,journal:this.journal,originalItem:e,pageView:this})},exitSlideshow:function(){Journal.workspaceController.set("nowShowing",Journal.JOURNAL)},makeDownerGroup:function(){this.set("downerGroup",CoreImage.ImageGroup.create({coreGuid:"SLIDESHOW_GROUP:"+this.coreGuid,importance:1}).enter(CoreImage.imageLoader.group))}.observes("init"),bumpDownerGroup:function(){if(this.isShowing){this.downerGroup.becomeMostImportant()}}.observes("isShowing"),rewriteDownerImportances:function(){if(!this.currentItem||!this.itemSet){return}var d=this.itemSet&&this.itemSet.indexOf(this.currentItem);if(isNaN(d)||d===-1){return}this.downerGroup.target=d}.observes("currentItem"),leftTransitioners:[[null,null,null],[null,a.xFadeSlideLeft,a.xFadeSlideLeft],[null,a.xFadeSlideLeft,a.xFadeSlideLeft]],rightTransitioners:[[null,null,null],[null,a.xFadeSlideRight,a.xFadeSlideRight],[null,a.xFadeSlideRight,a.xFadeSlideRight]],leftSwipeTransitioners:[[null,null,null],[null,b,b],[null,b,b]],rightSwipeTransitioners:[[null,null,null],[null,c,c],[null,c,c]],hideZoomImageItem:function(){if(this.currentView){this.currentView.layer.style.visibility="hidden"}},unhideZoomImageItem:function(){if(this.currentView){this.currentView.layer.style.visibility=""}},getBigZoomInfo:function(){var d=this.currentView;if(!d||!d.getBigZoomInfo){return null}return d.getBigZoomInfo()},bumpIsTransitioning:function(){this.setIfChanged("isTransitioning",YES)}.observes("willEnterTransition"),killIsTransitioning:function(){this.setIfChanged("isTransitioning",NO)}.observes("didFinishTransition"),preventHudOnEnterBegin:function(f,d,e){if(!this.isShowing){return}if(this!==f){this.hideHud(YES)}}.observes("willEnterTransition"),preventHudOnExitBegin:function(f,d,e){if(!this.isShowing){return}if(this!==f){return}clearTimeout(this._touchHideHudTimeout);this.showHud(true)}.observes("willEnterTransition"),unpreventHudOnEnterFinish:function(){if(!this.isShowing){return}this.showHud(this.initialHudLifespan||undefined)}.observes("didFinishTransition"),rememberCurrentItemAsOfExitBegin:function(f,d,e){if(this!==f){return}this._currentItemAsOfExitBeginning=this.currentItem}.observes("willEnterTransition"),pokeRememberedExitCurrentItem:function(){if(Journal.workspaceController.nowShowing!==Journal.SLIDESHOW){return}this._currentItemAsOfExitBeginning=null}.observes("Journal.workspaceController.nowShowing"),clearSelfOnExit:function(){if(this.isShowing){return}if(this._currentItemAsOfExitBeginning!==this.currentItem){return}this.set("currentItem",null)}.observes("didFinishTransition"),notifyNewlyEnteredViewOfClickedStatus:function(){if(!this.isShowing){return}this.currentView&&this.currentView.trigger("didEnterViaUserClick")}.observes("didFinishTransition"),hudView:Journal.SlideshowHudView.extend({shouldShowBinding:"from:.owner.isHudShowing",isMouseOverMeBinding:"to:.owner.isMouseOverHud",selfHeightBinding:"to:.owner.hudHeight",establishShouldEnableControls:function(){this.setIfChanged("shouldEnableControls",this.getPath("owner.itemSet.length")>1)}.observes(".owner.itemSet"),rescale:function(){var d=Math.min(((Core.windowSize.width+Core.windowSize.height)/2)/600,1);this.layer.style.webkitTransform=d>=1?"":"scale3d("+d+","+d+",1)";this.layer.style.webkitTransformOrigin=d>=1?"":"50% 100%";this.set("selfHeight",74*d)}.observes("window.Core.windowSize","Journal.workspaceController.nowShowing")}),topBarView:Journal.SlideshowTopBarView.extend({shouldShowBinding:"from:.owner.isHudShowing",isMouseOverMeBinding:"to:.owner.isMouseOverHud",itemSetBinding:"from:.owner.itemSet",currentSlideshowItemViewBinding:"from:.owner.currentView",establishTitleAndDate:function(){if(!this.layer){return}var f=this.currentSlideshowItemView,d=(f&&(f.caption||f.title))||"",j="",h=(f&&f.getPath("value.date"))||"";if(h){try{h=h.split("-");var g={year:parseInt(h[0],10),month:parseInt(h[1],10),day:parseInt(h[2],10),hours:parseInt(h[3],10),minutes:parseInt(h[4],10),seconds:parseInt(h[5],10)};h=Journal.localizeDate(g,"_Date.Format".loc(),"_Date.AM".loc(),"_Date.PM".loc())}catch(i){h=""}}if(!d){d=h}else{j=h}this.setIfChanged("titleText",d);this.setIfChanged("dateText",j)}.observes("render","currentSlideshowItemView")}),keydownForArrowLeft:function(d){Journal.slideshowController.selectPrevious()},keydownForArrowRight:function(d){Journal.slideshowController.selectNext()},keydownForEscape:function(){Journal.workspaceController.set("nowShowing",Journal.JOURNAL)}})})();Journal.VideoPlayerView=Core.View.extend(Journal.PathRetrievalSupport,{classNames:"video-player",shouldAutoPlay:YES,updateToVideo:function(){window.player=this;if(!this.value){return}var a=this.getPath("value.videoReps");if(!a){return}var e=Journal.estimateAvailableBandwidth();var c=e<500?(a[640]||a[960]):(a[640]||a[960]);if(Math.max(Core.windowSize.width,Core.windowSize.height)*(window.devicePixelRatio||1)<=640){c=a[640]||a[960]}Core.debug("Playing video: Estimated available bandwidth was "+e+", and the preferred representation is ",c);if(!c){return}var b=c.url,f=this,d=c.fileInfo;d.requestSingleUrlSet(function(){f.didGetUrls(c)},function(){f.trigger("playbackDidErr")},!d.urlSet||d.urlSet.birth<new Date*1-60*1000)}.observes("value","render"),didGetUrls:function(g){if(!g){return}var h=g.fileInfo.urlSet.urls,e=this,d;Core.debug("Initializing video player with URLs "+h);Core.debug("version "+parseInt(B.version,10));if(!(B.safari&&!B.chrome)&&!B.mobile&&Journal.VideoDetection.isValidQTAvailable()){if(B.msie){this.layer.innerHTML='<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="https://www.apple.com/qtactivex/qtplugin.cab#version=7,3,0,0" playerType="quicktime"><param name="src" value="'+h[0]+'" /><param name="controller" value="true" /><param name="wmode" value="window" /><param name="showlogo" value="false" /><param name="scale" value="tofit" /><param name="bgcolor" value="black" /><param name="kioskmode" value="true" /><param name="autoplay" value="'+(!!this.shouldAutoPlay)+'" /><param name="enablejavascript" value="true" /><param name="postdomevents" value="true" /><param name="cache" value="true" /></object>';d=this.video=this.layer.firstChild;d.isQT=YES;d._urls=h;d._currentUrl=0;this._addQTDOMEvents()}else{this.layer.innerHTML='<EMBED SRC="'+h[0]+'"CONTROLLER="true" TYPE="video/quicktime" PLUGINSPAGE="www.apple.com/quicktime/download" EnableJavaScript="true" postdomevents="true" BGCOLOR="000000" SHOWLOGO="false" SCALE="TOFIT" AUTOPLAY="'+(!!this.shouldAutoPlay)+'" KIOSKMODE="true" CACHE="true" NAME="qtMovie'+this.coreGuid+'" />';d=this.video=this.layer.firstChild;d.isQT=YES;d.isQTEmbed=YES;d._urls=h;d._currentUrl=0;this._addQTDOMEvents()}}else{if(Journal.VideoDetection.canUseHTML5()){this.video=d=document.createElement("video");d.setAttribute("controls","controls");d.setAttribute("autoplay",this.shouldAutoPlay);if(B.onlyiOS){d.src=h[0];d.style.opacity=0;Core.addEvent(d,"play",function(){this.style.opacity="";if(e.owner.trigger("ios_videoDidBeginPlaying")){}});d._urls=h;d._currentlyAttemptingUrlIndex=0}else{for(var c=0,a=h.length;c<a;c++){var b=h[c];var f=document.createElement("source");f.setAttribute("type",B.android?"video/mp4":"video/x-m4v");f.setAttribute("src",h[c]);d.appendChild(d._lastSource=f)}}d.isHTML5=YES;this.layer.appendChild(d);this._addHTML5DOMEvents()}}this.trigger("didRenderVideo");if(Journal.initialStateController.params.video_error){setTimeout(function(){e.trigger("playbackDidErr")},200)}},_addQTDOMEvents:function(){var b=this.video,a=this;Core.addEvent(b,"qt_ended",function(c){a.trigger("playbackDidEnd",c)});Core.addEvent(b,"qt_error",function(f){var d=this._urls,c;if(!d){return a.trigger("playbackDidErr",f)}this._currentUrl++;if(!d[c=this._currentUrl]){return a.trigger("playbackDidErr",f)}this.src=d[c]})},_addHTML5DOMEvents:function(){var b=this.video,a=this;Core.addEvent(b,"ended",function(c){a.trigger("playbackDidEnd",c)});Core.addEvent(b._lastSource||b,"error",function(c){var d;if(B.onlyiOS){if((d=this._urls[++this._currentlyAttemptingUrlIndex])){this.src=d;return}}a.trigger("playbackDidErr",c)})},play:function(){var a=this.video;if(!a){this.setIfChanged("shouldAutoPlay",YES)}else{if(a.isHTML5){a.play()}}},pause:function(){var a=this.video;if(!a){this.setIfChanged("shouldAutoPlay",NO)}else{if(a.isHTML5){a.pause()}else{try{a.Stop()}catch(b){return 1}}}return 0}});(function(){var b=Journal.transitionBank,c=CoreImage.transitionBank,a=Core.transitionBank;Journal.page=Core.WorkspaceView.extend({classNames:"wrapper".w(),allowInterruption:NO,transitioningOverflow:"",nowShowingBinding:"from:Journal.workspaceController.nowShowing",isListViewShowingBinding:"from:Journal.workspaceController.isJournalListViewShowing",tabNames:Journal.tabNames,transitioners:[[null,null,null,null,null],[b.slideList,null,a.dropFrom,a.dropFrom,a.dropFrom],[null,a.liftTo,null,a.dropFrom,null],[null,null,c.zoomImageIn,null,null],[null,a.liftTo,null,null,null]],listView:Journal.JournalListPageView.extend({listBinding:"from:Journal.journalListController.list",establishDisplayWidth:function(){this.setIfChanged("displayWidth",Core.windowSize.width)}.observes("init","window.Core.windowSize")}),journalView:Journal.JournalPageView.extend({journalBinding:"from:Journal.journalController.journal",selectedEntryBinding:"Journal.journalController.entry",displayWidthBinding:"from:Journal.workspaceController.displayWidth",themeBinding:"to:Journal.slideshowController.theme"}),slideshowView:Journal.SlideshowPageView.extend({controller:Journal.slideshowController,journalBinding:"from:.controller.journal",entryBinding:"from:.controller.entry",itemSetBinding:"from:.controller.itemSet",currentItemBinding:".controller.currentItem",isLoadingBinding:"to:.controller.isLoading",themeBinding:"from:.controller.theme"}),errorView:Journal.ErrorPageView.extend({errorMessageBinding:"from:Journal.errorController.errorMessage",displayWidthBinding:"from:Journal.workspaceController.displayWidth",isShowingBinding:"to:.owner.isErrorViewShowing"}),fixSizeForIOS:B.iOS?function(){this.layer.style.width=Core.windowSize.width+"px";this.layer.style.height=Core.windowSize.height+"px"}.observes("window.Core.windowSize"):null,touchStart:function(){},manageIE8BackgroundExtender:B.msie<=8?function(){var d=this.isListViewShowing||this.isErrorViewShowing,e=this._ie8BGExtender;if(d){if(!e){e=this._ie8BGExtender=document.createElement("div");e.className="ie8-bg-extender"}if(!e.parentNode){this.layer.appendChild(e)}}else{e&&e.parentNode&&e.parentNode.removeChild(e)}}.observes("isListViewShowing","isErrorViewShowing"):null})})();require("core");Journal.mixin({main:function(){var a=document.getElementById("loading");if(a){a.parentNode.removeChild(a)}Browser.addBodyClassNames();if(Core.useGPU){document.body.className+=" gpu-enabled"}if(Journal.alwaysIncludeFooterLinks){document.body.className+=" always-include-footer-links"}(Journal.page=Journal.page.create()).append();if(Journal.initialStateController.initialTab==="list"){Journal.journalListController.fetchInitialList(function(){Journal.workspaceController.set("nowShowing",Journal.LIST)})}if(Journal.initialStateController.initialTab==="journal"){Journal.journalController.shiftToInitialJournal(function(){Journal.workspaceController.set("nowShowing",Journal.JOURNAL)})}}.observes("window.Core.windowDidLoad")});